<!DOCTYPE html>

<html lang="en">
  <head>
    
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Dependency Injection/Service Location &mdash; Phalcon 3.1.1 documentation (English)</title>
    <meta name="keywords" content="php, phalcon, phalcon php, php framework, faster php framework">
    <link rel="stylesheet" type="text/css" href="https://netdna.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="//static.phalconphp.com/www/css/phalcon.min.css" />
    <link href='//fonts.googleapis.com/css?family=Open+Sans:700,400' rel='stylesheet' type='text/css'>
    <link href="//fonts.googleapis.com/css?family=Merriweather:400,700" rel="stylesheet" type="text/css" />
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" />
    <!--
    EUROPE <link href='//fonts.googleapis.com/css?family=Open+Sans:700,400&subset=latin-ext' rel='stylesheet' type='text/css'>
    GREEK <link href='//fonts.googleapis.com/css?family=Open+Sans:700,400&subset=greek-ext' rel='stylesheet' type='text/css'>
    RUSSIA <link href='//fonts.googleapis.com/css?family=Open+Sans:700,400&subset=cyrillic-ext,latin' rel='stylesheet' type='text/css'>
    -->

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/docs.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.1.1',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/docs.js"></script>
    <link rel="shortcut icon" href="https://static.phalconphp.com/www/images/favicon.ico"/>
    <link rel="top" title="Phalcon 3.1.1 documentation" href="../index.html" />
    <link rel="next" title="The MVC Architecture" href="mvc.html" />
    <link rel="prev" title="List of examples" href="samples.html" /> 
  </head>
  <body>

<header class="page-header">
    <nav class="navbar" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-menu-container">
                    <span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
                </button>
                <a class="navbar-brand phalcon-logo" href="/"><span itemprop="name" class="sr-only">Phalcon PHP</span></a>
            </div>

            <div class="collapse navbar-collapse navbar-right" id="main-menu-container">
                <ul class="nav navbar-nav main-menu">
                  <li class="first"><a href="//phalconphp.com/en/download" class="header-nav-link">Download</a></li>
                  <li><a href="//docs.phalconphp.com/en/latest/index.html" class="header-nav-link" target="_blank">Documentation</a></li>
                  <li><a href="//forum.phalconphp.com/" class="header-nav-link" target="_blank">Forum</a></li>
                  <li><a href="//blog.phalconphp.com/" class="header-nav-link" target="_blank">Blog</a></li>
                  <li><a href="//phalconist.com/" class="header-nav-link" target="_blank">Resources</a></li>
                  <li><a href="//phalconphp.com/en/about">About</a></li>
                  <li><div align="right">
                      <iframe src="https://ghbtns.com/github-btn.html?user=phalcon&amp;repo=cphalcon&amp;type=watch&amp;count=true&amp;size=large"
      allowtransparency="true" frameborder="0" scrolling="0" width="152px" height="30px"></iframe>
                    </div></li>
                </ul>
            </div>
        </div>
    </nav>
  </header>

<div class="heading">
    <div class="container">
        <div class="row">
            <h2>Documentation</h2>
        </div>
    </div>
</div>
    <div class="related">
      <ul>
        <li class="right" >
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="mvc.html" title="The MVC Architecture"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="samples.html" title="List of examples"
             accesskey="P">previous</a> |</li>
        <li><a href="//phalconphp.com">Home</a> &raquo;</li>
        <li><a href="../index.html">Phalcon 3.1.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

      <table width="100%" align="center" cellpadding="0" cellspacing="0">
        <tr>
      <td class="primary-box" width="25%" valign="top">
            <div>
            <div id="searchbox" style="">
                <!--<form class="search" action="http://readthedocs.org/search/project/" method="get">
                  <input type="search" name="q" size="25" placeholder="Search">
                  <input type="submit" value="Go">
                  <input type="hidden" name="selected_facets" value="project:">
                </form>-->
                <div style="width:200px;padding:10px">
                  <gcse:searchbox-only></gcse:searchbox-only>
                </div>
            </div>
            </div>
            <div style="padding:5px;padding-left:10px">
              <div id="carbonads-container">
                <div class="carbonad"><div id="azcarbon"></div>
                <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=phalconphpcom" id="_carbonads_js"></script>
                </div></div>
            </div>
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Dependency Injection/Service Location</a><ul>
<li><a class="reference internal" href="#registering-services-in-the-container">Registering services in the Container</a><ul>
<li><a class="reference internal" href="#simple-registration">Simple Registration</a><ul>
<li><a class="reference internal" href="#string">String</a></li>
<li><a class="reference internal" href="#class-instances">Class instances</a></li>
<li><a class="reference internal" href="#closures-anonymous-functions">Closures/Anonymous functions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#complex-registration">Complex Registration</a><ul>
<li><a class="reference internal" href="#constructor-injection">Constructor Injection</a></li>
<li><a class="reference internal" href="#setter-injection">Setter Injection</a></li>
<li><a class="reference internal" href="#properties-injection">Properties Injection</a></li>
</ul>
</li>
<li><a class="reference internal" href="#array-syntax">Array Syntax</a></li>
</ul>
</li>
<li><a class="reference internal" href="#resolving-services">Resolving Services</a><ul>
<li><a class="reference internal" href="#events">Events</a></li>
</ul>
</li>
<li><a class="reference internal" href="#shared-services">Shared services</a></li>
<li><a class="reference internal" href="#manipulating-services-individually">Manipulating services individually</a></li>
<li><a class="reference internal" href="#instantiating-classes-via-the-service-container">Instantiating classes via the Service Container</a></li>
<li><a class="reference internal" href="#automatic-injecting-of-the-di-itself">Automatic Injecting of the DI itself</a></li>
<li><a class="reference internal" href="#organizing-services-in-files">Organizing services in files</a></li>
<li><a class="reference internal" href="#accessing-the-di-in-a-static-way">Accessing the DI in a static way</a></li>
<li><a class="reference internal" href="#factory-default-di">Factory Default DI</a></li>
<li><a class="reference internal" href="#service-name-conventions">Service Name Conventions</a></li>
<li><a class="reference internal" href="#implementing-your-own-di">Implementing your own DI</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="samples.html" title="previous chapter">&lt; List of examples</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="mvc.html" title="next chapter">The MVC Architecture &gt;</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/reference/di.txt" rel="nofollow">Show Source</a></li>
            </ul>
        </td>
          <td class="second-box" valign="top">
            <div class="document">
                <div class="documentwrapper">
                  <div class="bodywrapper">
                    <div class="body" >
                      
  <div class="section" id="dependency-injection-service-location">
<h1>Dependency Injection/Service Location<a class="headerlink" href="#dependency-injection-service-location" title="Permalink to this headline">¶</a></h1>
<blockquote class="highlights">
<div>Before reading this section, it is wise to read <a class="reference internal" href="di-explained.html"><em>the section which explains why Phalcon uses service location and dependency injection</em></a>.</div></blockquote>
<p><a class="reference internal" href="../api/Phalcon_Di.html"><em>Phalcon\Di</em></a> is a component implementing Dependency Injection and Location of services and it&#8217;s itself a container for them.</p>
<p>Since Phalcon is highly decoupled, <a class="reference internal" href="../api/Phalcon_Di.html"><em>Phalcon\Di</em></a> is essential to integrate the different components of the framework. The developer can
also use this component to inject dependencies and manage global instances of the different classes used in the application.</p>
<p>Basically, this component implements the <a class="reference external" href="http://en.wikipedia.org/wiki/Inversion_of_control">Inversion of Control</a> pattern. Applying this, the objects do not receive their dependencies
using setters or constructors, but requesting a service dependency injector. This reduces the overall complexity since there is only
one way to get the required dependencies within a component.</p>
<p>Additionally, this pattern increases testability in the code, thus making it less prone to errors.</p>
<div class="section" id="registering-services-in-the-container">
<h2>Registering services in the Container<a class="headerlink" href="#registering-services-in-the-container" title="Permalink to this headline">¶</a></h2>
<p>The framework itself or the developer can register services. When a component A requires component B (or an instance of its class) to operate, it
can request component B from the container, rather than creating a new instance component B.</p>
<p>This way of working gives us many advantages:</p>
<ul class="simple">
<li>We can easily replace a component with one created by ourselves or a third party.</li>
<li>We have full control of the object initialization, allowing us to set these objects, as needed before delivering them to components.</li>
<li>We can get global instances of components in a structured and unified way.</li>
</ul>
<p>Services can be registered using several types of definitions:</p>
<div class="section" id="simple-registration">
<h3>Simple Registration<a class="headerlink" href="#simple-registration" title="Permalink to this headline">¶</a></h3>
<p>As seen before, there are several ways to register services. These we call simple:</p>
<div class="section" id="string">
<h4>String<a class="headerlink" href="#string" title="Permalink to this headline">¶</a></h4>
<p>This type expects the name of a valid class, returning an object of the specified class, if the class is not loaded it will be instantiated using an auto-loader.
This type of definition does not allow to specify arguments for the class constructor or parameters:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Return new Phalcon\Http\Request();</span>
<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span>
    <span class="s2">&quot;request&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Phalcon</span><span class="se">\\</span><span class="s2">Http</span><span class="se">\\</span><span class="s2">Request&quot;</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="class-instances">
<h4>Class instances<a class="headerlink" href="#class-instances" title="Permalink to this headline">¶</a></h4>
<p>This type expects an object. Due to the fact that object does not need to be resolved as it is
already an object, one could say that it is not really a dependency injection,
however it is useful if you want to force the returned dependency to always be
the same object/value:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Http\Request</span><span class="p">;</span>

<span class="c1">// Return new Phalcon\Http\Request();</span>
<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span>
    <span class="s2">&quot;request&quot;</span><span class="p">,</span>
    <span class="k">new</span> <span class="nx">Request</span><span class="p">()</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="closures-anonymous-functions">
<h4>Closures/Anonymous functions<a class="headerlink" href="#closures-anonymous-functions" title="Permalink to this headline">¶</a></h4>
<p>This method offers greater freedom to build the dependency as desired, however, it is difficult to
change some of the parameters externally without having to completely change the definition of dependency:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Db\Adapter\Pdo\Mysql</span> <span class="k">as</span> <span class="nx">PdoMysql</span><span class="p">;</span>

<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span>
    <span class="s2">&quot;db&quot;</span><span class="p">,</span>
    <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">PdoMysql</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;host&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
                <span class="s2">&quot;username&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;root&quot;</span><span class="p">,</span>
                <span class="s2">&quot;password&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;secret&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dbname&quot;</span>   <span class="o">=&gt;</span> <span class="s2">&quot;blog&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Some of the limitations can be overcome by passing additional variables to the closure&#8217;s environment:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Config</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Phalcon\Db\Adapter\Pdo\Mysql</span> <span class="k">as</span> <span class="nx">PdoMysql</span><span class="p">;</span>

<span class="nv">$config</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Config</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="s2">&quot;host&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;username&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
        <span class="s2">&quot;password&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;pass&quot;</span><span class="p">,</span>
        <span class="s2">&quot;dbname&quot;</span>   <span class="o">=&gt;</span> <span class="s2">&quot;my_database&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">);</span>

<span class="c1">// Using the $config variable in the current scope</span>
<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span>
    <span class="s2">&quot;db&quot;</span><span class="p">,</span>
    <span class="k">function</span> <span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$config</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">PdoMysql</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;host&quot;</span>     <span class="o">=&gt;</span> <span class="nv">$config</span><span class="o">-&gt;</span><span class="na">host</span><span class="p">,</span>
                <span class="s2">&quot;username&quot;</span> <span class="o">=&gt;</span> <span class="nv">$config</span><span class="o">-&gt;</span><span class="na">username</span><span class="p">,</span>
                <span class="s2">&quot;password&quot;</span> <span class="o">=&gt;</span> <span class="nv">$config</span><span class="o">-&gt;</span><span class="na">password</span><span class="p">,</span>
                <span class="s2">&quot;dbname&quot;</span>   <span class="o">=&gt;</span> <span class="nv">$config</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
<p>You can also access other DI services using the <code class="code docutils literal"><span class="pre">get()</span></code> method:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Config</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Phalcon\Db\Adapter\Pdo\Mysql</span> <span class="k">as</span> <span class="nx">PdoMysql</span><span class="p">;</span>

<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span>
    <span class="s2">&quot;config&quot;</span><span class="p">,</span>
    <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Config</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;host&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;username&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
                <span class="s2">&quot;password&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;pass&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dbname&quot;</span>   <span class="o">=&gt;</span> <span class="s2">&quot;my_database&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">);</span>

<span class="c1">// Using the &#39;config&#39; service from the DI</span>
<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span>
    <span class="s2">&quot;db&quot;</span><span class="p">,</span>
    <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nv">$config</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;config&quot;</span><span class="p">);</span>

        <span class="k">return</span> <span class="k">new</span> <span class="nx">PdoMysql</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;host&quot;</span>     <span class="o">=&gt;</span> <span class="nv">$config</span><span class="o">-&gt;</span><span class="na">host</span><span class="p">,</span>
                <span class="s2">&quot;username&quot;</span> <span class="o">=&gt;</span> <span class="nv">$config</span><span class="o">-&gt;</span><span class="na">username</span><span class="p">,</span>
                <span class="s2">&quot;password&quot;</span> <span class="o">=&gt;</span> <span class="nv">$config</span><span class="o">-&gt;</span><span class="na">password</span><span class="p">,</span>
                <span class="s2">&quot;dbname&quot;</span>   <span class="o">=&gt;</span> <span class="nv">$config</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="complex-registration">
<h3>Complex Registration<a class="headerlink" href="#complex-registration" title="Permalink to this headline">¶</a></h3>
<p>If it is required to change the definition of a service without instantiating/resolving the service,
then, we need to define the services using the array syntax. Define a service using an array definition
can be a little more verbose:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Logger\Adapter\File</span> <span class="k">as</span> <span class="nx">LoggerFile</span><span class="p">;</span>

<span class="c1">// Register a service &#39;logger&#39; with a class name and its parameters</span>
<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span>
    <span class="s2">&quot;logger&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s2">&quot;className&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Phalcon</span><span class="se">\\</span><span class="s2">Logger</span><span class="se">\\</span><span class="s2">Adapter</span><span class="se">\\</span><span class="s2">File&quot;</span><span class="p">,</span>
        <span class="s2">&quot;arguments&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="p">[</span>
                <span class="s2">&quot;type&quot;</span>  <span class="o">=&gt;</span> <span class="s2">&quot;parameter&quot;</span><span class="p">,</span>
                <span class="s2">&quot;value&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;../apps/logs/error.log&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">]</span>
    <span class="p">]</span>
<span class="p">);</span>

<span class="c1">// Using an anonymous function</span>
<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span>
    <span class="s2">&quot;logger&quot;</span><span class="p">,</span>
    <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">LoggerFile</span><span class="p">(</span><span class="s2">&quot;../apps/logs/error.log&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Both service registrations above produce the same result. The array definition however, allows for alteration of the service parameters if needed:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Change the service class name</span>
<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">getService</span><span class="p">(</span><span class="s2">&quot;logger&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">setClassName</span><span class="p">(</span><span class="s2">&quot;MyCustomLogger&quot;</span><span class="p">);</span>

<span class="c1">// Change the first parameter without instantiating the logger</span>
<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">getService</span><span class="p">(</span><span class="s2">&quot;logger&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s2">&quot;type&quot;</span>  <span class="o">=&gt;</span> <span class="s2">&quot;parameter&quot;</span><span class="p">,</span>
        <span class="s2">&quot;value&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;../apps/logs/error.log&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">);</span>
</pre></div>
</div>
<p>In addition by using the array syntax you can use three types of dependency injection:</p>
<div class="section" id="constructor-injection">
<h4>Constructor Injection<a class="headerlink" href="#constructor-injection" title="Permalink to this headline">¶</a></h4>
<p>This injection type passes the dependencies/arguments to the class constructor.
Let&#8217;s pretend we have the following component:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">SomeApp</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Phalcon\Http\Response</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SomeComponent</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var Response</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$_response</span><span class="p">;</span>

    <span class="k">protected</span> <span class="nv">$_someFlag</span><span class="p">;</span>



    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">Response</span> <span class="nv">$response</span><span class="p">,</span> <span class="nv">$someFlag</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_response</span> <span class="o">=</span> <span class="nv">$response</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_someFlag</span> <span class="o">=</span> <span class="nv">$someFlag</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The service can be registered this way:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span>
    <span class="s2">&quot;response&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s2">&quot;className&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Phalcon</span><span class="se">\\</span><span class="s2">Http</span><span class="se">\\</span><span class="s2">Response&quot;</span>
    <span class="p">]</span>
<span class="p">);</span>

<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span>
    <span class="s2">&quot;someComponent&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s2">&quot;className&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;SomeApp</span><span class="se">\\</span><span class="s2">SomeComponent&quot;</span><span class="p">,</span>
        <span class="s2">&quot;arguments&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="p">[</span>
                <span class="s2">&quot;type&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;service&quot;</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;response&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">[</span>
                <span class="s2">&quot;type&quot;</span>  <span class="o">=&gt;</span> <span class="s2">&quot;parameter&quot;</span><span class="p">,</span>
                <span class="s2">&quot;value&quot;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">]</span>
    <span class="p">]</span>
<span class="p">);</span>
</pre></div>
</div>
<p>The service &#8220;response&#8221; (<a class="reference internal" href="../api/Phalcon_Http_Response.html"><em>Phalcon\Http\Response</em></a>) is resolved to be passed as the first argument of the constructor,
while the second is a boolean value (true) that is passed as it is.</p>
</div>
<div class="section" id="setter-injection">
<h4>Setter Injection<a class="headerlink" href="#setter-injection" title="Permalink to this headline">¶</a></h4>
<p>Classes may have setters to inject optional dependencies, our previous class can be changed to accept the dependencies with setters:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">SomeApp</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Phalcon\Http\Response</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SomeComponent</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var Response</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$_response</span><span class="p">;</span>

    <span class="k">protected</span> <span class="nv">$_someFlag</span><span class="p">;</span>



    <span class="k">public</span> <span class="k">function</span> <span class="nf">setResponse</span><span class="p">(</span><span class="nx">Response</span> <span class="nv">$response</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_response</span> <span class="o">=</span> <span class="nv">$response</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setFlag</span><span class="p">(</span><span class="nv">$someFlag</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_someFlag</span> <span class="o">=</span> <span class="nv">$someFlag</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A service with setter injection can be registered as follows:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span>
    <span class="s2">&quot;response&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s2">&quot;className&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Phalcon</span><span class="se">\\</span><span class="s2">Http</span><span class="se">\\</span><span class="s2">Response&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">);</span>

<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span>
    <span class="s2">&quot;someComponent&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s2">&quot;className&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;SomeApp</span><span class="se">\\</span><span class="s2">SomeComponent&quot;</span><span class="p">,</span>
        <span class="s2">&quot;calls&quot;</span>     <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="p">[</span>
                <span class="s2">&quot;method&quot;</span>    <span class="o">=&gt;</span> <span class="s2">&quot;setResponse&quot;</span><span class="p">,</span>
                <span class="s2">&quot;arguments&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                    <span class="p">[</span>
                        <span class="s2">&quot;type&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;service&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;name&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;response&quot;</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">]</span>
            <span class="p">],</span>
            <span class="p">[</span>
                <span class="s2">&quot;method&quot;</span>    <span class="o">=&gt;</span> <span class="s2">&quot;setFlag&quot;</span><span class="p">,</span>
                <span class="s2">&quot;arguments&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                    <span class="p">[</span>
                        <span class="s2">&quot;type&quot;</span>  <span class="o">=&gt;</span> <span class="s2">&quot;parameter&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;value&quot;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">]</span>
            <span class="p">]</span>
        <span class="p">]</span>
    <span class="p">]</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="properties-injection">
<h4>Properties Injection<a class="headerlink" href="#properties-injection" title="Permalink to this headline">¶</a></h4>
<p>A less common strategy is to inject dependencies or parameters directly into public attributes of the class:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">SomeApp</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Phalcon\Http\Response</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SomeComponent</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$response</span><span class="p">;</span>

    <span class="k">public</span> <span class="nv">$someFlag</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A service with properties injection can be registered as follows:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span>
    <span class="s2">&quot;response&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s2">&quot;className&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Phalcon</span><span class="se">\\</span><span class="s2">Http</span><span class="se">\\</span><span class="s2">Response&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">);</span>

<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span>
    <span class="s2">&quot;someComponent&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s2">&quot;className&quot;</span>  <span class="o">=&gt;</span> <span class="s2">&quot;SomeApp</span><span class="se">\\</span><span class="s2">SomeComponent&quot;</span><span class="p">,</span>
        <span class="s2">&quot;properties&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="p">[</span>
                <span class="s2">&quot;name&quot;</span>  <span class="o">=&gt;</span> <span class="s2">&quot;response&quot;</span><span class="p">,</span>
                <span class="s2">&quot;value&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                    <span class="s2">&quot;type&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;service&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;name&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;response&quot;</span><span class="p">,</span>
                <span class="p">],</span>
            <span class="p">],</span>
            <span class="p">[</span>
                <span class="s2">&quot;name&quot;</span>  <span class="o">=&gt;</span> <span class="s2">&quot;someFlag&quot;</span><span class="p">,</span>
                <span class="s2">&quot;value&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                    <span class="s2">&quot;type&quot;</span>  <span class="o">=&gt;</span> <span class="s2">&quot;parameter&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;value&quot;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
                <span class="p">],</span>
            <span class="p">]</span>
        <span class="p">]</span>
    <span class="p">]</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Supported parameter types include the following:</p>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="38%" />
<col width="54%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Type</th>
<th class="head">Description</th>
<th class="head">Example</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>parameter</td>
<td>Represents a literal value to be passed as parameter</td>
<td><code class="code docutils literal"><span class="pre">[&quot;type&quot;</span> <span class="pre">=&gt;</span> <span class="pre">&quot;parameter&quot;,</span> <span class="pre">&quot;value&quot;</span> <span class="pre">=&gt;</span> <span class="pre">1234]</span></code></td>
</tr>
<tr class="row-odd"><td>service</td>
<td>Represents another service in the service container</td>
<td><code class="code docutils literal"><span class="pre">[&quot;type&quot;</span> <span class="pre">=&gt;</span> <span class="pre">&quot;service&quot;,</span> <span class="pre">&quot;name&quot;</span> <span class="pre">=&gt;</span> <span class="pre">&quot;request&quot;]</span></code></td>
</tr>
<tr class="row-even"><td>instance</td>
<td>Represents an object that must be built dynamically</td>
<td><code class="code docutils literal"><span class="pre">[&quot;type&quot;</span> <span class="pre">=&gt;</span> <span class="pre">&quot;instance&quot;,</span> <span class="pre">&quot;className&quot;</span> <span class="pre">=&gt;</span> <span class="pre">&quot;DateTime&quot;,</span> <span class="pre">&quot;arguments&quot;</span> <span class="pre">=&gt;</span> <span class="pre">[&quot;now&quot;]]</span></code></td>
</tr>
</tbody>
</table>
<p>Resolving a service whose definition is complex may be slightly slower than simple definitions seen previously. However,
these provide a more robust approach to define and inject services.</p>
<p>Mixing different types of definitions is allowed, everyone can decide what is the most appropriate way to register the services
according to the application needs.</p>
</div>
</div>
<div class="section" id="array-syntax">
<h3>Array Syntax<a class="headerlink" href="#array-syntax" title="Permalink to this headline">¶</a></h3>
<p>The array syntax is also allowed to register services:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Di</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Phalcon\Http\Request</span><span class="p">;</span>

<span class="c1">// Create the Dependency Injector Container</span>
<span class="nv">$di</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Di</span><span class="p">();</span>

<span class="c1">// By its class name</span>
<span class="nv">$di</span><span class="p">[</span><span class="s2">&quot;request&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Phalcon</span><span class="se">\\</span><span class="s2">Http</span><span class="se">\\</span><span class="s2">Request&quot;</span><span class="p">;</span>

<span class="c1">// Using an anonymous function, the instance will be lazy loaded</span>
<span class="nv">$di</span><span class="p">[</span><span class="s2">&quot;request&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Request</span><span class="p">();</span>
<span class="p">};</span>

<span class="c1">// Registering an instance directly</span>
<span class="nv">$di</span><span class="p">[</span><span class="s2">&quot;request&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Request</span><span class="p">();</span>

<span class="c1">// Using an array definition</span>
<span class="nv">$di</span><span class="p">[</span><span class="s2">&quot;request&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;className&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Phalcon</span><span class="se">\\</span><span class="s2">Http</span><span class="se">\\</span><span class="s2">Request&quot;</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>
</div>
<p>In the examples above, when the framework needs to access the request data, it will ask for the service identified as ‘request’ in the container.
The container in turn will return an instance of the required service. A developer might eventually replace a component when he/she needs.</p>
<p>Each of the methods (demonstrated in the examples above) used to set/register a service has advantages and disadvantages. It is up to the
developer and the particular requirements that will designate which one is used.</p>
<p>Setting a service by a string is simple, but lacks flexibility. Setting services using an array offers a lot more flexibility, but makes the
code more complicated. The lambda function is a good balance between the two, but could lead to more maintenance than one would expect.</p>
<p><a class="reference internal" href="../api/Phalcon_Di.html"><em>Phalcon\Di</em></a> offers lazy loading for every service it stores. Unless the developer chooses to instantiate an object directly and store it
in the container, any object stored in it (via array, string, etc.) will be lazy loaded i.e. instantiated only when requested.</p>
</div>
</div>
<div class="section" id="resolving-services">
<h2>Resolving Services<a class="headerlink" href="#resolving-services" title="Permalink to this headline">¶</a></h2>
<p>Obtaining a service from the container is a matter of simply calling the &#8220;get&#8221; method. A new instance of the service will be returned:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span> <span class="nv">$request</span> <span class="o">=</span> <span class="nv">$di</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;request&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Or by calling through the magic method:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$request</span> <span class="o">=</span> <span class="nv">$di</span><span class="o">-&gt;</span><span class="na">getRequest</span><span class="p">();</span>
</pre></div>
</div>
<p>Or using the array-access syntax:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$request</span> <span class="o">=</span> <span class="nv">$di</span><span class="p">[</span><span class="s2">&quot;request&quot;</span><span class="p">];</span>
</pre></div>
</div>
<p>Arguments can be passed to the constructor by adding an array parameter to the method &#8220;get&#8221;:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// new MyComponent(&quot;some-parameter&quot;, &quot;other&quot;)</span>
<span class="nv">$component</span> <span class="o">=</span> <span class="nv">$di</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span>
    <span class="s2">&quot;MyComponent&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s2">&quot;some-parameter&quot;</span><span class="p">,</span>
        <span class="s2">&quot;other&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">);</span>
</pre></div>
</div>
<div class="section" id="events">
<h3>Events<a class="headerlink" href="#events" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="../api/Phalcon_Di.html"><em>Phalcon\Di</em></a> is able to send events to an <a class="reference internal" href="events.html"><em>EventsManager</em></a> if it is present.
Events are triggered using the type &#8220;di&#8221;. Some events when returning boolean false could stop the active operation.
The following events are supported:</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="67%" />
<col width="11%" />
<col width="10%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Event Name</th>
<th class="head">Triggered</th>
<th class="head">Can stop operation?</th>
<th class="head">Triggered on</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>beforeServiceResolve</td>
<td>Triggered before resolve service. Listeners receive the service name and the parameters passed to it.</td>
<td>No</td>
<td>Listeners</td>
</tr>
<tr class="row-odd"><td>afterServiceResolve</td>
<td>Triggered after resolve service. Listeners receive the service name, instance, and the parameters passed to it.</td>
<td>No</td>
<td>Listeners</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="shared-services">
<h2>Shared services<a class="headerlink" href="#shared-services" title="Permalink to this headline">¶</a></h2>
<p>Services can be registered as &#8220;shared&#8221; services this means that they always will act as <a class="reference external" href="http://en.wikipedia.org/wiki/Singleton_pattern">singletons</a>. Once the service is resolved for the first time
the same instance of it is returned every time a consumer retrieve the service from the container:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Session\Adapter\Files</span> <span class="k">as</span> <span class="nx">SessionFiles</span><span class="p">;</span>

<span class="c1">// Register the session service as &quot;always shared&quot;</span>
<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">setShared</span><span class="p">(</span>
    <span class="s2">&quot;session&quot;</span><span class="p">,</span>
    <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nv">$session</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SessionFiles</span><span class="p">();</span>

        <span class="nv">$session</span><span class="o">-&gt;</span><span class="na">start</span><span class="p">();</span>

        <span class="k">return</span> <span class="nv">$session</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">);</span>

<span class="c1">// Locates the service for the first time</span>
<span class="nv">$session</span> <span class="o">=</span> <span class="nv">$di</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;session&quot;</span><span class="p">);</span>

<span class="c1">// Returns the first instantiated object</span>
<span class="nv">$session</span> <span class="o">=</span> <span class="nv">$di</span><span class="o">-&gt;</span><span class="na">getSession</span><span class="p">();</span>
</pre></div>
</div>
<p>An alternative way to register shared services is to pass &#8220;true&#8221; as third parameter of &#8220;set&#8221;:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Register the session service as &quot;always shared&quot;</span>
<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span>
    <span class="s2">&quot;session&quot;</span><span class="p">,</span>
    <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">},</span>
    <span class="k">true</span>
<span class="p">);</span>
</pre></div>
</div>
<p>If a service isn&#8217;t registered as shared and you want to be sure that a shared instance will be accessed every time
the service is obtained from the DI, you can use the &#8216;getShared&#8217; method:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$request</span> <span class="o">=</span> <span class="nv">$di</span><span class="o">-&gt;</span><span class="na">getShared</span><span class="p">(</span><span class="s2">&quot;request&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="manipulating-services-individually">
<h2>Manipulating services individually<a class="headerlink" href="#manipulating-services-individually" title="Permalink to this headline">¶</a></h2>
<p>Once a service is registered in the service container, you can retrieve it to manipulate it individually:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Http\Request</span><span class="p">;</span>

<span class="c1">// Register the &quot;request&quot; service</span>
<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s2">&quot;request&quot;</span><span class="p">,</span> <span class="s2">&quot;Phalcon</span><span class="se">\\</span><span class="s2">Http</span><span class="se">\\</span><span class="s2">Request&quot;</span><span class="p">);</span>

<span class="c1">// Get the service</span>
<span class="nv">$requestService</span> <span class="o">=</span> <span class="nv">$di</span><span class="o">-&gt;</span><span class="na">getService</span><span class="p">(</span><span class="s2">&quot;request&quot;</span><span class="p">);</span>

<span class="c1">// Change its definition</span>
<span class="nv">$requestService</span><span class="o">-&gt;</span><span class="na">setDefinition</span><span class="p">(</span>
    <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Request</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">);</span>

<span class="c1">// Change it to shared</span>
<span class="nv">$requestService</span><span class="o">-&gt;</span><span class="na">setShared</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>

<span class="c1">// Resolve the service (return a Phalcon\Http\Request instance)</span>
<span class="nv">$request</span> <span class="o">=</span> <span class="nv">$requestService</span><span class="o">-&gt;</span><span class="na">resolve</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="instantiating-classes-via-the-service-container">
<h2>Instantiating classes via the Service Container<a class="headerlink" href="#instantiating-classes-via-the-service-container" title="Permalink to this headline">¶</a></h2>
<p>When you request a service to the service container, if it can&#8217;t find out a service with the same name it&#8217;ll try to load a class with
the same name. With this behavior we can replace any class by another simply by registering a service with its name:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Register a controller as a service</span>
<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span>
    <span class="s2">&quot;IndexController&quot;</span><span class="p">,</span>
    <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nv">$component</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Component</span><span class="p">();</span>

        <span class="k">return</span> <span class="nv">$component</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="k">true</span>
<span class="p">);</span>

<span class="c1">// Register a controller as a service</span>
<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span>
    <span class="s2">&quot;MyOtherComponent&quot;</span><span class="p">,</span>
    <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Actually returns another component</span>
        <span class="nv">$component</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AnotherComponent</span><span class="p">();</span>

        <span class="k">return</span> <span class="nv">$component</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">);</span>

<span class="c1">// Create an instance via the service container</span>
<span class="nv">$myComponent</span> <span class="o">=</span> <span class="nv">$di</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;MyOtherComponent&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>You can take advantage of this, always instantiating your classes via the service container (even if they aren&#8217;t registered as services). The DI will
fallback to a valid autoloader to finally load the class. By doing this, you can easily replace any class in the future by implementing a definition
for it.</p>
</div>
<div class="section" id="automatic-injecting-of-the-di-itself">
<h2>Automatic Injecting of the DI itself<a class="headerlink" href="#automatic-injecting-of-the-di-itself" title="Permalink to this headline">¶</a></h2>
<p>If a class or component requires the DI itself to locate services, the DI can automatically inject itself to the instances it creates,
to do this, you need to implement the <a class="reference internal" href="../api/Phalcon_Di_InjectionAwareInterface.html"><em>Phalcon\Di\InjectionAwareInterface</em></a> in your classes:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\DiInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Phalcon\Di\InjectionAwareInterface</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyClass</span> <span class="k">implements</span> <span class="nx">InjectionAwareInterface</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var DiInterface</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$_di</span><span class="p">;</span>



    <span class="k">public</span> <span class="k">function</span> <span class="nf">setDi</span><span class="p">(</span><span class="nx">DiInterface</span> <span class="nv">$di</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_di</span> <span class="o">=</span> <span class="nv">$di</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getDi</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_di</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Then once the service is resolved, the <code class="code docutils literal"><span class="pre">$di</span></code> will be passed to <code class="code docutils literal"><span class="pre">setDi()</span></code> automatically:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Register the service</span>
<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s2">&quot;myClass&quot;</span><span class="p">,</span> <span class="s2">&quot;MyClass&quot;</span><span class="p">);</span>

<span class="c1">// Resolve the service (NOTE: $myClass-&gt;setDi($di) is automatically called)</span>
<span class="nv">$myClass</span> <span class="o">=</span> <span class="nv">$di</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;myClass&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="organizing-services-in-files">
<h2>Organizing services in files<a class="headerlink" href="#organizing-services-in-files" title="Permalink to this headline">¶</a></h2>
<p>You can better organize your application by moving the service registration to individual files instead of
doing everything in the application&#8217;s bootstrap:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span>
    <span class="s2">&quot;router&quot;</span><span class="p">,</span>
    <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">include</span> <span class="s2">&quot;../app/config/routes.php&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Then in the file (&#8221;../app/config/routes.php&#8221;) return the object resolved:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$router</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyRouter</span><span class="p">();</span>

<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s2">&quot;/login&quot;</span><span class="p">);</span>

<span class="k">return</span> <span class="nv">$router</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="accessing-the-di-in-a-static-way">
<h2>Accessing the DI in a static way<a class="headerlink" href="#accessing-the-di-in-a-static-way" title="Permalink to this headline">¶</a></h2>
<p>If needed you can access the latest DI created in a static function in the following way:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Di</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SomeComponent</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">someMethod</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Get the session service</span>
        <span class="nv">$session</span> <span class="o">=</span> <span class="nx">Di</span><span class="o">::</span><span class="na">getDefault</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getSession</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="factory-default-di">
<h2>Factory Default DI<a class="headerlink" href="#factory-default-di" title="Permalink to this headline">¶</a></h2>
<p>Although the decoupled character of Phalcon offers us great freedom and flexibility, maybe we just simply want to use it as a full-stack
framework. To achieve this, the framework provides a variant of <a class="reference internal" href="../api/Phalcon_Di.html"><em>Phalcon\Di</em></a> called <a class="reference internal" href="../api/Phalcon_Di_FactoryDefault.html"><em>Phalcon\Di\FactoryDefault</em></a>. This class automatically
registers the appropriate services bundled with the framework to act as full-stack.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Di\FactoryDefault</span><span class="p">;</span>

<span class="nv">$di</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FactoryDefault</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="service-name-conventions">
<h2>Service Name Conventions<a class="headerlink" href="#service-name-conventions" title="Permalink to this headline">¶</a></h2>
<p>Although you can register services with the names you want, Phalcon has a several naming conventions that allow it to get the
the correct (built-in) service when you need it.</p>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="26%" />
<col width="57%" />
<col width="5%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Service Name</th>
<th class="head">Description</th>
<th class="head">Default</th>
<th class="head">Shared</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>dispatcher</td>
<td>Controllers Dispatching Service</td>
<td><a class="reference internal" href="../api/Phalcon_Mvc_Dispatcher.html"><em>Phalcon\Mvc\Dispatcher</em></a></td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>router</td>
<td>Routing Service</td>
<td><a class="reference internal" href="../api/Phalcon_Mvc_Router.html"><em>Phalcon\Mvc\Router</em></a></td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>url</td>
<td>URL Generator Service</td>
<td><a class="reference internal" href="../api/Phalcon_Mvc_Url.html"><em>Phalcon\Mvc\Url</em></a></td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>request</td>
<td>HTTP Request Environment Service</td>
<td><a class="reference internal" href="../api/Phalcon_Http_Request.html"><em>Phalcon\Http\Request</em></a></td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>response</td>
<td>HTTP Response Environment Service</td>
<td><a class="reference internal" href="../api/Phalcon_Http_Response.html"><em>Phalcon\Http\Response</em></a></td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>cookies</td>
<td>HTTP Cookies Management Service</td>
<td><a class="reference internal" href="../api/Phalcon_Http_Response_Cookies.html"><em>Phalcon\Http\Response\Cookies</em></a></td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>filter</td>
<td>Input Filtering Service</td>
<td><a class="reference internal" href="../api/Phalcon_Filter.html"><em>Phalcon\Filter</em></a></td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>flash</td>
<td>Flash Messaging Service</td>
<td><a class="reference internal" href="../api/Phalcon_Flash_Direct.html"><em>Phalcon\Flash\Direct</em></a></td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>flashSession</td>
<td>Flash Session Messaging Service</td>
<td><a class="reference internal" href="../api/Phalcon_Flash_Session.html"><em>Phalcon\Flash\Session</em></a></td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>session</td>
<td>Session Service</td>
<td><a class="reference internal" href="../api/Phalcon_Session_Adapter_Files.html"><em>Phalcon\Session\Adapter\Files</em></a></td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>eventsManager</td>
<td>Events Management Service</td>
<td><a class="reference internal" href="../api/Phalcon_Events_Manager.html"><em>Phalcon\Events\Manager</em></a></td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>db</td>
<td>Low-Level Database Connection Service</td>
<td><a class="reference internal" href="../api/Phalcon_Db.html"><em>Phalcon\Db</em></a></td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>security</td>
<td>Security helpers</td>
<td><a class="reference internal" href="../api/Phalcon_Security.html"><em>Phalcon\Security</em></a></td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>crypt</td>
<td>Encrypt/Decrypt data</td>
<td><a class="reference internal" href="../api/Phalcon_Crypt.html"><em>Phalcon\Crypt</em></a></td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>tag</td>
<td>HTML generation helpers</td>
<td><a class="reference internal" href="../api/Phalcon_Tag.html"><em>Phalcon\Tag</em></a></td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>escaper</td>
<td>Contextual Escaping</td>
<td><a class="reference internal" href="../api/Phalcon_Escaper.html"><em>Phalcon\Escaper</em></a></td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>annotations</td>
<td>Annotations Parser</td>
<td><a class="reference internal" href="../api/Phalcon_Annotations_Adapter_Memory.html"><em>Phalcon\Annotations\Adapter\Memory</em></a></td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>modelsManager</td>
<td>Models Management Service</td>
<td><a class="reference internal" href="../api/Phalcon_Mvc_Model_Manager.html"><em>Phalcon\Mvc\Model\Manager</em></a></td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>modelsMetadata</td>
<td>Models Meta-Data Service</td>
<td><a class="reference internal" href="../api/Phalcon_Mvc_Model_MetaData_Memory.html"><em>Phalcon\Mvc\Model\MetaData\Memory</em></a></td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>transactionManager</td>
<td>Models Transaction Manager Service</td>
<td><a class="reference internal" href="../api/Phalcon_Mvc_Model_Transaction_Manager.html"><em>Phalcon\Mvc\Model\Transaction\Manager</em></a></td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>modelsCache</td>
<td>Cache backend for models cache</td>
<td>None</td>
<td>No</td>
</tr>
<tr class="row-odd"><td>viewsCache</td>
<td>Cache backend for views fragments</td>
<td>None</td>
<td>No</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="implementing-your-own-di">
<h2>Implementing your own DI<a class="headerlink" href="#implementing-your-own-di" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="../api/Phalcon_DiInterface.html"><em>Phalcon\DiInterface</em></a> interface must be implemented to create your own DI replacing the one provided by Phalcon or extend the current one.</p>
</div>
</div>


                    </div>
                  </div>
                </div>
            </div>
          </td>
        </tr>
      </table>
    <div class="related">
      <ul>
        <li class="right" >
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="mvc.html" title="The MVC Architecture"
             >next</a> |</li>
        <li class="right" >
          <a href="samples.html" title="List of examples"
             >previous</a> |</li> 
      </ul>
    </div>

      <div class="prefooter">
  <div class="container">
      <div class="row">
          <div class="col-sm-3 text-right">
              <span>Follow along:</span>
          </div>
          <div class="col-sm-6 text-center">
              <a href="https://twitter.com/phalconphp" alt="Twitter" class="btn-social btn-social-twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i></a>
              <a href="https://www.facebook.com/pages/Phalcon-Framework/134230726685897" alt="Facebook" class="btn-social btn-social-facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i></a>
              <a href="https://plus.google.com/102376109340560896457" alt="Google+" class="btn-social btn-social-googleplus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i></a>
              <a href="https://github.com/phalcon/cphalcon" alt="Github" class="btn-social btn-social-github"><i class="fa fa-fw fa-github" aria-hidden="true"></i></a>
          </div>
          <div class="col-sm-3">
          </div>
      </div>
  </div>
</div>

<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-xs-4 col-sm-3">
                <h4>Download</h4>
                <ul>
                    <li><a href="https://phalconphp.com/download">Installing Phalcon PHP</a></li>
                    <li><a href="https://docs.phalconphp.com/en/latest/index.html" class="header-nav-link" target="_blank">Documentation</a></li>
                    <li><a href="https://api.phalconphp.com">API</a></li>
                    <li><a href="https://docs.phalconphp.com/en/latest/reference/tutorial.html">Tutorial</a></li>
                    <li><a href="https://docs.phalconphp.com/en/latest/reference/tutorial.html#sample-applications">Sample Applications</a></li>
                </ul>
            </div>
            <div class="col-xs-4 col-sm-3">
                <h4>Community</h4>
                <ul>
                    <li><a href="https://forum.phalconphp.com/" class="header-nav-link" target="_blank">Forum</a></li>
                    <li><a href="https://github.com/phalcon/cphalcon">GitHub</a></li>
                    <li><a href="https://github.com/phalcon/cphalcon/issues">Issue Tracker</a></li>
                    <li><a href="https://stackoverflow.com/questions/tagged/phalcon">Stack Overflow</a></li>
                    <li><a href="https://phalconphp.com/en/testimonials">Testimonials</a></li>
                    <li><a href="https://builtwith.phalconphp.com/">Built with Phalcon</a></li>
                    <li><a href="https://store.phalconphp.com/">Store</a></li>
                </ul>
            </div>
            <div class="col-xs-4 col-sm-2">
                <h4>About</h4>
                <ul>
                    <li><a class="link-black" href="http://blog.phalconphp.com/">Blog</a></li>
                    <li><a href="https://phalconphp.com/en/about">About</a></li>
                    <li><a href="https://phalconphp.com/en/team">Team</a></li>
                    <li><a href="https://phalconphp.com/en/roadmap">Roadmap</a></li>
                    <li><a href="https://phalconphp.com/en/donate">Donate</a></li>
                    <li><a href="https://phalconphp.com/en/consulting">Consulting</a></li>
                    <li><a href="https://phalconphp.com/en/hosting">Hosting</a></li>
                </ul>
            </div>
            <div id="license-spaccer" class="visible-xs"></div>
            <div id="license-wrapper" class="col-xs-12 col-sm-4">
                <p class="license">
                    Phalcon is an open-source PHP framework <br />
                    built as a C-extension. It is available under the <br />
                    <a href="http://opensource.org/licenses/BSD-3-Clause" target="_blank">new BSD License</a>.
                </p>

                <div class="design">
                    <span>Website Designed by:</span>
                </div>
                <a class="license" href="http://loudertech.com/" target="_blank" title="">
                    <span>LouderTech SAS</span>
                </a>
            </div>
        </div>
    </div>
</footer>

    </div>
    <script type="text/javascript">
    $(window).on("load", function(){
      var cx = '009733439235723428699:lh9ltjgvdz8';
      var gcse = document.createElement('script');
      gcse.type = 'text/javascript';
      gcse.async = true;
      gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cx=' + cx;
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(gcse, s);
    });
    </script>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://static.phalconphp.com/www/js/plugins/jquery.lazyload.min.js"></script>
    <script src="https://static.phalconphp.com/www/js/plugins/jquery.magnific-popup.min.js"></script>
    <script src="https://static.phalconphp.com/www/js/plugins/highlight.pack.js"></script>
    <script src="https://static.phalconphp.com/www/js/plugins/jquery.ajaxchimp.min.js"></script>
    <script src="https://static.phalconphp.com/www/js/plugins/jquery.backstretch.min.js"></script>
    <script src="https://static.phalconphp.com/www/js/custom.js"></script>

  </body>
</html>