
<!DOCTYPE html>

<html lang="en">
  <head>
    
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>教程 1：让我们通过例子来学习（Tutorial 1: Let’s learn by example） &mdash; Phalcon 1.3.0 documentation</title>
    <link href='http://fonts.googleapis.com/css?family=Ubuntu:400,500,700,300italic,400italic,500italic&amp;subset=latin,cyrillic-ext' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/docs.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.3.0',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/docs.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Phalcon 1.3.0 documentation" href="../index.html" />
    <link rel="next" title="教程 2：INVO 项目讲解（Tutorial 2: Explaining INVO）" href="tutorial-invo.html" />
    <link rel="prev" title="使用 PHP 内置 web 服务器（Using PHP Built-in webserver）" href="built-in.html" /> 
  </head>
  <body>
    <div id="wrapper">

        <div class="size-wrap">

            <div class="header clear-fix">
                <a class="header-logo" href="http://phalconphp.com"><span class="logo-text">Phalcon</span></a>
                <div class="header-right">
                    <iframe src="http://ghbtns.com/github-btn.html?user=phalcon&amp;repo=cphalcon&amp;type=watch&amp;count=true&amp;size=large"
allowtransparency="true" frameborder="0" scrolling="0" width="152px" height="30px"></iframe>
                </div>
                <ul class="header-nav">
                    <li><a href="http://phalconphp.com/" class="header-nav-link">Home</a></li>
                    <li><a href="http://phalconphp.com/download" class="header-nav-link">Download</a></li>
                    <li><a href="http://forum.phalconphp.com/" class="header-nav-link active">Forum</a></li>
                    <li><a href="http://blog.phalconphp.com/" class="header-nav-link">Blog</a></li>
                    <li><a href="http://phalconphp.com/support" class="header-nav-link">Support</a></li>
                    <li><a href="http://store.phalconphp.com/" class="header-nav-link">Store</a></li>
                    <li><a href="https://github.com/phalcon/cphalcon" class="header-nav-link">GitHub</a></li>
                </ul>
            </div>

        </div>
    <div class="header-line">
      <div class="size-wrap">
        <div class="header-line-title title-white">Documentation</div>
      </div>
    </div>
    <div class="related">
      <ul>
        <li class="right" >
          <a href="../genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="tutorial-invo.html" title="教程 2：INVO 项目讲解（Tutorial 2: Explaining INVO）"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="built-in.html" title="使用 PHP 内置 web 服务器（Using PHP Built-in webserver）"
             accesskey="P">上一页</a> |</li>
        <li><a href="http://phalconphp.com">Home</a> &raquo;</li>
        <li><a href="../index.html">Phalcon 1.3.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

      <table width="90%" align="center">
        <tr>
      <td class="primary-box" width="25%" valign="top">
            <div>
            <div id="searchbox" style="">
                <!--<form class="search" action="http://readthedocs.org/search/project/" method="get">
                  <input type="search" name="q" size="25" placeholder="Search">
                  <input type="submit" value="Go">
                  <input type="hidden" name="selected_facets" value="project:">
                </form>-->
                <div style="width:200px;padding:10px">
                  <gcse:searchbox-only></gcse:searchbox-only>
                </div>
                <hr>
            </div>
            </div>
            <div style="padding:5px;padding-left:10px">
              <div id="carbonads-container">
                <div class="carbonad"><div id="azcarbon"></div>
                <script type="text/javascript">var z = document.createElement("script"); z.type = "text/javascript"; z.async = true; z.src = "http://engine.carbonads.com/z/56496/azcarbon_2_1_0_VERT"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(z, s);</script>
                </div></div>
            </div>
            <h3><a href="../index.html">內容目录</a></h3>
            <ul>
<li><a class="reference internal" href="#">教程 1：让我们通过例子来学习（Tutorial 1: Let&#8217;s learn by example）</a><ul>
<li><a class="reference internal" href="#checking-your-installation">确认安装（Checking your installation）</a></li>
<li><a class="reference internal" href="#creating-a-project">创建项目（Creating a project）</a><ul>
<li><a class="reference internal" href="#file-structure">文件结构（File structure）</a></li>
<li><a class="reference internal" href="#url-beautiful-urls">优美的 URL（Beautiful URLs）</a></li>
<li><a class="reference internal" href="#bootstrap">引导程序（Bootstrap）</a></li>
<li><a class="reference internal" href="#autoloaders">自动加载（Autoloaders）</a></li>
<li><a class="reference internal" href="#dependency-management">依赖管理（Dependency Management）</a></li>
<li><a class="reference internal" href="#creating-a-controller">创建控制器（Creating a Controller）</a></li>
<li><a class="reference internal" href="#sending-output-to-a-view">输出到视图（Sending output to a view）</a></li>
<li><a class="reference internal" href="#designing-a-sign-up-form">设计注册表单（Designing a sign up form）</a></li>
<li><a class="reference internal" href="#creating-a-model">创建模型（Creating a Model）</a></li>
<li><a class="reference internal" href="#setting-a-database-connection">设置数据库连接（Setting a Database Connection）</a></li>
<li><a class="reference internal" href="#storing-data-using-models">使用模型保存数据（Storing data using models）</a></li>
</ul>
</li>
<li><a class="reference internal" href="#conclusion">结束语（Conclusion）</a></li>
<li><a class="reference internal" href="#sample-applications">一些应用（Sample Applications）</a></li>
</ul>
</li>
</ul>

            <h4>上一个主题</h4>
            <p class="topless"><a href="built-in.html" title="上一章">&lt; 使用 PHP 内置 web 服务器（Using PHP Built-in webserver）</a></p>
            <h4>下一个主题</h4>
            <p class="topless"><a href="tutorial-invo.html" title="下一章">教程 2：INVO 项目讲解（Tutorial 2: Explaining INVO） &gt;</a></p>
            <h3>本页</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/reference/tutorial.txt" rel="nofollow">显示源代码</a></li>
            </ul>
        </td>
          <td class="second-box" valign="top">
            <div class="document">
                <div class="documentwrapper">
                  <div class="bodywrapper">
                    <div class="body" >
                      
  <div class="section" id="tutorial-1-let-s-learn-by-example">
<h1>教程 1：让我们通过例子来学习（Tutorial 1: Let&#8217;s learn by example）<a class="headerlink" href="#tutorial-1-let-s-learn-by-example" title="永久链接至标题">¶</a></h1>
<p>Throughout this first tutorial, we&#8217;ll walk you through the creation of an application with a simple registration form from the ground up.
We will also explain the basic aspects of the framework&#8217;s behavior. If you are interested in automatic code generation tools for Phalcon,
you can check our <a class="reference internal" href="tools.html"><em>developer tools</em></a>.</p>
<div class="section" id="checking-your-installation">
<h2>确认安装（Checking your installation）<a class="headerlink" href="#checking-your-installation" title="永久链接至标题">¶</a></h2>
<p>We&#8217;ll assume you have Phalcon installed already. Check your phpinfo() output for a section referencing &#8220;Phalcon&#8221; or execute the
code snippet below:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span> <span class="nb">print_r</span><span class="p">(</span><span class="nb">get_loaded_extensions</span><span class="p">());</span> <span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>The Phalcon extension should appear as part of the output:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">Array</span>
<span class="x">(</span>
<span class="x">    [0] =&gt; Core</span>
<span class="x">    [1] =&gt; libxml</span>
<span class="x">    [2] =&gt; filter</span>
<span class="x">    [3] =&gt; SPL</span>
<span class="x">    [4] =&gt; standard</span>
<span class="x">    [5] =&gt; phalcon</span>
<span class="x">    [6] =&gt; pdo_mysql</span>
<span class="x">)</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-a-project">
<h2>创建项目（Creating a project）<a class="headerlink" href="#creating-a-project" title="永久链接至标题">¶</a></h2>
<p>The best way to use this guide is to follow each step in turn. You can get the complete code <a class="reference external" href="https://github.com/phalcon/tutorial">here</a>.</p>
<div class="section" id="file-structure">
<h3>文件结构（File structure）<a class="headerlink" href="#file-structure" title="永久链接至标题">¶</a></h3>
<p>Phalcon does not impose a particular file structure for application development. Due to the fact that it is loosely coupled, you can implement Phalcon powered applications with a file structure you are most comfortable using.</p>
<p>For the purposes of this tutorial and as a starting point, we suggest the following structure:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">tutorial/</span>
<span class="x">  app/</span>
<span class="x">    controllers/</span>
<span class="x">    models/</span>
<span class="x">    views/</span>
<span class="x">  public/</span>
<span class="x">    css/</span>
<span class="x">    img/</span>
<span class="x">    js/</span>
</pre></div>
</div>
<p>Note that you don&#8217;t need any &#8220;library&#8221; directory related to Phalcon. The framework is available in memory, ready for you to use.</p>
</div>
<div class="section" id="url-beautiful-urls">
<h3>优美的 URL（Beautiful URLs）<a class="headerlink" href="#url-beautiful-urls" title="永久链接至标题">¶</a></h3>
<p>We&#8217;ll use pretty (friendly) URLs for this tutorial. Friendly URLs are better for SEO as well as being easy for users to remember. Phalcon supports rewrite modules provided by the most popular web servers. Making your application&#8217;s URLs friendly is not a requirement and you can just as easily develop without them.</p>
<p>In this example we&#8217;ll use the rewrite module for Apache. Let&#8217;s create a couple of rewrite rules in the /tutorial/.htaccess file:</p>
<div class="highlight-apacheconf"><div class="highlight"><pre><span class="c">#/tutorial/.htaccess</span>
<span class="nt">&lt;IfModule</span> <span class="s">mod_rewrite.c</span><span class="nt">&gt;</span>
    <span class="nb">RewriteEngine</span> <span class="k">on</span>
    <span class="nb">RewriteRule</span>  ^$ public/    [L]
    <span class="nb">RewriteRule</span>  (.*) public/$1 [L]
<span class="nt">&lt;/IfModule&gt;</span>
</pre></div>
</div>
<p>All requests to the project will be rewritten to the public/ directory making it the document root. This step ensures that the internal project folders remain hidden from public viewing and thus eliminates security threats of this kind.</p>
<p>The second set of rules will check if the requested file exists and, if it does, it doesn&#8217;t have to be rewritten by the web server module:</p>
<div class="highlight-apacheconf"><div class="highlight"><pre><span class="c">#/tutorial/public/.htaccess</span>
<span class="nt">&lt;IfModule</span> <span class="s">mod_rewrite.c</span><span class="nt">&gt;</span>
    <span class="nb">RewriteEngine</span> <span class="k">On</span>
    <span class="nb">RewriteCond</span> %{REQUEST_FILENAME} !-d
    <span class="nb">RewriteCond</span> %{REQUEST_FILENAME} !-f
    <span class="nb">RewriteRule</span> ^(.*)$ index.php?_url=/$1 [QSA,L]
<span class="nt">&lt;/IfModule&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="bootstrap">
<h3>引导程序（Bootstrap）<a class="headerlink" href="#bootstrap" title="永久链接至标题">¶</a></h3>
<p>The first file you need to create is the bootstrap file. This file is very important; since it serves as the base of your application, giving you control of all aspects of it. In this file you can implement initialization of components as well as application behavior.</p>
<p>The tutorial/public/index.php file should look like:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">try</span> <span class="p">{</span>

    <span class="c1">//Register an autoloader</span>
    <span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Loader</span><span class="p">();</span>
    <span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">registerDirs</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;../app/controllers/&#39;</span><span class="p">,</span>
        <span class="s1">&#39;../app/models/&#39;</span>
    <span class="p">))</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">();</span>

    <span class="c1">//Create a DI</span>
    <span class="nv">$di</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Phalcon\DI\FactoryDefault</span><span class="p">();</span>

    <span class="c1">//Setup the view component</span>
    <span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;view&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(){</span>
        <span class="nv">$view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Mvc\View</span><span class="p">();</span>
        <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">setViewsDir</span><span class="p">(</span><span class="s1">&#39;../app/views/&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$view</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="c1">//Setup a base URI so that all generated URIs include the &quot;tutorial&quot; folder</span>
    <span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(){</span>
        <span class="nv">$url</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Mvc\Url</span><span class="p">();</span>
        <span class="nv">$url</span><span class="o">-&gt;</span><span class="na">setBaseUri</span><span class="p">(</span><span class="s1">&#39;/tutorial/&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$url</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="c1">//Handle the request</span>
    <span class="nv">$application</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Mvc\Application</span><span class="p">(</span><span class="nv">$di</span><span class="p">);</span>

    <span class="k">echo</span> <span class="nv">$application</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getContent</span><span class="p">();</span>

<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">\Phalcon\Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">echo</span> <span class="s2">&quot;PhalconException: &quot;</span><span class="p">,</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="autoloaders">
<h3>自动加载（Autoloaders）<a class="headerlink" href="#autoloaders" title="永久链接至标题">¶</a></h3>
<p>The first part that we find in the bootstrap is registering an autoloader. This will be used to load classes as controllers and models in the application. For example we may register one or more directories of controllers increasing the flexibility of the application. In our example we have used the component Phalcon\Loader.</p>
<p>With it, we can load classes using various strategies but for this example we have chosen to locate classes based on predefined directories:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Loader</span><span class="p">();</span>
<span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">registerDirs</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;../app/controllers/&#39;</span><span class="p">,</span>
        <span class="s1">&#39;../app/models/&#39;</span>
    <span class="p">)</span>
<span class="p">)</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="dependency-management">
<h3>依赖管理（Dependency Management）<a class="headerlink" href="#dependency-management" title="永久链接至标题">¶</a></h3>
<p>A very important concept that must be understood when working with Phalcon is its <a class="reference internal" href="di.html"><em>dependency injection container</em></a>. It may sound complex but is actually very simple and practical.</p>
<p>A service container is a bag where we globally store the services that our application will use to function. Each time the framework requires a component, it will ask the container using an agreed upon name for the service. Since Phalcon is a highly decoupled framework, Phalcon\DI acts as glue facilitating the integration of the different components achieving their work together in a transparent manner.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">//Create a DI</span>
<span class="nv">$di</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Phalcon\DI\FactoryDefault</span><span class="p">();</span>
</pre></div>
</div>
<p><a class="reference internal" href="../api/Phalcon_DI_FactoryDefault.html"><em>Phalcon\DI\FactoryDefault</em></a> is a variant of Phalcon\DI. To make things easier, it has registered most of the components that come with Phalcon. Thus we should not register them one by one. Later there will be no problem in replacing a factory service.</p>
<p>In the next part, we register the &#8220;view&#8221; service indicating the directory where the framework will find the views files. As the views do not correspond to classes, they cannot be charged with an autoloader.</p>
<p>Services can be registered in several ways, but for our tutorial we&#8217;ll use an <a class="reference external" href="http://php.net/manual/en/functions.anonymous.php">anonymous function</a>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">//Setup the view component</span>
<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;view&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(){</span>
    <span class="nv">$view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Mvc\View</span><span class="p">();</span>
    <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">setViewsDir</span><span class="p">(</span><span class="s1">&#39;../app/views/&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$view</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Next we register a base URI so that all URIs generated by Phalcon include the &#8220;tutorial&#8221; folder we setup earlier. This will become important later on in this tutorial when we use the class <a class="reference internal" href="../api/Phalcon_Tag.html"><em>Phalcon\Tag</em></a> to generate a hyperlink.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">//Setup a base URI so that all generated URIs include the &quot;tutorial&quot; folder</span>
<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(){</span>
    <span class="nv">$url</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Mvc\Url</span><span class="p">();</span>
    <span class="nv">$url</span><span class="o">-&gt;</span><span class="na">setBaseUri</span><span class="p">(</span><span class="s1">&#39;/tutorial/&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$url</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>In the last part of this file, we find <a class="reference internal" href="../api/Phalcon_Mvc_Application.html"><em>Phalcon\Mvc\Application</em></a>. Its purpose is to initialize the request environment, route the incoming request, and then dispatch any discovered actions; it aggregates any responses and returns them when the process is complete.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$application</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Mvc\Application</span><span class="p">(</span><span class="nv">$di</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$application</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getContent</span><span class="p">();</span>
</pre></div>
</div>
<p>As you can see, the bootstrap file is very short and we do not need to include any additional files. We have set ourselves a flexible MVC application in less than 30 lines of code.</p>
</div>
<div class="section" id="creating-a-controller">
<h3>创建控制器（Creating a Controller）<a class="headerlink" href="#creating-a-controller" title="永久链接至标题">¶</a></h3>
<p>By default Phalcon will look for a controller named &#8220;Index&#8221;. It is the starting point when no controller or action has been passed in the request. The index controller (app/controllers/IndexController.php) looks like:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">IndexController</span> <span class="k">extends</span> <span class="nx">\Phalcon\Mvc\Controller</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">indexAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">&quot;&lt;h1&gt;Hello!&lt;/h1&gt;&quot;</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>The controller classes must have the suffix &#8220;Controller&#8221; and controller actions must have the suffix &#8220;Action&#8221;. If you access the application from your browser, you should see something like this:</p>
<div class="figure align-center">
<img alt="../_images/tutorial-1.png" src="../_images/tutorial-1.png" />
</div>
<p>Congratulations, you&#8217;re flying with Phalcon!</p>
</div>
<div class="section" id="sending-output-to-a-view">
<h3>输出到视图（Sending output to a view）<a class="headerlink" href="#sending-output-to-a-view" title="永久链接至标题">¶</a></h3>
<p>Sending output to the screen from the controller is at times necessary but not desirable as most purists in the MVC community will attest. Everything must be passed to the view that is responsible for outputting data on screen. Phalcon will look for a view with the same name as the last executed action inside a directory named as the last executed controller. In our case (app/views/index/index.phtml):</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="s2">&quot;&lt;h1&gt;Hello!&lt;/h1&gt;&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>Our controller (app/controllers/IndexController.php) now has an empty action definition:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">IndexController</span> <span class="k">extends</span> <span class="nx">\Phalcon\Mvc\Controller</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">indexAction</span><span class="p">()</span>
    <span class="p">{</span>

    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>The browser output should remain the same. The <a class="reference internal" href="../api/Phalcon_Mvc_View.html"><em>Phalcon\Mvc\View</em></a> static component is automatically created when the action execution has ended. Learn more about <a class="reference internal" href="views.html"><em>views usage here</em></a> .</p>
</div>
<div class="section" id="designing-a-sign-up-form">
<h3>设计注册表单（Designing a sign up form）<a class="headerlink" href="#designing-a-sign-up-form" title="永久链接至标题">¶</a></h3>
<p>Now we will change the index.phtml view file, to add a link to a new controller named &#8220;signup&#8221;. The goal is to allow users to sign up within our application.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">echo</span> <span class="s2">&quot;&lt;h1&gt;Hello!&lt;/h1&gt;&quot;</span><span class="p">;</span>

<span class="k">echo</span> <span class="nx">Phalcon\Tag</span><span class="o">::</span><span class="na">linkTo</span><span class="p">(</span><span class="s2">&quot;signup&quot;</span><span class="p">,</span> <span class="s2">&quot;Sign Up Here!&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>The generated HTML code displays an anchor (&#8220;a&#8221;) HTML tag linking to a new controller:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Hello!<span class="nt">&lt;/h1&gt;</span> <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/tutorial/signup&quot;</span><span class="nt">&gt;</span>Sign Up Here!<span class="nt">&lt;/a&gt;</span>
</pre></div>
</div>
<p>To generate the tag we use the class <a class="reference internal" href="../api/Phalcon_Tag.html"><em>Phalcon\Tag</em></a>. This is a utility class that allows us to build HTML tags with framework conventions in mind. A more detailed article regarding HTML generation can be <a class="reference internal" href="tags.html"><em>found here</em></a></p>
<div class="figure align-center">
<img alt="../_images/tutorial-2.png" src="../_images/tutorial-2.png" />
</div>
<p>Here is the Signup controller (app/controllers/SignupController.php):</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">SignupController</span> <span class="k">extends</span> <span class="nx">\Phalcon\Mvc\Controller</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">indexAction</span><span class="p">()</span>
    <span class="p">{</span>

    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>The empty index action gives the clean pass to a view with the form definition (app/views/signup/index.phtml):</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span> <span class="k">use</span> <span class="nx">Phalcon\Tag</span><span class="p">;</span> <span class="cp">?&gt;</span>

<span class="nt">&lt;h2&gt;</span>Sign up using this form<span class="nt">&lt;/h2&gt;</span>

<span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nx">Tag</span><span class="o">::</span><span class="na">form</span><span class="p">(</span><span class="s2">&quot;signup/register&quot;</span><span class="p">);</span> <span class="cp">?&gt;</span>

 <span class="nt">&lt;p&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Name<span class="nt">&lt;/label&gt;</span>
    <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nx">Tag</span><span class="o">::</span><span class="na">textField</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="cp">?&gt;</span>
 <span class="nt">&lt;/p&gt;</span>

 <span class="nt">&lt;p&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;email&quot;</span><span class="nt">&gt;</span>E-Mail<span class="nt">&lt;/label&gt;</span>
    <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nx">Tag</span><span class="o">::</span><span class="na">textField</span><span class="p">(</span><span class="s2">&quot;email&quot;</span><span class="p">)</span> <span class="cp">?&gt;</span>
 <span class="nt">&lt;/p&gt;</span>

 <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nx">Tag</span><span class="o">::</span><span class="na">submitButton</span><span class="p">(</span><span class="s2">&quot;Register&quot;</span><span class="p">)</span> <span class="cp">?&gt;</span>
 <span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;/form&gt;</span>
</pre></div>
</div>
<p>Viewing the form in your browser will show something like this:</p>
<div class="figure align-center">
<img alt="../_images/tutorial-3.png" src="../_images/tutorial-3.png" />
</div>
<p><a class="reference internal" href="../api/Phalcon_Tag.html"><em>Phalcon\Tag</em></a> also provides useful methods to build form elements.</p>
<p>The Phalcon\Tag::form method receives only one parameter for instance, a relative uri to a controller/action in the application.</p>
<p>By clicking the &#8220;Send&#8221; button, you will notice an exception thrown from the framework, indicating that we are missing the &#8220;register&#8221; action in the controller &#8220;signup&#8221;. Our public/index.php file throws this exception:</p>
<blockquote>
<div>PhalconException: Action &#8220;register&#8221; was not found on controller &#8220;signup&#8221;</div></blockquote>
<p>Implementing that method will remove the exception:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">SignupController</span> <span class="k">extends</span> <span class="nx">\Phalcon\Mvc\Controller</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">indexAction</span><span class="p">()</span>
    <span class="p">{</span>

    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">registerAction</span><span class="p">()</span>
    <span class="p">{</span>

    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>If you click the &#8220;Send&#8221; button again, you will see a blank page. The name and email input provided by the user should be stored in a database. According to MVC guidelines, database interactions must be done through models so as to ensure clean object-oriented code.</p>
</div>
<div class="section" id="creating-a-model">
<h3>创建模型（Creating a Model）<a class="headerlink" href="#creating-a-model" title="永久链接至标题">¶</a></h3>
<p>Phalcon brings the first ORM for PHP entirely written in C-language. Instead of increasing the complexity of development, it simplifies it.</p>
<p>Before creating our first model, we need to create a database table outside of Phalcon to map it to. A simple table to store registered users can be defined like this:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">users</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="o">`</span><span class="n">name</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">70</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">email</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">70</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>A model should be located in the app/models directory (app/models/Users.php). The model maps to the &#8220;users&#8221; table:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">Users</span> <span class="k">extends</span> <span class="nx">\Phalcon\Mvc\Model</span>
<span class="p">{</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-a-database-connection">
<h3>设置数据库连接（Setting a Database Connection）<a class="headerlink" href="#setting-a-database-connection" title="永久链接至标题">¶</a></h3>
<p>In order to be able to use a database connection and subsequently access data through our models, we need to specify it in our bootstrap process. A database connection is just another service that our application has that can be used for several components:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">try</span> <span class="p">{</span>

    <span class="c1">//Register an autoloader</span>
    <span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Loader</span><span class="p">();</span>
    <span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">registerDirs</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;../app/controllers/&#39;</span><span class="p">,</span>
        <span class="s1">&#39;../app/models/&#39;</span>
    <span class="p">))</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">();</span>

    <span class="c1">//Create a DI</span>
    <span class="nv">$di</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Phalcon\DI\FactoryDefault</span><span class="p">();</span>

    <span class="c1">//Setup the database service</span>
    <span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;db&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">\Phalcon\Db\Adapter\Pdo\Mysql</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
            <span class="s2">&quot;host&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
            <span class="s2">&quot;username&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;root&quot;</span><span class="p">,</span>
            <span class="s2">&quot;password&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;secret&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dbname&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;test_db&quot;</span>
        <span class="p">));</span>
    <span class="p">});</span>

    <span class="c1">//Setup the view component</span>
    <span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;view&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(){</span>
        <span class="nv">$view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Mvc\View</span><span class="p">();</span>
        <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">setViewsDir</span><span class="p">(</span><span class="s1">&#39;../app/views/&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$view</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="c1">//Setup a base URI so that all generated URIs include the &quot;tutorial&quot; folder</span>
    <span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(){</span>
        <span class="nv">$url</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Mvc\Url</span><span class="p">();</span>
        <span class="nv">$url</span><span class="o">-&gt;</span><span class="na">setBaseUri</span><span class="p">(</span><span class="s1">&#39;/tutorial/&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$url</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="c1">//Handle the request</span>
    <span class="nv">$application</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Mvc\Application</span><span class="p">(</span><span class="nv">$di</span><span class="p">);</span>

    <span class="k">echo</span> <span class="nv">$application</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getContent</span><span class="p">();</span>

<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">echo</span> <span class="s2">&quot;PhalconException: &quot;</span><span class="p">,</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>With the correct database parameters, our models are ready to work and interact with the rest of the application.</p>
</div>
<div class="section" id="storing-data-using-models">
<h3>使用模型保存数据（Storing data using models）<a class="headerlink" href="#storing-data-using-models" title="永久链接至标题">¶</a></h3>
<p>Receiving data from the form and storing them in the table is the next step.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">SignupController</span> <span class="k">extends</span> <span class="nx">\Phalcon\Mvc\Controller</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">indexAction</span><span class="p">()</span>
    <span class="p">{</span>

    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">registerAction</span><span class="p">()</span>
    <span class="p">{</span>

        <span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Users</span><span class="p">();</span>

        <span class="c1">//Store and check for errors</span>
        <span class="nv">$success</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">getPost</span><span class="p">(),</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">));</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$success</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">echo</span> <span class="s2">&quot;Thanks for registering!&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">echo</span> <span class="s2">&quot;Sorry, the following problems were generated: &quot;</span><span class="p">;</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getMessages</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$message</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">echo</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">(),</span> <span class="s2">&quot;&lt;br/&gt;&quot;</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">view</span><span class="o">-&gt;</span><span class="na">disable</span><span class="p">();</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>We then instantiate the Users class, which corresponds to a User record. The class public properties map to the fields
of the record in the users table. Setting the relevant values in the new record and calling save() will store the data in the database for that record. The save() method returns a boolean value which indicates whether the storing of the data was successful or not.</p>
<p>The ORM automatically escapes the input preventing SQL injections so we only need to pass the request to the save method.</p>
<p>Additional validation happens automatically on fields that are defined as not null (required). If we don&#8217;t enter any of the required fields in the sign up form our screen will look like this:</p>
<div class="figure align-center">
<img alt="../_images/tutorial-4.png" src="../_images/tutorial-4.png" />
</div>
</div>
</div>
<div class="section" id="conclusion">
<h2>结束语（Conclusion）<a class="headerlink" href="#conclusion" title="永久链接至标题">¶</a></h2>
<p>This is a very simple tutorial and as you can see, it&#8217;s easy to start building an application using Phalcon.
The fact that Phalcon is an extension on your web server has not interfered with the ease of development or
features available. We invite you to continue reading the manual so that you can discover additional features offered by Phalcon!</p>
</div>
<div class="section" id="sample-applications">
<h2>一些应用（Sample Applications）<a class="headerlink" href="#sample-applications" title="永久链接至标题">¶</a></h2>
<p>The following Phalcon-powered applications are also available, providing more complete examples:</p>
<ul class="simple">
<li><a class="reference external" href="http://blog.phalconphp.com/post/20928554661/invo-a-sample-application">INVO application</a>: Invoice generation application. Allows for management of products, companies, product types. etc.</li>
<li><a class="reference external" href="http://blog.phalconphp.com/post/24622423072/sample-application-php-alternative-site">PHP Alternative website</a>: Multilingual and advanced routing application</li>
<li><a class="reference external" href="http://blog.phalconphp.com/post/37515965262/sample-application-album-orama">Album O&#8217;Rama</a>: A showcase of music albums, handling big sets of data with <a class="reference internal" href="phql.html"><em>PHQL</em></a> and using <a class="reference internal" href="volt.html"><em>Volt</em></a> as template engine</li>
<li><a class="reference external" href="http://blog.phalconphp.com/post/41461000213/phosphorum-the-phalcons-forum">Phosphorum</a>: A simple and clean forum</li>
</ul>
</div>
</div>


                    </div>
                  </div>
                </div>
            </div>
          </td>
        </tr>
      </table>
    <div class="related">
      <ul>
        <li class="right" >
          <a href="../genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="tutorial-invo.html" title="教程 2：INVO 项目讲解（Tutorial 2: Explaining INVO）"
             >下一页</a> |</li>
        <li class="right" >
          <a href="built-in.html" title="使用 PHP 内置 web 服务器（Using PHP Built-in webserver）"
             >上一页</a> |</li> 
      </ul>
    </div>
        <div id="footer">

          <p>Found a typo or an error? Want to improve this document? The documentation sources are available on <a href="http://github.com/phalcon/docs">Github</a></p>
          <p>Need support or have questions? Check our <a href="http://phalconphp.com/support">Support Page</a></p>

          <p>The Phalcon PHP Framework is released under the <a href="https://github.com/phalcon/cphalcon/blob/master/docs/LICENSE.md">new BSD license</a>.</p>
          <p>Except where otherwise noted, content on this site is licensed under the
            <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 License.</a></p>
             最后更新日期是 Oct 21, 2014.
            使用 <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.

          <p>
             &copy; 版权所有 2014, Phalcon Team and contributors.
          </p>

            <div class="size-wrap footer-wrap">

                <div class="donate-wrap">
                    Donate to Phalcon: <a href="http://flattr.com/thing/1134206/Phalcon-PHP-Framework" target="_blank" class="button button-small orange">Flattr</a>
                    or
                    <form action="https://www.paypal.com/cgi-bin/webscr" method="post" style="display: inline">
                        <input type="hidden" name="cmd" value="_s-xclick">
                        <input type="hidden" name="hosted_button_id" value="7LSYMNMFZNG8W">
                        <input class="button button-small orange" style="border: inherit; display: inline; font-weight: bold" type="submit" value="via Paypal" title="PayPal — The safer, easier way to pay online.">
                    </form>
                </div>

                <div class="social-links">
                    <a href="https://twitter.com/phalconphp" class="social-link tw">Twitter</a>
                    <a href="http://www.facebook.com/pages/Phalcon/134230726685897" class="social-link fb">Facebook</a>
                    <a href="https://plus.google.com/102376109340560896457" class="social-link gp">Google Plus</a>
                    <a href="http://vimeo.com/user10964377" class="social-link vm">Vimeo</a>
                </div>

            </div>

        </div>

    </div>
    <script type="text/javascript">
    $(window).on("load", function(){
      var cx = '009733439235723428699:lh9ltjgvdz8';
      var gcse = document.createElement('script');
      gcse.type = 'text/javascript';
      gcse.async = true;
      gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cx=' + cx;
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(gcse, s);
      /*window.setTimeout(function(){
        $('.gsc-search-button').css({
          'background': '#f06715',
          'padding': '2px',
          'border': '0'
        });
      }, 1000)*/
    });
    </script>

  </body>
</html>