
<!DOCTYPE html>

<html lang="en">
  <head>
    
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Маршрутизация (Routing, Роутинг) &mdash; Phalcon 1.3.0 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link href='http://fonts.googleapis.com/css?family=Ubuntu:400,500,700,300italic,400italic,500italic&amp;subset=latin,cyrillic-ext' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/docs.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.3.0',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/docs.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Phalcon 1.3.0 documentation" href="../index.html" />
    <link rel="next" title="Диспетчер контроллеров" href="dispatching.html" />
    <link rel="prev" title="MVC Приложения" href="applications.html" /> 
  </head>
  <body>
    <div id="wrapper">

        <div class="size-wrap">

            <div class="header clear-fix">
                <a class="header-logo" href="http://phalconphp.com"><span class="logo-text">Phalcon</span></a>
                <div class="header-right">
                    <iframe src="http://ghbtns.com/github-btn.html?user=phalcon&amp;repo=cphalcon&amp;type=watch&amp;count=true&amp;size=large"
allowtransparency="true" frameborder="0" scrolling="0" width="152px" height="30px"></iframe>
                </div>
                <ul class="header-nav">
                    <li><a href="http://phalconphp.com/" class="header-nav-link">Home</a></li>
                    <li><a href="http://phalconphp.com/download" class="header-nav-link">Download</a></li>
                    <li><a href="http://forum.phalconphp.com/" class="header-nav-link active">Forum</a></li>
                    <li><a href="http://blog.phalconphp.com/" class="header-nav-link">Blog</a></li>
                    <li><a href="http://phalconphp.com/support" class="header-nav-link">Support</a></li>
                    <li><a href="http://store.phalconphp.com/" class="header-nav-link">Store</a></li>
                    <li><a href="https://github.com/phalcon/cphalcon" class="header-nav-link">GitHub</a></li>
                </ul>
            </div>

        </div>
    <div class="header-line">
      <div class="size-wrap">
        <div class="header-line-title title-white">Documentation</div>
      </div>
    </div>
    <div class="related">
      <ul>
        <li class="right" >
          <a href="../genindex.html" title="Словарь-указатель"
             accesskey="I">словарь</a></li>
        <li class="right" >
          <a href="dispatching.html" title="Диспетчер контроллеров"
             accesskey="N">следующий</a> |</li>
        <li class="right" >
          <a href="applications.html" title="MVC Приложения"
             accesskey="P">предыдущий</a> |</li>
        <li><a href="http://phalconphp.com">Home</a> &raquo;</li>
        <li><a href="../index.html">Phalcon 1.3.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

      <table width="90%" align="center">
        <tr>
      <td class="primary-box" width="25%" valign="top">
            <div id="searchbox" style="">
                <form class="search" action="http://readthedocs.org/search/project/" method="get">
                  <input type="search" name="q" size="15" placeholder="Search">
                  <input type="submit" value="Go">
                  <input type="hidden" name="selected_facets" value="project:">
                </form>
            </div>
          <div style="padding:5px;padding-left:10px">
              <div id="carbonads-container">
                  <div class="carbonad"><div id="azcarbon"></div>
                      <script type="text/javascript">var z = document.createElement("script"); z.type = "text/javascript"; z.async = true; z.src = "http://engine.carbonads.com/z/56496/azcarbon_2_1_0_VERT"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(z, s);</script>
                  </div>
              </div>
          </div>
            <h3><a href="../index.html">Содержание</a></h3>
            <ul>
<li><a class="reference internal" href="#">Маршрутизация (Routing, Роутинг)</a><ul>
<li><a class="reference internal" href="#id1">Определение маршрутов</a><ul>
<li><a class="reference internal" href="#id2">Именованные параметры</a></li>
<li><a class="reference internal" href="#id3">Краткий синтаксис</a></li>
<li><a class="reference internal" href="#id4">Совмещение массивов и краткого синтаксиса</a></li>
<li><a class="reference internal" href="#id5">Маршрутизация модулей</a></li>
<li><a class="reference internal" href="#http">Разделение по HTTP методам</a></li>
<li><a class="reference internal" href="#id6">Использование преобразований</a></li>
<li><a class="reference internal" href="#id7">Группы маршрутов</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id8">Соответствие маршрутов</a></li>
<li><a class="reference internal" href="#id9">Именованные маршруты</a></li>
<li><a class="reference internal" href="#id10">Примеры использования</a></li>
<li><a class="reference internal" href="#id11">Поведение по умолчанию</a></li>
<li><a class="reference internal" href="#id12">Указание маршрута по умолчанию</a></li>
<li><a class="reference internal" href="#id13">404 страница</a></li>
<li><a class="reference internal" href="#id14">Установка параметров по умолчанию</a></li>
<li><a class="reference internal" href="#id15">Использование конечного /</a></li>
<li><a class="reference internal" href="#id16">Дополнительные условия</a></li>
<li><a class="reference internal" href="#id17">Ограничение по имени хоста</a></li>
<li><a class="reference internal" href="#uri">Источники URI</a></li>
<li><a class="reference internal" href="#id18">Тестирование маршрутов</a></li>
<li><a class="reference internal" href="#id19">Маршруты на аннотациях</a></li>
<li><a class="reference internal" href="#id20">Создание собственного маршрутизатора</a></li>
</ul>
</li>
</ul>

            <h4>Предыдущий раздел</h4>
            <p class="topless"><a href="applications.html" title="предыдущая глава">&lt; MVC Приложения</a></p>
            <h4>Следующий раздел</h4>
            <p class="topless"><a href="dispatching.html" title="следующая глава">Диспетчер контроллеров &gt;</a></p>
            <h3>На этой странице</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/reference/routing.txt" rel="nofollow">Показать исходный текст</a></li>
            </ul>
        </td>
          <td class="second-box" valign="top">
            <div class="document">
                <div class="documentwrapper">
                  <div class="bodywrapper">
                    <div class="body" >
                      
  <div class="section" id="routing">
<h1>Маршрутизация (Routing, Роутинг)<a class="headerlink" href="#routing" title="Ссылка на этот заголовок">¶</a></h1>
<p>Компонент маршрутизации позволяет определять маршруты, которые будут привязаны к контроллерам, или обработчикам для получения
запроса. Маршрутизатор просто разбирает URI для определения информации. Маршрутизатор имеет два режима: MVC
режим и режим совпадения. Первый режим идеально подходит для работы с MVC приложениями.</p>
<div class="section" id="id1">
<h2>Определение маршрутов<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h2>
<p><a class="reference internal" href="../api/Phalcon_Mvc_Router.html"><em>Phalcon\Mvc\Router</em></a> предоставляет расширенные возможности маршрутизации. В MVC режиме вы
можете определить маршруты и направить их на контроллеры/действия, которые вам требуются. Маршруты определяются следующим образом:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Создание маршрутизатора</span>
<span class="nv">$router</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Mvc\Router</span><span class="p">();</span>

<span class="c1">// Определение правила маршрутизации</span>
<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span>
    <span class="s2">&quot;/admin/users/my-profile&quot;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s2">&quot;controller&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;users&quot;</span><span class="p">,</span>
        <span class="s2">&quot;action&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;profile&quot;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">);</span>

<span class="c1">// Еще одно правило</span>
<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span>
    <span class="s2">&quot;/admin/users/change-password&quot;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s2">&quot;controller&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;users&quot;</span><span class="p">,</span>
        <span class="s2">&quot;action&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;changePassword&quot;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">);</span>

<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">();</span>
</pre></div>
</div>
<p>Метод add() принимает в качестве первого параметра шаблон ссылки, вторым параметром настройки этого маршрута.
В этом случае, если URI соответствует /admin/users/my-profile, и будет выполнен контроллер &#8220;users&#8221;, а в нём действие &#8220;profile&#8221;.
Маршрутизатор не выполняет действие контроллера, он только собирает эту информацию, чтобы сообщить правильные параметры в компонент
<a class="reference internal" href="../api/Phalcon_Mvc_Dispatcher.html"><em>Phalcon\Mvc\Dispatcher</em></a>.</p>
<p>Приложение может иметь множество маршрутов, определения их по одному может быть достаточно трудоемкой задачей. В таких случаях мы можем
создавать более гибкие маршруты:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Создание маршрутизатора</span>
<span class="nv">$router</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Mvc\Router</span><span class="p">();</span>

<span class="c1">// Определение правила маршрутизации</span>
<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span>
    <span class="s2">&quot;/admin/:controller/a/:action/:params&quot;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s2">&quot;controller&quot;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;action&quot;</span>     <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;params&quot;</span>     <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>В примере, приведенном выше, с помощью подстановочных элементов мы делаем маршрут подходящим для множества ссылок. Например, при получении
URL (/admin/users/a/delete/dave/301), маршрутизатор разберёт его в:</p>
<table border="1" class="docutils">
<colgroup>
<col width="71%" />
<col width="29%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Контроллер / Controller</td>
<td>users</td>
</tr>
<tr class="row-even"><td>Действие / Action</td>
<td>delete</td>
</tr>
<tr class="row-odd"><td>Параметр / Parameter</td>
<td>dave</td>
</tr>
<tr class="row-even"><td>Параметр / Parameter</td>
<td>301</td>
</tr>
</tbody>
</table>
<p>Метод add() принимает шаблон, который по желанию может быть написан с использованием регулярных выражений. Все
маршруты должны начинаться с косой черты (/). Регулярные выражения должны соответствовать формату  <a class="reference external" href="http://www.php.net/manual/en/book.pcre.php">регулярных выражений PCRE</a>.
Отметим, что это не нужно добавлять в регулярные выражения разделители. Все маршруты не зависят от регистра.</p>
<p>Второй параметр определяет, какие из подходящих частей следует &#8220;привязать&#8221; к controller/action/parameters. Соответствующие
части берутся из &#8220;заполнителей&#8221; или по маскам ограничивающимися круглыми скобками. В примере, приведенном выше,
первой части соответствует контроллеру (:controller), второй действию и так далее.</p>
<p>Заполнители помогают написанию регулярных выражений, они более читабельны для разработчиков и проще
для понимания. Существуют такие заполнители:</p>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="16%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Placeholder</th>
<th class="head">Регулярное вырожение</th>
<th class="head">Использование</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>/:module</td>
<td>/([a-zA-Z0-9_-]+)</td>
<td>Проверяет соответствие названия модуля алфавитно-цифровым символам</td>
</tr>
<tr class="row-odd"><td>/:controller</td>
<td>/([a-zA-Z0-9_-]+)</td>
<td>Проверяет соответствие названия контроллера алфавитно-цифровым символам</td>
</tr>
<tr class="row-even"><td>/:action</td>
<td>/([a-zA-Z0-9_]+)</td>
<td>Проверяет соответствие названия действия алфавитно-цифровым символам</td>
</tr>
<tr class="row-odd"><td>/:params</td>
<td>(/.*)*</td>
<td>Проверяет список дополнительных частей, разделенных косыми чертами. Использовать только в конце ссылок</td>
</tr>
<tr class="row-even"><td>/:namespace</td>
<td>/([a-zA-Z0-9_-]+)</td>
<td>Проверяет пространство имен</td>
</tr>
<tr class="row-odd"><td>/:int</td>
<td>/([0-9]+)</td>
<td>Проверяет соответствие цифровому формату</td>
</tr>
</tbody>
</table>
<p>Названия контроллеров &#8220;camelized&#8221;, это означает, что символы (-) и (_) удаляются, и следующий после них символ
преобразуется в верхний регистр. Например, some_controller преобразуется в SomeController.</p>
<p>Поскольку вы можете использовать множество маршрутов, добавляя их методом add(), порядок, в котором маршруты добавляются указывает
их актуальность, последние добавленные маршруты имеют больший приоритет, чем добавленные ранее. Внутри все определенные маршруты
перемещаются в обратном порядке, пока <a class="reference internal" href="../api/Phalcon_Mvc_Router.html"><em>Phalcon\Mvc\Router</em></a> не найдёт
тот, который соответствует данному URI и использует его, игнорируя остальные.</p>
<div class="section" id="id2">
<h3>Именованные параметры<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h3>
<p>В примере ниже показано, как определить имена для параметров маршрутов:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span>
    <span class="s2">&quot;/news/([0-9]{4})/([0-9]{2})/([0-9]{2})/:params&quot;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s2">&quot;controller&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;posts&quot;</span><span class="p">,</span>
        <span class="s2">&quot;action&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;show&quot;</span><span class="p">,</span>
        <span class="s2">&quot;year&quot;</span>       <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="c1">// ([0-9]{4})</span>
        <span class="s2">&quot;month&quot;</span>      <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="c1">// ([0-9]{2})</span>
        <span class="s2">&quot;day&quot;</span>        <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span> <span class="c1">// ([0-9]{2})</span>
        <span class="s2">&quot;params&quot;</span>     <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">,</span> <span class="c1">// :params</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>В приведенном выше примере, в маршруте не определены части для &#8220;контроллера&#8221; или &#8220;действия&#8221;. Эти параметры заменяются
фиксированными значениями (&#8220;posts&#8221; и &#8220;show&#8221;). Пользователь не будет видеть вызванный контроллер.
Внутри контроллера именованные параметры можно получить следующим образом:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">PostsController</span> <span class="k">extends</span> <span class="nx">\Phalcon\Mvc\Controller</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">indexAction</span><span class="p">()</span>
    <span class="p">{</span>

    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">showAction</span><span class="p">()</span>
    <span class="p">{</span>

        <span class="c1">// Возвращает параметр &quot;year&quot;</span>
        <span class="nv">$year</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dispatcher</span><span class="o">-&gt;</span><span class="na">getParam</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">);</span>

        <span class="c1">// Возвращает параметр &quot;month&quot;</span>
        <span class="nv">$month</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dispatcher</span><span class="o">-&gt;</span><span class="na">getParam</span><span class="p">(</span><span class="s2">&quot;month&quot;</span><span class="p">);</span>

        <span class="c1">// Возвращает параметр &quot;day&quot;</span>
        <span class="nv">$day</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dispatcher</span><span class="o">-&gt;</span><span class="na">getParam</span><span class="p">(</span><span class="s2">&quot;day&quot;</span><span class="p">);</span>

    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Обратите внимание, что значения параметров получаются из диспетчера. Это происходит потому, что это
компонент, который, непосредственно запускает в работу ваше приложение.
Кроме того, существует и другой способ создавать именованные параметры, например, как часть правила маршрутизации:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span>
    <span class="s2">&quot;/documentation/{chapter}/{name}.{type:[a-z]+}&quot;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s2">&quot;controller&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;documentation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;action&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;show&quot;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Вы можете получить доступ к их значениям так же, как раньше:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">DocumentationController</span> <span class="k">extends</span> <span class="nx">\Phalcon\Mvc\Controller</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">showAction</span><span class="p">()</span>
    <span class="p">{</span>

        <span class="c1">// Возвращает параметр &quot;name&quot;</span>
        <span class="nv">$name</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dispatcher</span><span class="o">-&gt;</span><span class="na">getParam</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">);</span>

        <span class="c1">// Возвращает параметр &quot;type&quot;</span>
        <span class="nv">$type</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dispatcher</span><span class="o">-&gt;</span><span class="na">getParam</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">);</span>

    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h3>Краткий синтаксис<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h3>
<p>Если вам не нравится использование массивов для определения правил маршрута, альтернативный синтаксис также доступен.
Следующие примеры дают одинаковый результат:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Краткий синтаксис</span>
<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s2">&quot;/posts/{year:[0-9]+}/{title:[a-z\-]+}&quot;</span><span class="p">,</span> <span class="s2">&quot;Posts::show&quot;</span><span class="p">);</span>

<span class="c1">// Использование массива</span>
<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span>
    <span class="s2">&quot;/posts/([0-9]+)/([a-z\-]+)&quot;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span>
       <span class="s2">&quot;controller&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;posts&quot;</span><span class="p">,</span>
       <span class="s2">&quot;action&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;show&quot;</span><span class="p">,</span>
       <span class="s2">&quot;year&quot;</span>       <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
       <span class="s2">&quot;title&quot;</span>      <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h3>Совмещение массивов и краткого синтаксиса<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h3>
<p>Массив и краткий синтаксис может быть смешанным, в данном случае, обратите внимание, что именованные параметры автоматически
добавляются в маршрут в соответствии с положением, на котором они были определены:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// В качестве первой позиции выступает параметр &#39;country&#39;</span>
<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;/news/{country:[a-z]{2}}/([a-z+])/([a-z\-+])&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;section&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="c1">// Это уже позиция номер 2</span>
        <span class="s1">&#39;article&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h3>Маршрутизация модулей<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h3>
<p>Вы можете определить маршруты, пути которых включают в себя модули. Это особенно подходит для мульти-модульных приложений.
Возможно так же определить маршрут по умолчанию, который включает в себя модуль шаблона:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$router</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Phalcon\Mvc\Router</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>

<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;/:module/:controller/:action/:params&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;module&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s1">&#39;params&#39;</span> <span class="o">=&gt;</span> <span class="mi">4</span>
<span class="p">));</span>
</pre></div>
</div>
<p>В этом случае маршрут всегда должен иметь имя модуля в качестве части URL-адреса. Например, в следующем
URL: /admin/users/edit/sonny, будут обработан как:</p>
<table border="1" class="docutils">
<colgroup>
<col width="44%" />
<col width="56%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Модуль</td>
<td>admin</td>
</tr>
<tr class="row-even"><td>Контроллер</td>
<td>users</td>
</tr>
<tr class="row-odd"><td>Действие</td>
<td>edit</td>
</tr>
<tr class="row-even"><td>Параметр</td>
<td>sonny</td>
</tr>
</tbody>
</table>
<p>Или вы можете привязать конкретные маршруты к конкретным модулям:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s2">&quot;/login&quot;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;module&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;backend&#39;</span><span class="p">,</span>
    <span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span>
    <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;index&#39;</span><span class="p">,</span>
<span class="p">));</span>

<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s2">&quot;/products/:action&quot;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;module&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;frontend&#39;</span><span class="p">,</span>
    <span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;products&#39;</span><span class="p">,</span>
    <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">));</span>
</pre></div>
</div>
<p>Или привязать к конкретному пространству имен:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s2">&quot;/:namespace/login&quot;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;namespace&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span>
    <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;index&#39;</span>
<span class="p">));</span>
</pre></div>
</div>
<p>Пространства имён и названия классов должны передаваться раздельно:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s2">&quot;/login&quot;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;namespace&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Backend\Controllers&#39;</span><span class="p">,</span>
    <span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span>
    <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;index&#39;</span>
<span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="http">
<h3>Разделение по HTTP методам<a class="headerlink" href="#http" title="Ссылка на этот заголовок">¶</a></h3>
<p>При добавлении маршрута, используя метод add(), маршрут будет активен для любого HTTP-метода. Иногда можно использовать маршрут для
конкретного метода, это особенно полезно при создании RESTful приложений:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Маршрут соответствует только HTTP методу GET</span>
<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">addGet</span><span class="p">(</span><span class="s2">&quot;/products/edit/{id}&quot;</span><span class="p">,</span> <span class="s2">&quot;Products::edit&quot;</span><span class="p">);</span>

<span class="c1">// Маршрут соответствует только HTTP методу POST</span>
<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">addPost</span><span class="p">(</span><span class="s2">&quot;/products/save&quot;</span><span class="p">,</span> <span class="s2">&quot;Products::save&quot;</span><span class="p">);</span>

<span class="c1">// Маршрут соответствует сразу двум HTTP методам POST и PUT</span>
<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s2">&quot;/products/update&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">via</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;PUT&quot;</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h3>Использование преобразований<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h3>
<p>Метод convert позволяет трансформировать параметры маршрута до передачи их диспетчеру, следующий пример показывает вариант использования:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Название действия разрешает использование &quot;-&quot;: /products/new-ipod-nano-4-generation</span>
<span class="nv">$router</span>
    <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;/products/{slug:[a-z\-]+}&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;products&#39;</span><span class="p">,</span>
        <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;show&#39;</span>
    <span class="p">))</span>
    <span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span><span class="s1">&#39;slug&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$slug</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Удаляем тире из выбранного параметра</span>
        <span class="k">return</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$slug</span><span class="p">);</span>
    <span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h3>Группы маршрутов<a class="headerlink" href="#id7" title="Ссылка на этот заголовок">¶</a></h3>
<p>Если наборы маршрутов имеют общие пути, они могут быть сгруппированы для легкой поддержки:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$router</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Mvc\Router</span><span class="p">();</span>

<span class="c1">// Создаётся группа с общим модулем и контроллером</span>
<span class="nv">$blog</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Mvc\Router\Group</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;module&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;blog&#39;</span><span class="p">,</span>
    <span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;index&#39;</span>
<span class="p">));</span>

<span class="c1">// Маршруты начинаются с /blog</span>
<span class="nv">$blog</span><span class="o">-&gt;</span><span class="na">setPrefix</span><span class="p">(</span><span class="s1">&#39;/blog&#39;</span><span class="p">);</span>

<span class="c1">// Добавление маршрута в группу</span>
<span class="nv">$blog</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;/save&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;save&#39;</span>
<span class="p">));</span>

<span class="c1">// Еще один маршрут</span>
<span class="nv">$blog</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;/edit/{id}&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;edit&#39;</span>
<span class="p">));</span>

<span class="c1">// Маршрут для действия по умолчанию</span>
<span class="nv">$blog</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;/blog&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;blog&#39;</span><span class="p">,</span>
    <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;index&#39;</span>
<span class="p">));</span>

<span class="c1">// Добавление группы в общие правила маршрутизации</span>
<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">mount</span><span class="p">(</span><span class="nv">$blog</span><span class="p">);</span>
</pre></div>
</div>
<p>Вы можете размещать группы маршрутов в разных файлах приложения, добиваясь оптимальной структуры и чистоты кода:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">BlogRoutes</span> <span class="k">extends</span> <span class="nx">Phalcon\Mvc\Router\Group</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">initialize</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Параметры по умолчанию</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setPaths</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;module&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;blog&#39;</span><span class="p">,</span>
            <span class="s1">&#39;namespace&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Blog\Controllers&#39;</span>
        <span class="p">));</span>

        <span class="c1">// Маршруты начинаются с преффикса /blog</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setPrefix</span><span class="p">(</span><span class="s1">&#39;/blog&#39;</span><span class="p">);</span>

        <span class="c1">// Добавляем маршрут</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;/save&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;save&#39;</span>
        <span class="p">));</span>

        <span class="c1">// Еще маршрут</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;/edit/{id}&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;edit&#39;</span>
        <span class="p">));</span>

        <span class="c1">// Данные для маршрута по умолчанию</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;/blog&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;blog&#39;</span><span class="p">,</span>
            <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;index&#39;</span>
        <span class="p">));</span>

    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Созданную группу надо подмонтировать в маршрутизатор:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Добавляем маршруты в общий маршрутизатор:</span>
<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">mount</span><span class="p">(</span><span class="k">new</span> <span class="nx">BlogRoutes</span><span class="p">());</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id8">
<h2>Соответствие маршрутов<a class="headerlink" href="#id8" title="Ссылка на этот заголовок">¶</a></h2>
<p>Текущий URI передаётся маршрутизатору для сопоставления его маршруту. По умолчанию, URI для обработки берется из
переменной $_GET[&#8216;_url&#8217;], полученной с использованием mod_rewrite.
Для Phalcon подходят очень простые правила mod_rewrite:</p>
<div class="highlight-apacheconf"><div class="highlight"><pre><span class="nb">RewriteEngine</span> <span class="k">On</span>
<span class="nb">RewriteCond</span>   %{REQUEST_FILENAME} !-d
<span class="nb">RewriteCond</span>   %{REQUEST_FILENAME} !-f
<span class="nb">RewriteRule</span>   ^(.*)$ index.php?_url=/$1 [QSA,L]
</pre></div>
</div>
<p>В следующем примере показано, как использовать этот компонент автономно:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Создание маршрутизатора</span>
<span class="nv">$router</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Mvc\Router</span><span class="p">();</span>

<span class="c1">// Тут устанавливаются правила маршрутизации</span>
<span class="c1">// ...</span>

<span class="c1">// Будет использован $_GET[&quot;_url&quot;]</span>
<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">();</span>

<span class="c1">// Можно указать параметр самостоятельно</span>
<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">(</span><span class="s2">&quot;/employees/edit/17&quot;</span><span class="p">);</span>

<span class="c1">// Получаем выбранный контроллер</span>
<span class="k">echo</span> <span class="nv">$router</span><span class="o">-&gt;</span><span class="na">getControllerName</span><span class="p">();</span>

<span class="c1">// .. и соответсвющее действие</span>
<span class="k">echo</span> <span class="nv">$router</span><span class="o">-&gt;</span><span class="na">getActionName</span><span class="p">();</span>

<span class="c1">// Получаем сам выбранный для ссылки маршрут</span>
<span class="nv">$route</span> <span class="o">=</span> <span class="nv">$router</span><span class="o">-&gt;</span><span class="na">getMatchedRoute</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h2>Именованные маршруты<a class="headerlink" href="#id9" title="Ссылка на этот заголовок">¶</a></h2>
<p>Каждый маршрут, добавленный в маршрутизатор, хранится как объект <a class="reference internal" href="../api/Phalcon_Mvc_Router_Route.html"><em>Phalcon\Mvc\Router\Route</em></a>.
Этот класс включает в себя все детали каждого маршрута. Например, мы можем дать ему имя и однозначно идентифицировать в нашем приложении.
Это особенно полезно, если вы хотите создать ссылки для него.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$route</span> <span class="o">=</span> <span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s2">&quot;/posts/{year}/{title}&quot;</span><span class="p">,</span> <span class="s2">&quot;Posts::show&quot;</span><span class="p">);</span>

<span class="nv">$route</span><span class="o">-&gt;</span><span class="na">setName</span><span class="p">(</span><span class="s2">&quot;show-posts&quot;</span><span class="p">);</span>

<span class="c1">// или проще</span>

<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s2">&quot;/posts/{year}/{title}&quot;</span><span class="p">,</span> <span class="s2">&quot;Posts::show&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">setName</span><span class="p">(</span><span class="s2">&quot;show-posts&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Затем, при помощи компонента <a class="reference internal" href="../api/Phalcon_Mvc_Url.html"><em>Phalcon\Mvc\Url</em></a> и названия маршрута можно создать ссылку:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// возвратит /posts/2012/phalcon-1-0-released</span>
<span class="k">echo</span> <span class="nv">$url</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s2">&quot;for&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;show-posts&quot;</span><span class="p">,</span>
    <span class="s2">&quot;year&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;2012&quot;</span><span class="p">,</span>
    <span class="s2">&quot;title&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;phalcon-1-0-released&quot;</span>
<span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h2>Примеры использования<a class="headerlink" href="#id10" title="Ссылка на этот заголовок">¶</a></h2>
<p>Ниже приведены примеры пользовательских маршрутов:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// пример - &quot;/system/admin/a/edit/7001&quot;</span>
<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span>
    <span class="s2">&quot;/system/:controller/a/:action/:params&quot;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s2">&quot;controller&quot;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;action&quot;</span>     <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;params&quot;</span>     <span class="o">=&gt;</span> <span class="mi">3</span>
    <span class="p">)</span>
<span class="p">);</span>

<span class="c1">// пример - &quot;/es/news&quot;</span>
<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span>
    <span class="s2">&quot;/([a-z]{2})/:controller&quot;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s2">&quot;controller&quot;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;action&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span>
        <span class="s2">&quot;language&quot;</span>   <span class="o">=&gt;</span> <span class="mi">1</span>
    <span class="p">)</span>
<span class="p">);</span>

<span class="c1">// пример - &quot;/es/news&quot;</span>
<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span>
    <span class="s2">&quot;/{language:[a-z]{2}}/:controller&quot;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s2">&quot;controller&quot;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;action&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;index&quot;</span>
    <span class="p">)</span>
<span class="p">);</span>

<span class="c1">// пример - &quot;/admin/posts/edit/100&quot;</span>
<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span>
    <span class="s2">&quot;/admin/:controller/:action/:int&quot;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s2">&quot;controller&quot;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;action&quot;</span>     <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;id&quot;</span>         <span class="o">=&gt;</span> <span class="mi">3</span>
    <span class="p">)</span>
<span class="p">);</span>

<span class="c1">// пример - &quot;/posts/2010/02/some-cool-content&quot;</span>
<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span>
    <span class="s2">&quot;/posts/([0-9]{4})/([0-9]{2})/([a-z\-]+)&quot;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s2">&quot;controller&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;posts&quot;</span><span class="p">,</span>
        <span class="s2">&quot;action&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;show&quot;</span><span class="p">,</span>
        <span class="s2">&quot;year&quot;</span>       <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;month&quot;</span>      <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;title&quot;</span>      <span class="o">=&gt;</span> <span class="mi">4</span>
    <span class="p">)</span>
<span class="p">);</span>

<span class="c1">// пример - &quot;/manual/en/translate.adapter.html&quot;</span>
<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span>
    <span class="s2">&quot;/manual/([a-z]{2})/([a-z\.]+)\.html&quot;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s2">&quot;controller&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;manual&quot;</span><span class="p">,</span>
        <span class="s2">&quot;action&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;show&quot;</span><span class="p">,</span>
        <span class="s2">&quot;language&quot;</span>   <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;file&quot;</span>       <span class="o">=&gt;</span> <span class="mi">2</span>
    <span class="p">)</span>
<span class="p">);</span>

<span class="c1">// пример - /feed/fr/le-robots-hot-news.atom</span>
<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span>
    <span class="s2">&quot;/feed/{lang:[a-z]+}/{blog:[a-z\-]+}\.{type:[a-z\-]+}&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Feed::get&quot;</span>
<span class="p">);</span>

<span class="c1">// пример - /api/v1/users/peter.json</span>
<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;/api/(v1|v2)/{method:[a-z]+}/{param:[a-z]+}\.(json|xml)&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;api&#39;</span><span class="p">,</span>
        <span class="s1">&#39;version&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;format&#39;</span> <span class="o">=&gt;</span> <span class="mi">4</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<blockquote class="highlights">
<div>Остерегайтесь использования спецсимволов в регулярных выражениях для контроллеров и пространств имён. Эти
параметры формируют имена классов и файлов, что, в свою очередь, взаимодействует с файловой системой, и может
использоваться злоумышленником для чтения несанкционированных файлов. Безопасным является регулярное выражение: /([a-zA-Z0-9_-]+)</div></blockquote>
</div>
<div class="section" id="id11">
<h2>Поведение по умолчанию<a class="headerlink" href="#id11" title="Ссылка на этот заголовок">¶</a></h2>
<p>У компонента <a class="reference internal" href="../api/Phalcon_Mvc_Router.html"><em>Phalcon\Mvc\Router</em></a> есть поведение по умолчанию, при котором все URL
обрабатываются по простому шаблону: /:controller/:action/:params</p>
<p>Например, ссылку вида <em>http://phalconphp.com/documentation/show/about.html</em> маршрутизатор проанализирует как:</p>
<table border="1" class="docutils">
<colgroup>
<col width="44%" />
<col width="56%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Контроллер</td>
<td>documentation</td>
</tr>
<tr class="row-even"><td>Действие</td>
<td>show</td>
</tr>
<tr class="row-odd"><td>Параметр</td>
<td>about.html</td>
</tr>
</tbody>
</table>
<p>Если вы не хотите использовать маршруты по умолчанию в вашем приложении, вы должны указать false в качестве параметра при создании объекта маршрутизатора:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Создания маршрутизатора без поддержки стандартной маршрутизации</span>
<span class="nv">$router</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Mvc\Router</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id12">
<h2>Указание маршрута по умолчанию<a class="headerlink" href="#id12" title="Ссылка на этот заголовок">¶</a></h2>
<p>При обращению к главной странице приложения срабатывает маршрут &#8216;/&#8217;, в нём надо указать что должно срабатывать:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;index&#39;</span><span class="p">,</span>
    <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;index&#39;</span>
<span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="id13">
<h2>404 страница<a class="headerlink" href="#id13" title="Ссылка на этот заголовок">¶</a></h2>
<p>Если ни один из указанных маршрутов в маршрутизаторе не совпадёт, вы можете определить действие для этого случая:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Указание действия для 404 страницы</span>
<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">notFound</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s2">&quot;controller&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span>
    <span class="s2">&quot;action&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;route404&quot;</span>
<span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="id14">
<h2>Установка параметров по умолчанию<a class="headerlink" href="#id14" title="Ссылка на этот заголовок">¶</a></h2>
<p>Можно определить значения по умолчанию для некоторых частей маршрута, таких как модуль, контроллер или действие. Когда в маршруте отсутствует любая из
указанных частей, они будут автоматически заполнены маршрутизатором из значений по умолчанию:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Установка по умолчанию</span>
<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">setDefaultModule</span><span class="p">(</span><span class="s1">&#39;backend&#39;</span><span class="p">);</span>
<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">setDefaultNamespace</span><span class="p">(</span><span class="s1">&#39;Backend\Controllers&#39;</span><span class="p">);</span>
<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">setDefaultController</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">);</span>
<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">setDefaultAction</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">);</span>

<span class="c1">// Используя значения массива</span>
<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">setDefaults</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;index&#39;</span><span class="p">,</span>
    <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;index&#39;</span>
<span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="id15">
<h2>Использование конечного /<a class="headerlink" href="#id15" title="Ссылка на этот заголовок">¶</a></h2>
<p>Иногда обращение к маршруту может быть с дополнительной косой чертой (слэш) и в конце маршрута, это в отдельных случаях может привести
к несоответствию маршруту. Вы можете настроить маршрутизатор для автоматического удаления слэша из конца обрабатываемого маршрута:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$router</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Mvc\Router</span><span class="p">();</span>

<span class="c1">// Конечные косые черты будут автоматически удалены</span>
<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">removeExtraSlashes</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
</pre></div>
</div>
<p>Или вы можете изменить определенные маршруты, в которых необходимо использовать косые черты:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span>
    <span class="s1">&#39;/{language:[a-z]{2}}/:controller[/]{0,1}&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s1">&#39;action&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;index&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id16">
<h2>Дополнительные условия<a class="headerlink" href="#id16" title="Ссылка на этот заголовок">¶</a></h2>
<p>Иногда требуется, чтобы перед выполнением маршрут удовлетворял определённым условиям.
Вы можете добавлять произвольные условия используя функцию обратного вызова (callback)
&#8216;beforeMatch&#8217;. Если эта функция вернёт false, то запрос не совпадёт с условием и
маршрут не выполнится:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;module&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;session&#39;</span>
<span class="p">))</span><span class="o">-&gt;</span><span class="na">beforeMatch</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$uri</span><span class="p">,</span> <span class="nv">$route</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Проверим, что это был Ajax-запрос</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_X_REQUESTED_WITH&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;xmlhttprequest&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Вы можете повторно использовать эти дополнительные условия в классах:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">AjaxFilter</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">check</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_X_REQUESTED_WITH&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;xmlhttprequest&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>И использовать этот класс вместо анонимной функции:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;/get/info/{id}&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;products&#39;</span><span class="p">,</span>
    <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;info&#39;</span>
<span class="p">))</span><span class="o">-&gt;</span><span class="na">beforeMatch</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="k">new</span> <span class="nx">AjaxFilter</span><span class="p">(),</span> <span class="s1">&#39;check&#39;</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="id17">
<h2>Ограничение по имени хоста<a class="headerlink" href="#id17" title="Ссылка на этот заголовок">¶</a></h2>
<p>Маршрутизатор позволяет вам выставлять ограничения по имени хоста. Это означает, что
конкретные маршруты или группы маршрутов могут быть привязаны к конкретным именам хостов:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;module&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;session&#39;</span><span class="p">,</span>
    <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;login&#39;</span>
<span class="p">))</span><span class="o">-&gt;</span><span class="na">setHostName</span><span class="p">(</span><span class="s1">&#39;admin.company.com&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Имя хоста так же может быть регулярным выражением:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;module&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;session&#39;</span><span class="p">,</span>
    <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;login&#39;</span>
<span class="p">))</span><span class="o">-&gt;</span><span class="na">setHostName</span><span class="p">(</span><span class="s1">&#39;([a-z+]).company.com&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>В группах маршрутов вы можете установить ограничение по имени хоста, которое будет
применяться к каждому маршруту в группе:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Создаём группу с общим модулем и контроллером</span>
<span class="nv">$blog</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Mvc\Router\Group</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;module&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;blog&#39;</span><span class="p">,</span>
    <span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;posts&#39;</span>
<span class="p">));</span>

<span class="c1">// Ограничиваем по имени хоста</span>
<span class="nv">$blog</span><span class="o">-&gt;</span><span class="na">setHostName</span><span class="p">(</span><span class="s1">&#39;blog.mycompany.com&#39;</span><span class="p">);</span>

<span class="c1">// Все маршруты начинаются с /blog</span>
<span class="nv">$blog</span><span class="o">-&gt;</span><span class="na">setPrefix</span><span class="p">(</span><span class="s1">&#39;/blog&#39;</span><span class="p">);</span>

<span class="c1">// Маршрут по умолчанию</span>
<span class="nv">$blog</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;index&#39;</span>
<span class="p">));</span>

<span class="c1">// Добавляем маршрут в группу</span>
<span class="nv">$blog</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;/save&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;save&#39;</span>
<span class="p">));</span>

<span class="c1">// Добавляем ещё один маршрут в группу</span>
<span class="nv">$blog</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;/edit/{id}&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;edit&#39;</span>
<span class="p">));</span>

<span class="c1">// Добавляем группу в маршрутизатор</span>
<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">mount</span><span class="p">(</span><span class="nv">$blog</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="uri">
<h2>Источники URI<a class="headerlink" href="#uri" title="Ссылка на этот заголовок">¶</a></h2>
<p>По умолчанию текущий URI для обработки берётся из переменной $_GET[&#8216;_url&#8217;], так устроено внутри Phalcon и стандартных правилах mod-rewrite,
очень просто можно указать использование для этих целей переменную $_SERVER[&#8216;REQUEST_URI&#8217;]:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">setUriSource</span><span class="p">(</span><span class="nx">Router</span><span class="o">::</span><span class="na">URI_SOURCE_GET_URL</span><span class="p">);</span> <span class="c1">// использование $_GET[&#39;_url&#39;] (по умолчанию)</span>
<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">setUriSource</span><span class="p">(</span><span class="nx">Router</span><span class="o">::</span><span class="na">URI_SOURCE_SERVER_REQUEST_URI</span><span class="p">);</span> <span class="c1">// использование $_SERVER[&#39;REQUEST_URI&#39;] (по умолчанию)</span>
</pre></div>
</div>
<p>Или вы можете самостоятельно передавать URI в метод &#8220;handle&#8221;:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">(</span><span class="s1">&#39;/some/route/to/handle&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id18">
<h2>Тестирование маршрутов<a class="headerlink" href="#id18" title="Ссылка на этот заголовок">¶</a></h2>
<p>Компонент маршрутизации не имеет внутренних зависимостей, вы можете создать файл, как показано ниже, для проверки свои маршрутов:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Маршруты для проверки</span>
<span class="nv">$testRoutes</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;/&#39;</span><span class="p">,</span>
    <span class="s1">&#39;/index&#39;</span><span class="p">,</span>
    <span class="s1">&#39;/index/index&#39;</span><span class="p">,</span>
    <span class="s1">&#39;/index/test&#39;</span><span class="p">,</span>
    <span class="s1">&#39;/products&#39;</span><span class="p">,</span>
    <span class="s1">&#39;/products/index/&#39;</span><span class="p">,</span>
    <span class="s1">&#39;/products/show/101&#39;</span><span class="p">,</span>
<span class="p">);</span>

<span class="nv">$router</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Phalcon\Mvc\Router</span><span class="p">();</span>
<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">setDI</span><span class="p">(</span><span class="k">new</span> <span class="nx">Phalcon\DI\FactoryDefault</span><span class="p">());</span>
<span class="c1">// Тут необходимо установить правила маршрутизации</span>
<span class="c1">//...</span>

<span class="c1">// Цикл проверки маршрутов</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$testRoutes</span> <span class="k">as</span> <span class="nv">$testRoute</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// Обработка маршрута</span>
    <span class="nv">$router</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">(</span><span class="nv">$testRoute</span><span class="p">);</span>

    <span class="k">echo</span> <span class="s1">&#39;Тестирование &#39;</span><span class="p">,</span> <span class="nv">$testRoute</span><span class="p">,</span> <span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">;</span>

    <span class="c1">// Проверка выбранного маршрута</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$router</span><span class="o">-&gt;</span><span class="na">wasMatched</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s1">&#39;Контроллер (Controller): &#39;</span><span class="p">,</span> <span class="nv">$router</span><span class="o">-&gt;</span><span class="na">getControllerName</span><span class="p">(),</span> <span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">;</span>
        <span class="k">echo</span> <span class="s1">&#39;Действие (Action): &#39;</span><span class="p">,</span> <span class="nv">$router</span><span class="o">-&gt;</span><span class="na">getActionName</span><span class="p">(),</span> <span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s1">&#39;Маршрут не поддерживается&lt;br&gt;&#39;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">echo</span> <span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">;</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id19">
<h2>Маршруты на аннотациях<a class="headerlink" href="#id19" title="Ссылка на этот заголовок">¶</a></h2>
<p>Компонент <a class="reference internal" href="../api/Phalcon_Mvc_Router_Annotations.html"><em>Phalcon\Mvc\Router\Annotations</em></a> интегрирован с
компонентом <a class="reference internal" href="annotations.html"><em>annotations</em></a>, и позволяет получать информацию о маршрутах из doc-блоков внутри
кода контроллеров. Используя эту стратегию, вы можете указывать маршруты непосредственно в контроллерах, вместо
того, чтобы указывать их в отдельных правилах маршрутизации:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$di</span><span class="p">[</span><span class="s1">&#39;router&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>

    <span class="c1">// Используем маршрутизатор на аннотациях</span>
    <span class="nv">$router</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Mvc\Router\Annotations</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>

    <span class="c1">// Чтение аннотаций из контроллера ProductsController для ссылок начинающихся на /api/products</span>
    <span class="nv">$router</span><span class="o">-&gt;</span><span class="na">addResource</span><span class="p">(</span><span class="s1">&#39;Products&#39;</span><span class="p">,</span> <span class="s1">&#39;/api/products&#39;</span><span class="p">);</span>

    <span class="k">return</span> <span class="nv">$router</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Аннотации могут быть определены следующим образом:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="sd">/**</span>
<span class="sd"> * @RoutePrefix(&quot;/api/products&quot;)</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">ProductsController</span>
<span class="p">{</span>

    <span class="sd">/**</span>
<span class="sd">     * @Get(&quot;/&quot;)</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">indexAction</span><span class="p">()</span>
    <span class="p">{</span>

    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @Get(&quot;/edit/{id:[0-9]+}&quot;, name=&quot;edit-robot&quot;)</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">editAction</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>

    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @Route(&quot;/save&quot;, methods={&quot;POST&quot;, &quot;PUT&quot;}, name=&quot;save-robot&quot;)</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">saveAction</span><span class="p">()</span>
    <span class="p">{</span>

    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @Route(&quot;/delete/{id:[0-9]+}&quot;, methods=&quot;DELETE&quot;,</span>
<span class="sd">     *      conversors={id=&quot;MyConversors::checkId&quot;})</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">deleteAction</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>

    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">infoAction</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>

    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Маршрутизатор поддерживает только строго определённые методы, вот список текущих поддерживаемых аннотации:</p>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="60%" />
<col width="32%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Название</th>
<th class="head">Описание</th>
<th class="head">Использование</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>RoutePrefix</td>
<td>Префикс добавляемый к каждому маршруту. Эта аннотация должна быть в комментариях класса (контроллера)</td>
<td>&#64;RoutePrefix(&#8220;/api/products&#8221;)</td>
</tr>
<tr class="row-odd"><td>Route</td>
<td>Эта аннотация создаёт маршрут для метода, она должна быть в комментариях метода</td>
<td>&#64;Route(&#8220;/api/products/show&#8221;)</td>
</tr>
<tr class="row-even"><td>Get</td>
<td>Эта аннотация создаёт маршрут для метода, разрешается только HTTP метод GET</td>
<td>&#64;Get(&#8220;/api/products/search&#8221;)</td>
</tr>
<tr class="row-odd"><td>Post</td>
<td>Эта аннотация создаёт маршрут для метода, разрешается только HTTP метод POST</td>
<td>&#64;Post(&#8220;/api/products/save&#8221;)</td>
</tr>
<tr class="row-even"><td>Put</td>
<td>Эта аннотация создаёт маршрут для метода, разрешается только HTTP метод PUT</td>
<td>&#64;Put(&#8220;/api/products/save&#8221;)</td>
</tr>
<tr class="row-odd"><td>Delete</td>
<td>Эта аннотация создаёт маршрут для метода, разрешается только HTTP метод DELETE</td>
<td>&#64;Delete(&#8220;/api/products/delete/{id}&#8221;)</td>
</tr>
<tr class="row-even"><td>Options</td>
<td>Эта аннотация создаёт маршрут для метода, разрешается только HTTP метод OPTIONS</td>
<td>&#64;Option(&#8220;/api/products/info&#8221;)</td>
</tr>
</tbody>
</table>
<p>Для аннотации при добавлении маршрутов поддерживаются следующие параметры:</p>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="53%" />
<col width="39%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Название</th>
<th class="head">Описание</th>
<th class="head">Использование</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>methods</td>
<td>Определяет HTTP метод доступа к маршруту</td>
<td>&#64;Route(&#8220;/api/products&#8221;, methods={&#8220;GET&#8221;, &#8220;POST&#8221;})</td>
</tr>
<tr class="row-odd"><td>name</td>
<td>Определяет название маршрута</td>
<td>&#64;Route(&#8220;/api/products&#8221;, name=&#8221;get-products&#8221;)</td>
</tr>
<tr class="row-even"><td>paths</td>
<td>Массив дополнительных частей пути Phalcon\Mvc\Router::add</td>
<td>&#64;Route(&#8220;/posts/{id}/{slug}&#8221;, paths={module=&#8221;backend&#8221;})</td>
</tr>
<tr class="row-odd"><td>conversors</td>
<td>Метод преобразования для применения к параметрам</td>
<td>&#64;Route(&#8220;/posts/{id}/{slug}&#8221;, conversors={id=&#8221;MyConversor::getId&#8221;})</td>
</tr>
</tbody>
</table>
<p>Для формирования маршрутов из контроллеров модулей стоит использовать метод addModuleResource:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$di</span><span class="p">[</span><span class="s1">&#39;router&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>

    <span class="c1">// Используем маршрутизатор на аннотациях</span>
    <span class="nv">$router</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Mvc\Router\Annotations</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>

    <span class="c1">// Чтение аннотаций из контроллера Backend\Controllers\ProductsController для ссылок начинающихся на /api/products</span>
    <span class="nv">$router</span><span class="o">-&gt;</span><span class="na">addModuleResource</span><span class="p">(</span><span class="s1">&#39;backend&#39;</span><span class="p">,</span> <span class="s1">&#39;Products&#39;</span><span class="p">,</span> <span class="s1">&#39;/api/products&#39;</span><span class="p">);</span>

    <span class="k">return</span> <span class="nv">$router</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="id20">
<h2>Создание собственного маршрутизатора<a class="headerlink" href="#id20" title="Ссылка на этот заголовок">¶</a></h2>
<p>Для создания адаптера необходимо реализовать интерфейс <a class="reference internal" href="../api/Phalcon_Mvc_RouterInterface.html"><em>Phalcon\Mvc\RouterInterface</em></a>.
Созданным классом надо подменить маршрутизатор (&#8216;router&#8217;) в момент инициализации приложения.</p>
</div>
</div>


                    </div>
                  </div>
                </div>
            </div>
          </td>
        </tr>
      </table>
    <div class="related">
      <ul>
        <li class="right" >
          <a href="../genindex.html" title="Словарь-указатель"
             >словарь</a></li>
        <li class="right" >
          <a href="dispatching.html" title="Диспетчер контроллеров"
             >следующий</a> |</li>
        <li class="right" >
          <a href="applications.html" title="MVC Приложения"
             >предыдущий</a> |</li> 
      </ul>
    </div>
        <div id="footer">

          <p>Нашли ошибку или опечатку? Желаете улучшить этот документ? Исходники русской документации доступны на <a href="http://github.com/phalcon/docs">Github</a></p>
          <p>Нужна помощь или возникли вопросы? Посетите <a href="http://phalconphp.com/ru/support">страницу помощи<</a></p>

          <p>Фреймворк Phalcon PHP распространяется с учетом <a href="https://github.com/phalcon/cphalcon/blob/master/docs/LICENSE.md">new BSD license</a>.</p>
          <p>Кроме случаев, когда указано иное, содержимое на этом сайте, защищено в соответствии с
            <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 License.</a></p>
             Последнее обновление Oct 21, 2014.
            Создано с использованием <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.

          <p>
             &copy; Copyright 2014, Phalcon Team.
          </p>

            <div class="size-wrap footer-wrap">

                <div class="donate-wrap">
                    Поддержать Phalcon: <a href="http://flattr.com/thing/1134206/Phalcon-PHP-Framework" target="_blank" class="button button-small orange">Flattr</a>
                    или
                    <form action="https://www.paypal.com/cgi-bin/webscr" method="post" style="display: inline">
                        <input type="hidden" name="cmd" value="_s-xclick">
                        <input type="hidden" name="hosted_button_id" value="7LSYMNMFZNG8W">
                        <input class="button button-small orange" style="border: inherit; display: inline; font-weight: bold" type="submit" value="via Paypal" title="PayPal — The safer, easier way to pay online.">
                    </form>
                </div>

                <div class="social-links">
                    <a href="https://twitter.com/phalconphp" class="social-link tw">Twitter</a>
                    <a href="http://www.facebook.com/pages/Phalcon/134230726685897" class="social-link fb">Facebook</a>
                    <a href="https://plus.google.com/102376109340560896457" class="social-link gp">Google Plus</a>
                    <a href="http://vimeo.com/user10964377" class="social-link vm">Vimeo</a>
                </div>

            </div>

        </div>

    </div>
  </body>
</html>