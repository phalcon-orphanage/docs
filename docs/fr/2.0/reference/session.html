
<!DOCTYPE html>

<html lang="en">
  <head>
    
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Stocker des données dans une session &mdash; Phalcon 1.3.0 documentation</title>
    <link href='http://fonts.googleapis.com/css?family=Ubuntu:400,500,700,300italic,400italic,500italic&amp;subset=latin,cyrillic-ext' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/docs.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.3.0',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/docs.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Phalcon 1.3.0 documentation" href="../index.html" />
    <link rel="next" title="Filtering and Sanitizing" href="filter.html" />
    <link rel="prev" title="Flashing Messages" href="flash.html" /> 
  </head>
  <body>
    <div id="wrapper">

        <div class="size-wrap">

            <div class="header clear-fix">
                <a class="header-logo" href="http://phalconphp.com"><span class="logo-text">Phalcon</span></a>
                <div class="header-right">
                    <iframe src="http://ghbtns.com/github-btn.html?user=phalcon&amp;repo=cphalcon&amp;type=watch&amp;count=true&amp;size=large"
allowtransparency="true" frameborder="0" scrolling="0" width="152px" height="30px"></iframe>
                </div>
                <ul class="header-nav">
                    <li><a href="http://phalconphp.com/" class="header-nav-link">Home</a></li>
                    <li><a href="http://phalconphp.com/download" class="header-nav-link">Download</a></li>
                    <li><a href="http://forum.phalconphp.com/" class="header-nav-link active">Forum</a></li>
                    <li><a href="http://blog.phalconphp.com/" class="header-nav-link">Blog</a></li>
                    <li><a href="http://phalconphp.com/support" class="header-nav-link">Support</a></li>
                    <li><a href="http://store.phalconphp.com/" class="header-nav-link">Store</a></li>
                    <li><a href="https://github.com/phalcon/cphalcon" class="header-nav-link">GitHub</a></li>
                </ul>
            </div>

        </div>
    <div class="header-line">
      <div class="size-wrap">
        <div class="header-line-title title-white">Documentation</div>
      </div>
    </div>
    <div class="related">
      <ul>
        <li class="right" >
          <a href="../genindex.html" title="Index général"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="filter.html" title="Filtering and Sanitizing"
             accesskey="N">suivant</a> |</li>
        <li class="right" >
          <a href="flash.html" title="Flashing Messages"
             accesskey="P">précédent</a> |</li>
        <li><a href="http://phalconphp.com">Home</a> &raquo;</li>
        <li><a href="../index.html">Phalcon 1.3.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

      <table width="90%" align="center">
        <tr>
      <td class="primary-box" width="25%" valign="top">
            <div>
            <div id="searchbox" style="">
                <!--<form class="search" action="http://readthedocs.org/search/project/" method="get">
                  <input type="search" name="q" size="25" placeholder="Search">
                  <input type="submit" value="Go">
                  <input type="hidden" name="selected_facets" value="project:">
                </form>-->
                <div style="width:200px;padding:10px">
                  <gcse:searchbox-only></gcse:searchbox-only>
                </div>
                <hr>
            </div>
            </div>
            <div style="padding:5px;padding-left:10px">
              <div id="carbonads-container">
                <div class="carbonad"><div id="azcarbon"></div>
                <script type="text/javascript">var z = document.createElement("script"); z.type = "text/javascript"; z.async = true; z.src = "http://engine.carbonads.com/z/56496/azcarbon_2_1_0_VERT"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(z, s);</script>
                </div></div>
            </div>
            <h3><a href="../index.html">Table des matières</a></h3>
            <ul>
<li><a class="reference internal" href="#">Stocker des données dans une session</a><ul>
<li><a class="reference internal" href="#commencer-la-session">Commencer la Session</a></li>
<li><a class="reference internal" href="#stocker-recuperer-les-donnees-en-session">Stocker/Récupérer les données en session</a></li>
<li><a class="reference internal" href="#supprimer-detruire-des-sessions">Supprimer / Détruire des sessions</a></li>
<li><a class="reference internal" href="#isoler-les-donnees-de-sessions-entre-les-applications">Isoler les données de sessions entre les applications</a></li>
<li><a class="reference internal" href="#sac-de-session">Sac de Session</a></li>
<li><a class="reference internal" href="#donnees-persistantes-dans-les-composants">Données persistantes dans les composants</a></li>
<li><a class="reference internal" href="#implementer-son-propre-adaptateur">Implémenter son propre adaptateur</a></li>
</ul>
</li>
</ul>

            <h4>Sujet précédent</h4>
            <p class="topless"><a href="flash.html" title="Chapitre précédent">&lt; Flashing Messages</a></p>
            <h4>Sujet suivant</h4>
            <p class="topless"><a href="filter.html" title="Chapitre suivant">Filtering and Sanitizing &gt;</a></p>
            <h3>Cette page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/reference/session.txt" rel="nofollow">Montrer la source</a></li>
            </ul>
        </td>
          <td class="second-box" valign="top">
            <div class="document">
                <div class="documentwrapper">
                  <div class="bodywrapper">
                    <div class="body" >
                      
  <p>Attention: cette traduction n&#8217;est pas parfaite, si des éléments vous paraissent faux ou mal expliqués, merci de modifier la documentation.</p>
<div class="section" id="stocker-des-donnees-dans-une-session">
<h1>Stocker des données dans une session<a class="headerlink" href="#stocker-des-donnees-dans-une-session" title="Lien permanent vers ce titre">¶</a></h1>
<p><a class="reference internal" href="../api/Phalcon_Session.html"><em>Phalcon\Session</em></a> fourni un ensemble de fonctions liés à la gestion des sessions.</p>
<p>Pourquoi utiliser ce composant plutôt que les sessions par défaut ?</p>
<ul class="simple">
<li>Vous pouvez facilement isoler des données de session à travers différentes applications du même domaine.</li>
<li>Vous pouvez intercepter où les sessions sont définis/récupérés (get/set) dans votre application.</li>
<li>Changer l&#8217;adaptateur de session en fonction de vos besoins.</li>
</ul>
<div class="section" id="commencer-la-session">
<h2>Commencer la Session<a class="headerlink" href="#commencer-la-session" title="Lien permanent vers ce titre">¶</a></h2>
<p>Certaines applications sont très dépendantes des sessions, pratiquement chaque action qui est réalisé nécessite l&#8217;accès aux données de sessions.
Il y a aussi d&#8217;autres applications qui nécessiteront moins les sessions.
Grâce au conteneur de services, on peux s&#8217;assurer que les sessions sont accessiblent seulement quand nécessaire :</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">//Start the session the first time when some component request the session service</span>
<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">setShared</span><span class="p">(</span><span class="s1">&#39;session&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$session</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Phalcon\Session\Adapter\Files</span><span class="p">();</span>
    <span class="nv">$session</span><span class="o">-&gt;</span><span class="na">start</span><span class="p">();</span>
    <span class="k">return</span> <span class="nv">$session</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="stocker-recuperer-les-donnees-en-session">
<h2>Stocker/Récupérer les données en session<a class="headerlink" href="#stocker-recuperer-les-donnees-en-session" title="Lien permanent vers ce titre">¶</a></h2>
<p>A partir d&#8217;un contrôleur, d&#8217;une vue ou de n&#8217;importe quel autre composant qui hérite de <a class="reference internal" href="../api/Phalcon_DI_Injectable.html"><em>Phalcon\DI\Injectable</em></a> vous pourrez
accéder aux services de session et stocker/récupérer des informations de cette manière :</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Phalcon\Mvc\Controller</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">indexAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//Set a session variable</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">session</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s2">&quot;user-name&quot;</span><span class="p">,</span> <span class="s2">&quot;Michael&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">welcomeAction</span><span class="p">()</span>
    <span class="p">{</span>

        <span class="c1">//Check if the variable is defined</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">session</span><span class="o">-&gt;</span><span class="na">has</span><span class="p">(</span><span class="s2">&quot;user-name&quot;</span><span class="p">))</span> <span class="p">{</span>

            <span class="c1">//Retrieve its value</span>
            <span class="nv">$name</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">session</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;user-name&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="supprimer-detruire-des-sessions">
<h2>Supprimer / Détruire des sessions<a class="headerlink" href="#supprimer-detruire-des-sessions" title="Lien permanent vers ce titre">¶</a></h2>
<p>Il est aussi tout à fait possible de supprimer des variables spécifiques de session ou de supprimer la session entièrement :</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Phalcon\Mvc\Controller</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">removeAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//Remove a session variable</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">session</span><span class="o">-&gt;</span><span class="na">remove</span><span class="p">(</span><span class="s2">&quot;user-name&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">logoutAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//Destroy the whole session</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">session</span><span class="o">-&gt;</span><span class="na">destroy</span><span class="p">();</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="isoler-les-donnees-de-sessions-entre-les-applications">
<h2>Isoler les données de sessions entre les applications<a class="headerlink" href="#isoler-les-donnees-de-sessions-entre-les-applications" title="Lien permanent vers ce titre">¶</a></h2>
<p>Des fois un utilisateur peut utiliser la même application plusieurs fois sur le même serveur, dans la même session.
Bien sûr, si on utilise des variables de session, nous voulons que chaque application ait ses propres données (même s&#8217;ils doivent utiliser les même noms de variable).
Pour résoudre ce problème, vous pouvez ajouter un prefix pour chaque sessions de variable créé dans une certaine application :</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">//Isolating the session data</span>
<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;session&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(){</span>

    <span class="c1">//All variables created will prefixed with &quot;my-app-1&quot;</span>
    <span class="nv">$session</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Phalcon\Session\Adapter\Files</span><span class="p">(</span>
        <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;uniqueId&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;my-app-1&#39;</span>
        <span class="p">)</span>
    <span class="p">);</span>

    <span class="nv">$session</span><span class="o">-&gt;</span><span class="na">start</span><span class="p">();</span>

    <span class="k">return</span> <span class="nv">$session</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="sac-de-session">
<h2>Sac de Session<a class="headerlink" href="#sac-de-session" title="Lien permanent vers ce titre">¶</a></h2>
<p><a class="reference internal" href="../api/Phalcon_Session_Bag.html"><em>Phalcon\Session\Bag</em></a> est un composant qui aide à séparer les données de sessions dans des &#8220;espaces de noms&#8221;.
En travaillant de cette manière on peux facilement créer des groupes de sessions dans l&#8217;application. En plaçant les variables dans le &#8220;sac&#8221;, cela stocke
automatiquement les données dans la session :</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$user</span>       <span class="o">=</span> <span class="k">new</span> <span class="nx">Phalcon\Session\Bag</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">);</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setDI</span><span class="p">(</span><span class="nv">$di</span><span class="p">);</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="s2">&quot;Kimbra Johnson&quot;</span><span class="p">;</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">age</span>  <span class="o">=</span> <span class="mi">22</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="donnees-persistantes-dans-les-composants">
<h2>Données persistantes dans les composants<a class="headerlink" href="#donnees-persistantes-dans-les-composants" title="Lien permanent vers ce titre">¶</a></h2>
<p>Les contrôleurs, composants et classes qui héritent de <a class="reference internal" href="../api/Phalcon_DI_Injectable.html"><em>Phalcon\DI\Injectable</em></a> peuvent injecter un <a class="reference internal" href="../api/Phalcon_Session_Bag.html"><em>Phalcon\Session\Bag</em></a>.
Cette classe isole les variables pour chaque classes.
Grace à cela, vous pouvez faire durer vos données entre les requêtes de chaque classes de manière indépendantes.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Phalcon\Mvc\Controller</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">indexAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Create a persistent variable &quot;name&quot;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">persistent</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="s2">&quot;Laura&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">welcomeAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">persistent</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">echo</span> <span class="s2">&quot;Welcome, &quot;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">persistent</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Dans un composant :</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">Security</span> <span class="k">extends</span> <span class="nx">Phalcon\Mvc\User\Component</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">auth</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Create a persistent variable &quot;name&quot;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">persistent</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="s2">&quot;Laura&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getAuthName</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">persistent</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Les données ajoutés à la session ($this-&gt;session) sont disponibles à travers toute l&#8217;application, tandis qu&#8217;avec $this-&gt;persistant, on ne peux y accéder qu&#8217;à
partir de la portée de la classe courante.</p>
</div>
<div class="section" id="implementer-son-propre-adaptateur">
<h2>Implémenter son propre adaptateur<a class="headerlink" href="#implementer-son-propre-adaptateur" title="Lien permanent vers ce titre">¶</a></h2>
<p><a class="reference internal" href="../api/Phalcon_Session_AdapterInterface.html"><em>Phalcon\Session\AdapterInterface</em></a> est une interface qui doit être implémentée pour créer ses propres adaptateurs de session
ou hériter d&#8217;adaptateurs déjà existants.</p>
<p>Il y a plus d&#8217;adaptateur disponibles pour ce composant dans l&#8217;<a class="reference external" href="https://github.com/phalcon/incubator/tree/master/Library/Phalcon/Session/Adapter">Incubator Phalcon</a></p>
</div>
</div>


                    </div>
                  </div>
                </div>
            </div>
          </td>
        </tr>
      </table>
    <div class="related">
      <ul>
        <li class="right" >
          <a href="../genindex.html" title="Index général"
             >index</a></li>
        <li class="right" >
          <a href="filter.html" title="Filtering and Sanitizing"
             >suivant</a> |</li>
        <li class="right" >
          <a href="flash.html" title="Flashing Messages"
             >précédent</a> |</li> 
      </ul>
    </div>
        <div id="footer">

          <p>Found a typo or an error? Want to improve this document? The documentation sources are available on <a href="http://github.com/phalcon/docs">Github</a></p>
          <p>Need support or have questions? Check our <a href="http://phalconphp.com/support">Support Page</a></p>

          <p>The Phalcon PHP Framework is released under the <a href="https://github.com/phalcon/cphalcon/blob/master/docs/LICENSE.md">new BSD license</a>.</p>
          <p>Except where otherwise noted, content on this site is licensed under the
            <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 License.</a></p>
             Mis à jour le Oct 21, 2014.
            Créé avec <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.

          <p>
             &copy; Copyright 2014, Phalcon Team and contributors.
          </p>

            <div class="size-wrap footer-wrap">

                <div class="donate-wrap">
                    Donate to Phalcon: <a href="http://flattr.com/thing/1134206/Phalcon-PHP-Framework" target="_blank" class="button button-small orange">Flattr</a>
                    or
                    <form action="https://www.paypal.com/cgi-bin/webscr" method="post" style="display: inline">
                        <input type="hidden" name="cmd" value="_s-xclick">
                        <input type="hidden" name="hosted_button_id" value="7LSYMNMFZNG8W">
                        <input class="button button-small orange" style="border: inherit; display: inline; font-weight: bold" type="submit" value="via Paypal" title="PayPal — The safer, easier way to pay online.">
                    </form>
                </div>

                <div class="social-links">
                    <a href="https://twitter.com/phalconphp" class="social-link tw">Twitter</a>
                    <a href="http://www.facebook.com/pages/Phalcon/134230726685897" class="social-link fb">Facebook</a>
                    <a href="https://plus.google.com/102376109340560896457" class="social-link gp">Google Plus</a>
                    <a href="http://vimeo.com/user10964377" class="social-link vm">Vimeo</a>
                </div>

            </div>

        </div>

    </div>
    <script type="text/javascript">
    $(window).on("load", function(){
      var cx = '009733439235723428699:lh9ltjgvdz8';
      var gcse = document.createElement('script');
      gcse.type = 'text/javascript';
      gcse.async = true;
      gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cx=' + cx;
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(gcse, s);
      /*window.setTimeout(function(){
        $('.gsc-search-button').css({
          'background': '#f06715',
          'padding': '2px',
          'border': '0'
        });
      }, 1000)*/
    });
    </script>

  </body>
</html>