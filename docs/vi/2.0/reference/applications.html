
<!DOCTYPE html>

<html lang="en">
  <head>
    
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MVC Applications &mdash; Phalcon 2.0.0 documentation</title>
    <link href="http://fonts.googleapis.com/css?family=Merriweather:400,700" rel="stylesheet" type="text/css" />
    <link href='http://fonts.googleapis.com/css?family=PT+Sans:400,700,400italic' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/fonts.css" type="text/css" />
    <link rel="stylesheet" href="../_static/docs.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.0.0',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/docs.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Phalcon 2.0.0 documentation" href="../index.html" />
    <link rel="next" title="Routing" href="routing.html" />
    <link rel="prev" title="Volt: Template Engine" href="volt.html" /> 
  </head>
  <body>
    <div id="wrapper">

        <div>
            <div class="header clear-fix">
                <a class="header-logo-x" href="http://phalconphp.com"><span xclass="logo-text">Phalcon</span></a>
                <!--<div class="header-right">
                    <iframe src="http://ghbtns.com/github-btn.html?user=phalcon&amp;repo=cphalcon&amp;type=watch&amp;count=true&amp;size=large"
allowtransparency="true" frameborder="0" scrolling="0" width="152px" height="30px"></iframe>
                </div>-->
                <ul class="header-nav">
                    <li><a href="http://phalconphp.com/" class="header-nav-link">Home</a></li>
                    <li><a href="http://phalconphp.com/download" class="header-nav-link">Download</a></li>
                    <li><a href="http://forum.phalconphp.com/" class="header-nav-link active">Forum</a></li>
                    <li><a href="http://blog.phalconphp.com/" class="header-nav-link">Blog</a></li>
                    <li><a href="http://phalconphp.com/support" class="header-nav-link">Support</a></li>
                    <li><a href="http://store.phalconphp.com/" class="header-nav-link">Store</a></li>
                    <li><a href="https://github.com/phalcon/cphalcon" class="header-nav-link">GitHub</a></li>
                </ul>
            </div>
        </div>
    <!--<div class="header-line">
      <div class="size-wrap">
        <div class="header-line-title title-white">Documentation</div>
      </div>
    </div>-->
    <div class="related">
      <ul>
        <li class="right" >
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="routing.html" title="Routing"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="volt.html" title="Volt: Template Engine"
             accesskey="P">previous</a> |</li>
        <li><a href="http://phalconphp.com">Home</a> &raquo;</li>
        <li><a href="../index.html">Phalcon 2.0.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

      <table width="100%" align="center">
        <tr>
      <td class="primary-box" width="25%" valign="top">
            <div>
            <div id="searchbox" style="">
                <!--<form class="search" action="http://readthedocs.org/search/project/" method="get">
                  <input type="search" name="q" size="25" placeholder="Search">
                  <input type="submit" value="Go">
                  <input type="hidden" name="selected_facets" value="project:">
                </form>-->
                <!--<div style="width:200px;padding:10px">
                  <gcse:searchbox-only></gcse:searchbox-only>
                </div>-->
            </div>
            </div>
            <!--<div style="padding:5px;padding-left:10px">
              <div id="carbonads-container">
                <div class="carbonad"><div id="azcarbon"></div>
                <script type="text/javascript">var z = document.createElement("script"); z.type = "text/javascript"; z.async = true; z.src = "http://engine.carbonads.com/z/56496/azcarbon_2_1_0_VERT"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(z, s);</script>
                </div></div>
            </div>-->
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">MVC Applications</a><ul>
<li><a class="reference internal" href="#single-or-multi-module-applications">Single or Multi Module Applications</a><ul>
<li><a class="reference internal" href="#single-module">Single Module</a></li>
<li><a class="reference internal" href="#multi-module">Multi Module</a></li>
</ul>
</li>
<li><a class="reference internal" href="#understanding-the-default-behavior">Understanding the default behavior</a></li>
<li><a class="reference internal" href="#manual-bootstrapping">Manual bootstrapping</a></li>
<li><a class="reference internal" href="#application-events">Application Events</a></li>
<li><a class="reference internal" href="#external-resources">External Resources</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="volt.html" title="previous chapter">&lt; Volt: Template Engine</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="routing.html" title="next chapter">Routing &gt;</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/reference/applications.txt" rel="nofollow">Show Source</a></li>
            </ul>
        </td>
          <td class="second-box" valign="top">
            <div class="document">
                <div class="documentwrapper">
                  <div class="bodywrapper">
                    <div class="body" >
                      
  <div class="section" id="mvc-applications">
<h1>MVC Applications<a class="headerlink" href="#mvc-applications" title="Permalink to this headline">¶</a></h1>
<p>All the hard work behind orchestrating the operation of MVC in Phalcon is normally done by
<a class="reference internal" href="../api/Phalcon_Mvc_Application.html"><em>Phalcon\Mvc\Application</em></a>. This component encapsulates all the complex
operations required in the background, instantiating every component needed and integrating it with the
project, to allow the MVC pattern to operate as desired.</p>
<div class="section" id="single-or-multi-module-applications">
<h2>Single or Multi Module Applications<a class="headerlink" href="#single-or-multi-module-applications" title="Permalink to this headline">¶</a></h2>
<p>With this component you can run various types of MVC structures:</p>
<div class="section" id="single-module">
<h3>Single Module<a class="headerlink" href="#single-module" title="Permalink to this headline">¶</a></h3>
<p>Single MVC applications consist of one module only. Namespaces can be used but are not necessary.
An application like this would have the following file structure:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">single/</span>
<span class="x">    app/</span>
<span class="x">        controllers/</span>
<span class="x">        models/</span>
<span class="x">        views/</span>
<span class="x">    public/</span>
<span class="x">        css/</span>
<span class="x">        img/</span>
<span class="x">        js/</span>
</pre></div>
</div>
<p>If namespaces are not used, the following bootstrap file could be used to orchestrate the MVC flow:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Loader</span><span class="p">,</span>
    <span class="nx">Phalcon\DI\FactoryDefault</span><span class="p">,</span>
    <span class="nx">Phalcon\Mvc\Application</span><span class="p">,</span>
    <span class="nx">Phalcon\Mvc\View</span><span class="p">;</span>

<span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Loader</span><span class="p">();</span>

<span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">registerDirs</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;../apps/controllers/&#39;</span><span class="p">,</span>
        <span class="s1">&#39;../apps/models/&#39;</span>
    <span class="p">)</span>
<span class="p">)</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">();</span>

<span class="nv">$di</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FactoryDefault</span><span class="p">();</span>

<span class="c1">// Registering the view component</span>
<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;view&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">View</span><span class="p">();</span>
    <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">setViewsDir</span><span class="p">(</span><span class="s1">&#39;../apps/views/&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$view</span><span class="p">;</span>
<span class="p">});</span>

<span class="k">try</span> <span class="p">{</span>

    <span class="nv">$application</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Application</span><span class="p">(</span><span class="nv">$di</span><span class="p">);</span>

    <span class="k">echo</span> <span class="nv">$application</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getContent</span><span class="p">();</span>

<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If namespaces are used, the following bootstrap can be used:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Loader</span><span class="p">,</span>
    <span class="nx">Phalcon\Mvc\View</span><span class="p">,</span>
    <span class="nx">Phalcon\DI\FactoryDefault</span><span class="p">,</span>
    <span class="nx">Phalcon\Mvc\Dispatcher</span><span class="p">,</span>
    <span class="nx">Phalcon\Mvc\Application</span><span class="p">;</span>

<span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Loader</span><span class="p">();</span>

<span class="c1">// Use autoloading with namespaces prefixes</span>
<span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">registerNamespaces</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;Single\Controllers&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;../apps/controllers/&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Single\Models&#39;</span>      <span class="o">=&gt;</span> <span class="s1">&#39;../apps/models/&#39;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">();</span>

<span class="nv">$di</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FactoryDefault</span><span class="p">();</span>

<span class="c1">// Register the dispatcher setting a Namespace for controllers</span>
<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;dispatcher&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$dispatcher</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Dispatcher</span><span class="p">();</span>
    <span class="nv">$dispatcher</span><span class="o">-&gt;</span><span class="na">setDefaultNamespace</span><span class="p">(</span><span class="s1">&#39;Single\Controllers&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$dispatcher</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// Registering the view component</span>
<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;view&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">View</span><span class="p">();</span>
    <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">setViewsDir</span><span class="p">(</span><span class="s1">&#39;../apps/views/&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$view</span><span class="p">;</span>
<span class="p">});</span>

<span class="k">try</span> <span class="p">{</span>

    <span class="nv">$application</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Application</span><span class="p">(</span><span class="nv">$di</span><span class="p">);</span>

    <span class="k">echo</span> <span class="nv">$application</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getContent</span><span class="p">();</span>

<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">){</span>
    <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="multi-module">
<h3>Multi Module<a class="headerlink" href="#multi-module" title="Permalink to this headline">¶</a></h3>
<p>A multi-module application uses the same document root for more than one module. In this case the following file structure can be used:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">multiple/</span>
<span class="x">  apps/</span>
<span class="x">    frontend/</span>
<span class="x">       controllers/</span>
<span class="x">       models/</span>
<span class="x">       views/</span>
<span class="x">       Module.php</span>
<span class="x">    backend/</span>
<span class="x">       controllers/</span>
<span class="x">       models/</span>
<span class="x">       views/</span>
<span class="x">       Module.php</span>
<span class="x">  public/</span>
<span class="x">    css/</span>
<span class="x">    img/</span>
<span class="x">    js/</span>
</pre></div>
</div>
<p>Each directory in apps/ have its own MVC structure. A Module.php is present to configure specific settings of each module like autoloaders or custom services:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Multiple\Backend</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Phalcon\Loader</span><span class="p">,</span>
    <span class="nx">Phalcon\Mvc\Dispatcher</span><span class="p">,</span>
    <span class="nx">Phalcon\Mvc\View</span><span class="p">,</span>
    <span class="nx">Phalcon\Mvc\ModuleDefinitionInterface</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Module</span> <span class="k">implements</span> <span class="nx">ModuleDefinitionInterface</span>
<span class="p">{</span>

    <span class="sd">/**</span>
<span class="sd">     * Register a specific autoloader for the module</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">registerAutoloaders</span><span class="p">()</span>
    <span class="p">{</span>

        <span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Loader</span><span class="p">();</span>

        <span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">registerNamespaces</span><span class="p">(</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;Multiple\Backend\Controllers&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;../apps/backend/controllers/&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Multiple\Backend\Models&#39;</span>      <span class="o">=&gt;</span> <span class="s1">&#39;../apps/backend/models/&#39;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">);</span>

        <span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Register specific services for the module</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">registerServices</span><span class="p">(</span><span class="nv">$di</span><span class="p">)</span>
    <span class="p">{</span>

        <span class="c1">//Registering a dispatcher</span>
        <span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;dispatcher&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nv">$dispatcher</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Dispatcher</span><span class="p">();</span>
            <span class="nv">$dispatcher</span><span class="o">-&gt;</span><span class="na">setDefaultNamespace</span><span class="p">(</span><span class="s2">&quot;Multiple\Backend\Controllers&quot;</span><span class="p">);</span>
            <span class="k">return</span> <span class="nv">$dispatcher</span><span class="p">;</span>
        <span class="p">});</span>

        <span class="c1">//Registering the view component</span>
        <span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;view&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nv">$view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">View</span><span class="p">();</span>
            <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">setViewsDir</span><span class="p">(</span><span class="s1">&#39;../apps/backend/views/&#39;</span><span class="p">);</span>
            <span class="k">return</span> <span class="nv">$view</span><span class="p">;</span>
        <span class="p">});</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>A special bootstrap file is required to load the a multi-module MVC architecture:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Mvc\Router</span><span class="p">,</span>
    <span class="nx">Phalcon\Mvc\Application</span><span class="p">,</span>
    <span class="nx">Phalcon\DI\FactoryDefault</span><span class="p">;</span>

<span class="nv">$di</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FactoryDefault</span><span class="p">();</span>

<span class="c1">//Specify routes for modules</span>
<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;router&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="nv">$router</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Router</span><span class="p">();</span>

    <span class="nv">$router</span><span class="o">-&gt;</span><span class="na">setDefaultModule</span><span class="p">(</span><span class="s2">&quot;frontend&quot;</span><span class="p">);</span>

    <span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s2">&quot;/login&quot;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;module&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;backend&#39;</span><span class="p">,</span>
        <span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span>
        <span class="s1">&#39;action&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;index&#39;</span><span class="p">,</span>
    <span class="p">));</span>

    <span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s2">&quot;/admin/products/:action&quot;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;module&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;backend&#39;</span><span class="p">,</span>
        <span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;products&#39;</span><span class="p">,</span>
        <span class="s1">&#39;action&#39;</span>     <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">));</span>

    <span class="nv">$router</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s2">&quot;/products/:action&quot;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;products&#39;</span><span class="p">,</span>
        <span class="s1">&#39;action&#39;</span>     <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">));</span>

    <span class="k">return</span> <span class="nv">$router</span><span class="p">;</span>
<span class="p">});</span>

<span class="k">try</span> <span class="p">{</span>

    <span class="c1">//Create an application</span>
    <span class="nv">$application</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Application</span><span class="p">(</span><span class="nv">$di</span><span class="p">);</span>

    <span class="c1">// Register the installed modules</span>
    <span class="nv">$application</span><span class="o">-&gt;</span><span class="na">registerModules</span><span class="p">(</span>
        <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;frontend&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;className&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Multiple\Frontend\Module&#39;</span><span class="p">,</span>
                <span class="s1">&#39;path&#39;</span>      <span class="o">=&gt;</span> <span class="s1">&#39;../apps/frontend/Module.php&#39;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="s1">&#39;backend&#39;</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;className&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Multiple\Backend\Module&#39;</span><span class="p">,</span>
                <span class="s1">&#39;path&#39;</span>      <span class="o">=&gt;</span> <span class="s1">&#39;../apps/backend/Module.php&#39;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">);</span>

    <span class="c1">//Handle the request</span>
    <span class="k">echo</span> <span class="nv">$application</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getContent</span><span class="p">();</span>

<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">){</span>
    <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you want to maintain the module configuration in the bootstrap file you can use an anonymous function to register the
module:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">//Creating a view component</span>
<span class="nv">$view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Mvc\View</span><span class="p">();</span>

<span class="c1">//Set options to view component</span>
<span class="c1">//...</span>

<span class="c1">// Register the installed modules</span>
<span class="nv">$application</span><span class="o">-&gt;</span><span class="na">registerModules</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;frontend&#39;</span> <span class="o">=&gt;</span> <span class="k">function</span><span class="p">(</span><span class="nv">$di</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$view</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$di</span><span class="o">-&gt;</span><span class="na">setShared</span><span class="p">(</span><span class="s1">&#39;view&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$view</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">setViewsDir</span><span class="p">(</span><span class="s1">&#39;../apps/frontend/views/&#39;</span><span class="p">);</span>
                <span class="k">return</span> <span class="nv">$view</span><span class="p">;</span>
            <span class="p">});</span>
        <span class="p">},</span>
        <span class="s1">&#39;backend&#39;</span> <span class="o">=&gt;</span> <span class="k">function</span><span class="p">(</span><span class="nv">$di</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$view</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$di</span><span class="o">-&gt;</span><span class="na">setShared</span><span class="p">(</span><span class="s1">&#39;view&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$view</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">setViewsDir</span><span class="p">(</span><span class="s1">&#39;../apps/backend/views/&#39;</span><span class="p">);</span>
                <span class="k">return</span> <span class="nv">$view</span><span class="p">;</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>When <a class="reference internal" href="../api/Phalcon_Mvc_Application.html"><em>Phalcon\Mvc\Application</em></a> have modules registered, always is
necessary that every matched route returns a valid module. Each registered module has an associated class
offering functions to set the module itself up. Each module class definition must implement two
methods: registerAutoloaders() and registerServices(), they will be called by
<a class="reference internal" href="../api/Phalcon_Mvc_Application.html"><em>Phalcon\Mvc\Application</em></a> according to the module to be executed.</p>
</div>
</div>
<div class="section" id="understanding-the-default-behavior">
<h2>Understanding the default behavior<a class="headerlink" href="#understanding-the-default-behavior" title="Permalink to this headline">¶</a></h2>
<p>If you&#8217;ve been following the <a class="reference internal" href="tutorial.html"><em>tutorial</em></a> or have generated the code using <a class="reference internal" href="tools.html"><em>Phalcon Devtools</em></a>,
you may recognize the following bootstrap file:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">try</span> <span class="p">{</span>

    <span class="c1">// Register autoloaders</span>
    <span class="c1">//...</span>

    <span class="c1">// Register services</span>
    <span class="c1">//...</span>

    <span class="c1">// Handle the request</span>
    <span class="nv">$application</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Mvc\Application</span><span class="p">(</span><span class="nv">$di</span><span class="p">);</span>

    <span class="k">echo</span> <span class="nv">$application</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getContent</span><span class="p">();</span>

<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">&quot;Exception: &quot;</span><span class="p">,</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The core of all the work of the controller occurs when handle() is invoked:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">echo</span> <span class="nv">$application</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getContent</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="manual-bootstrapping">
<h2>Manual bootstrapping<a class="headerlink" href="#manual-bootstrapping" title="Permalink to this headline">¶</a></h2>
<p>If you do not wish to use <a class="reference internal" href="../api/Phalcon_Mvc_Application.html"><em>Phalcon\Mvc\Application</em></a>, the code above can be changed as follows:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Get the &#39;router&#39; service</span>
<span class="nv">$router</span> <span class="o">=</span> <span class="nv">$di</span><span class="p">[</span><span class="s1">&#39;router&#39;</span><span class="p">];</span>

<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">();</span>

<span class="nv">$view</span> <span class="o">=</span> <span class="nv">$di</span><span class="p">[</span><span class="s1">&#39;view&#39;</span><span class="p">];</span>

<span class="nv">$dispatcher</span> <span class="o">=</span> <span class="nv">$di</span><span class="p">[</span><span class="s1">&#39;dispatcher&#39;</span><span class="p">];</span>

<span class="c1">// Pass the processed router parameters to the dispatcher</span>
<span class="nv">$dispatcher</span><span class="o">-&gt;</span><span class="na">setControllerName</span><span class="p">(</span><span class="nv">$router</span><span class="o">-&gt;</span><span class="na">getControllerName</span><span class="p">());</span>
<span class="nv">$dispatcher</span><span class="o">-&gt;</span><span class="na">setActionName</span><span class="p">(</span><span class="nv">$router</span><span class="o">-&gt;</span><span class="na">getActionName</span><span class="p">());</span>
<span class="nv">$dispatcher</span><span class="o">-&gt;</span><span class="na">setParams</span><span class="p">(</span><span class="nv">$router</span><span class="o">-&gt;</span><span class="na">getParams</span><span class="p">());</span>

<span class="c1">// Start the view</span>
<span class="nv">$view</span><span class="o">-&gt;</span><span class="na">start</span><span class="p">();</span>

<span class="c1">// Dispatch the request</span>
<span class="nv">$dispatcher</span><span class="o">-&gt;</span><span class="na">dispatch</span><span class="p">();</span>

<span class="c1">// Render the related views</span>
<span class="nv">$view</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span>
    <span class="nv">$dispatcher</span><span class="o">-&gt;</span><span class="na">getControllerName</span><span class="p">(),</span>
    <span class="nv">$dispatcher</span><span class="o">-&gt;</span><span class="na">getActionName</span><span class="p">(),</span>
    <span class="nv">$dispatcher</span><span class="o">-&gt;</span><span class="na">getParams</span><span class="p">()</span>
<span class="p">);</span>

<span class="c1">// Finish the view</span>
<span class="nv">$view</span><span class="o">-&gt;</span><span class="na">finish</span><span class="p">();</span>

<span class="nv">$response</span> <span class="o">=</span> <span class="nv">$di</span><span class="p">[</span><span class="s1">&#39;response&#39;</span><span class="p">];</span>

<span class="c1">// Pass the output of the view to the response</span>
<span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setContent</span><span class="p">(</span><span class="nv">$view</span><span class="o">-&gt;</span><span class="na">getContent</span><span class="p">());</span>

<span class="c1">// Send the request headers</span>
<span class="nv">$response</span><span class="o">-&gt;</span><span class="na">sendHeaders</span><span class="p">();</span>

<span class="c1">// Print the response</span>
<span class="k">echo</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getContent</span><span class="p">();</span>
</pre></div>
</div>
<p>The following replacement of <a class="reference internal" href="../api/Phalcon_Mvc_Application.html"><em>Phalcon\Mvc\Application</em></a> lacks of a view component making
it suitable for Rest APIs:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Get the &#39;router&#39; service</span>
<span class="nv">$router</span> <span class="o">=</span> <span class="nv">$di</span><span class="p">[</span><span class="s1">&#39;router&#39;</span><span class="p">];</span>

<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">();</span>

<span class="nv">$dispatcher</span> <span class="o">=</span> <span class="nv">$di</span><span class="p">[</span><span class="s1">&#39;dispatcher&#39;</span><span class="p">];</span>

<span class="c1">// Pass the processed router parameters to the dispatcher</span>
<span class="nv">$dispatcher</span><span class="o">-&gt;</span><span class="na">setControllerName</span><span class="p">(</span><span class="nv">$router</span><span class="o">-&gt;</span><span class="na">getControllerName</span><span class="p">());</span>
<span class="nv">$dispatcher</span><span class="o">-&gt;</span><span class="na">setActionName</span><span class="p">(</span><span class="nv">$router</span><span class="o">-&gt;</span><span class="na">getActionName</span><span class="p">());</span>
<span class="nv">$dispatcher</span><span class="o">-&gt;</span><span class="na">setParams</span><span class="p">(</span><span class="nv">$router</span><span class="o">-&gt;</span><span class="na">getParams</span><span class="p">());</span>

<span class="c1">// Dispatch the request</span>
<span class="nv">$dispatcher</span><span class="o">-&gt;</span><span class="na">dispatch</span><span class="p">();</span>

<span class="c1">//Get the returned value by the latest executed action</span>
<span class="nv">$response</span> <span class="o">=</span> <span class="nv">$dispatcher</span><span class="o">-&gt;</span><span class="na">getReturnedValue</span><span class="p">();</span>

<span class="c1">//Check if the action returned is a &#39;response&#39; object</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$response</span> <span class="nx">instanceof</span> <span class="nx">Phalcon\Http\ResponseInterface</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">//Send the request</span>
    <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Yet another alternative that catch exceptions produced in the dispatcher forwarding to other actions consequently:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Get the &#39;router&#39; service</span>
<span class="nv">$router</span> <span class="o">=</span> <span class="nv">$di</span><span class="p">[</span><span class="s1">&#39;router&#39;</span><span class="p">];</span>

<span class="nv">$router</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">();</span>

<span class="nv">$dispatcher</span> <span class="o">=</span> <span class="nv">$di</span><span class="p">[</span><span class="s1">&#39;dispatcher&#39;</span><span class="p">];</span>

<span class="c1">// Pass the processed router parameters to the dispatcher</span>
<span class="nv">$dispatcher</span><span class="o">-&gt;</span><span class="na">setControllerName</span><span class="p">(</span><span class="nv">$router</span><span class="o">-&gt;</span><span class="na">getControllerName</span><span class="p">());</span>
<span class="nv">$dispatcher</span><span class="o">-&gt;</span><span class="na">setActionName</span><span class="p">(</span><span class="nv">$router</span><span class="o">-&gt;</span><span class="na">getActionName</span><span class="p">());</span>
<span class="nv">$dispatcher</span><span class="o">-&gt;</span><span class="na">setParams</span><span class="p">(</span><span class="nv">$router</span><span class="o">-&gt;</span><span class="na">getParams</span><span class="p">());</span>

<span class="k">try</span> <span class="p">{</span>

    <span class="c1">// Dispatch the request</span>
    <span class="nv">$dispatcher</span><span class="o">-&gt;</span><span class="na">dispatch</span><span class="p">();</span>

<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">//An exception has occurred, dispatch some controller/action aimed for that</span>

    <span class="c1">// Pass the processed router parameters to the dispatcher</span>
    <span class="nv">$dispatcher</span><span class="o">-&gt;</span><span class="na">setControllerName</span><span class="p">(</span><span class="s1">&#39;errors&#39;</span><span class="p">);</span>
    <span class="nv">$dispatcher</span><span class="o">-&gt;</span><span class="na">setActionName</span><span class="p">(</span><span class="s1">&#39;action503&#39;</span><span class="p">);</span>

    <span class="c1">// Dispatch the request</span>
    <span class="nv">$dispatcher</span><span class="o">-&gt;</span><span class="na">dispatch</span><span class="p">();</span>

<span class="p">}</span>

<span class="c1">//Get the returned value by the latest executed action</span>
<span class="nv">$response</span> <span class="o">=</span> <span class="nv">$dispatcher</span><span class="o">-&gt;</span><span class="na">getReturnedValue</span><span class="p">();</span>

<span class="c1">//Check if the action returned is a &#39;response&#39; object</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$response</span> <span class="nx">instanceof</span> <span class="nx">Phalcon\Http\ResponseInterface</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">//Send the request</span>
    <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Although the above implementations are a lot more verbose than the code needed while using <a class="reference internal" href="../api/Phalcon_Mvc_Application.html"><em>Phalcon\Mvc\Application</em></a>,
it offers an alternative in bootstrapping your application. Depending on your needs, you might want to have full control of what
should be instantiated or not, or replace certain components with those of your own to extend the default functionality.</p>
</div>
<div class="section" id="application-events">
<h2>Application Events<a class="headerlink" href="#application-events" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../api/Phalcon_Mvc_Application.html"><em>Phalcon\Mvc\Application</em></a> is able to send events to the <a class="reference internal" href="events.html"><em>EventsManager</em></a>
(if it is present). Events are triggered using the type &#8220;application&#8221;. The following events are supported:</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Event Name</th>
<th class="head">Triggered</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>boot</td>
<td>Executed when the application handles its first request</td>
</tr>
<tr class="row-odd"><td>beforeStartModule</td>
<td>Before initialize a module, only when modules are registered</td>
</tr>
<tr class="row-even"><td>afterStartModule</td>
<td>After initialize a module, only when modules are registered</td>
</tr>
<tr class="row-odd"><td>beforeHandleRequest</td>
<td>Before execute the dispatch loop</td>
</tr>
<tr class="row-even"><td>afterHandleRequest</td>
<td>After execute the dispatch loop</td>
</tr>
</tbody>
</table>
<p>The following example demonstrates how to attach listeners to this component:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Events\Manager</span> <span class="k">as</span> <span class="nx">EventsManager</span><span class="p">;</span>

<span class="nv">$eventsManager</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventsManager</span><span class="p">();</span>

<span class="nv">$application</span><span class="o">-&gt;</span><span class="na">setEventsManager</span><span class="p">(</span><span class="nv">$eventsManager</span><span class="p">);</span>

<span class="nv">$eventsManager</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span>
    <span class="s2">&quot;application&quot;</span><span class="p">,</span>
    <span class="k">function</span><span class="p">(</span><span class="nv">$event</span><span class="p">,</span> <span class="nv">$application</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="external-resources">
<h2>External Resources<a class="headerlink" href="#external-resources" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://github.com/phalcon/mvc">MVC examples on Github</a></li>
</ul>
</div>
</div>


                    </div>
                  </div>
                </div>
            </div>
          </td>
        </tr>
      </table>
    <div class="related">
      <ul>
        <li class="right" >
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="routing.html" title="Routing"
             >next</a> |</li>
        <li class="right" >
          <a href="volt.html" title="Volt: Template Engine"
             >previous</a> |</li> 
      </ul>
    </div>
        <!--<div id="footer">

          <p>Found a typo or an error? Want to improve this document? The documentation sources are available on <a href="http://github.com/phalcon/docs">Github</a></p>
          <p>Need support or have questions? Check our <a href="http://forum.phalconphp.com">Forum</a></p>

          <p>The Phalcon Framework is released under the <a href="https://github.com/phalcon/cphalcon/blob/master/docs/LICENSE.md">new BSD license</a>.</p>
          <p>Except where otherwise noted, content on this site is licensed under the
            <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 License.</a></p>
             Last updated on Oct 21, 2014.
            Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.

          <p>
             &copy; Copyright 2014, Phalcon Team and contributors.
          </p>

            <div class="size-wrap footer-wrap">

                <div class="social-links">
                    <a href="https://twitter.com/phalconphp" class="social-link tw">Twitter</a>
                    <a href="http://www.facebook.com/pages/Phalcon/134230726685897" class="social-link fb">Facebook</a>
                    <a href="https://plus.google.com/102376109340560896457" class="social-link gp">Google Plus</a>
                    <a href="http://vimeo.com/user10964377" class="social-link vm">Vimeo</a>
                </div>

            </div>

        </div>-->

    </div>
    <script type="text/javascript">
    $(window).on("load", function(){
      var cx = '009733439235723428699:lh9ltjgvdz8';
      var gcse = document.createElement('script');
      gcse.type = 'text/javascript';
      gcse.async = true;
      gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cx=' + cx;
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(gcse, s);
    });
    </script>

  </body>
</html>