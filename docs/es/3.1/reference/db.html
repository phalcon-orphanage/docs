<!DOCTYPE html>

<html lang="en">
  <head>
    
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Database Abstraction Layer &mdash; documentación de Phalcon - 3.1.1 (Spanish / Español)</title>
    <meta name="keywords" content="php, phalcon, phalcon php, php framework, faster php framework">
    <link rel="stylesheet" type="text/css" href="https://netdna.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="//static.phalconphp.com/www/css/phalcon.min.css" />
    <link href='//fonts.googleapis.com/css?family=Open+Sans:700,400' rel='stylesheet' type='text/css'>
    <link href="//fonts.googleapis.com/css?family=Merriweather:400,700" rel="stylesheet" type="text/css" />
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" />
    <!--
    EUROPE <link href='//fonts.googleapis.com/css?family=Open+Sans:700,400&subset=latin-ext' rel='stylesheet' type='text/css'>
    GREEK <link href='//fonts.googleapis.com/css?family=Open+Sans:700,400&subset=greek-ext' rel='stylesheet' type='text/css'>
    RUSSIA <link href='//fonts.googleapis.com/css?family=Open+Sans:700,400&subset=cyrillic-ext,latin' rel='stylesheet' type='text/css'>
    -->

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/docs.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.1.1',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/docs.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="documentación de Phalcon - 3.1.1" href="../index.html" />
    <link rel="next" title="Internationalization" href="intl.html" />
    <link rel="prev" title="Queueing" href="queue.html" /> 
  </head>
  <body>

<header class="page-header">
    <nav class="navbar" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-menu-container">
                    <span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
                </button>
                <a class="navbar-brand phalcon-logo" href="/"><span itemprop="name" class="sr-only">Phalcon PHP</span></a>
            </div>

            <div class="collapse navbar-collapse navbar-right" id="main-menu-container">
                <ul class="nav navbar-nav main-menu">
                  <li class="first"><a href="//phalconphp.com/en/download" class="header-nav-link">Download</a></li>
                  <li><a href="//docs.phalconphp.com/en/latest/index.html" class="header-nav-link" target="_blank">Documentation</a></li>
                  <li><a href="//forum.phalconphp.com/" class="header-nav-link" target="_blank">Forum</a></li>
                  <li><a href="//blog.phalconphp.com/" class="header-nav-link" target="_blank">Blog</a></li>
                  <li><a href="//phalconist.com/" class="header-nav-link" target="_blank">Resources</a></li>
                  <li><a href="//phalconphp.com/en/about">About</a></li>
                  <li><div align="right">
                      <iframe src="https://ghbtns.com/github-btn.html?user=phalcon&amp;repo=cphalcon&amp;type=watch&amp;count=true&amp;size=large"
      allowtransparency="true" frameborder="0" scrolling="0" width="152px" height="30px"></iframe>
                    </div></li>
                </ul>
            </div>
        </div>
    </nav>
  </header>

<div class="heading">
    <div class="container">
        <div class="row">
            <h2>Documentation</h2>
        </div>
    </div>
</div>
    <div class="related">
      <ul>
        <li class="right" >
          <a href="../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="intl.html" title="Internationalization"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="queue.html" title="Queueing"
             accesskey="P">anterior</a> |</li>
        <li><a href="//phalconphp.com">Home</a> &raquo;</li>
        <li><a href="../index.html">documentación de Phalcon - 3.1.1</a> &raquo;</li> 
      </ul>
    </div>  

      <table width="100%" align="center" cellpadding="0" cellspacing="0">
        <tr>
      <td class="primary-box" width="25%" valign="top">
            <div>
            <div id="searchbox" style="">
                <!--<form class="search" action="http://readthedocs.org/search/project/" method="get">
                  <input type="search" name="q" size="25" placeholder="Search">
                  <input type="submit" value="Go">
                  <input type="hidden" name="selected_facets" value="project:">
                </form>-->
                <div style="width:200px;padding:10px">
                  <gcse:searchbox-only></gcse:searchbox-only>
                </div>
            </div>
            </div>
            <div style="padding:5px;padding-left:10px">
              <div id="carbonads-container">
                <div class="carbonad"><div id="azcarbon"></div>
                <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=phalconphpcom" id="_carbonads_js"></script>
                </div></div>
            </div>
            <h3><a href="../index.html">Tabla de Contenidos</a></h3>
            <ul>
<li><a class="reference internal" href="#">Database Abstraction Layer</a><ul>
<li><a class="reference internal" href="#database-adapters">Database Adapters</a><ul>
<li><a class="reference internal" href="#implementing-your-own-adapters">Implementing your own adapters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#database-dialects">Database Dialects</a><ul>
<li><a class="reference internal" href="#implementing-your-own-dialects">Implementing your own dialects</a></li>
</ul>
</li>
<li><a class="reference internal" href="#connecting-to-databases">Connecting to Databases</a></li>
<li><a class="reference internal" href="#setting-up-additional-pdo-options">Setting up additional PDO options</a></li>
<li><a class="reference internal" href="#finding-rows">Finding Rows</a></li>
<li><a class="reference internal" href="#binding-parameters">Binding Parameters</a></li>
<li><a class="reference internal" href="#inserting-updating-deleting-rows">Inserting/Updating/Deleting Rows</a></li>
<li><a class="reference internal" href="#transactions-and-nested-transactions">Transactions and Nested Transactions</a></li>
<li><a class="reference internal" href="#database-events">Database Events</a></li>
<li><a class="reference internal" href="#profiling-sql-statements">Profiling SQL Statements</a></li>
<li><a class="reference internal" href="#logging-sql-statements">Logging SQL Statements</a><ul>
<li><a class="reference internal" href="#implementing-your-own-logger">Implementing your own Logger</a></li>
</ul>
</li>
<li><a class="reference internal" href="#describing-tables-views">Describing Tables/Views</a></li>
<li><a class="reference internal" href="#creating-altering-dropping-tables">Creating/Altering/Dropping Tables</a><ul>
<li><a class="reference internal" href="#creating-tables">Creating Tables</a></li>
<li><a class="reference internal" href="#altering-tables">Altering Tables</a></li>
<li><a class="reference internal" href="#dropping-tables">Dropping Tables</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Tema anterior</h4>
            <p class="topless"><a href="queue.html" title="capítulo anterior">&lt; Queueing</a></p>
            <h4>Próximo tema</h4>
            <p class="topless"><a href="intl.html" title="próximo capítulo">Internationalization &gt;</a></p>
            <h3>Esta página</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/reference/db.txt" rel="nofollow">Mostrar el código</a></li>
            </ul>
        </td>
          <td class="second-box" valign="top">
            <div class="document">
                <div class="documentwrapper">
                  <div class="bodywrapper">
                    <div class="body" >
                      
  <div class="section" id="database-abstraction-layer">
<h1>Database Abstraction Layer<a class="headerlink" href="#database-abstraction-layer" title="Enlazar permanentemente con este título">¶</a></h1>
<p><a class="reference internal" href="../api/Phalcon_Db.html"><em>Phalcon\Db</em></a> is the component behind <a class="reference internal" href="../api/Phalcon_Mvc_Model.html"><em>Phalcon\Mvc\Model</em></a> that powers the model layer
in the framework. It consists of an independent high-level abstraction layer for database systems completely written in C.</p>
<p>This component allows for a lower level database manipulation than using traditional models.</p>
<blockquote class="highlights">
<div>This guide is not intended to be a complete documentation of available methods and their arguments. Please visit the <a class="reference internal" href="../api/index.html"><em>API</em></a>
for a complete reference.</div></blockquote>
<div class="section" id="database-adapters">
<h2>Database Adapters<a class="headerlink" href="#database-adapters" title="Enlazar permanentemente con este título">¶</a></h2>
<p>This component makes use of adapters to encapsulate specific database system details. Phalcon uses <a class="reference external" href="http://www.php.net/manual/en/book.pdo.php">PDO</a> to connect to databases. The following
database engines are supported:</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Class</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference internal" href="../api/Phalcon_Db_Adapter_Pdo_Mysql.html"><em>Phalcon\Db\Adapter\Pdo\Mysql</em></a></td>
<td>Is the world&#8217;s most used relational database management system (RDBMS) that runs as a server providing multi-user access to a number of databases</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="../api/Phalcon_Db_Adapter_Pdo_Postgresql.html"><em>Phalcon\Db\Adapter\Pdo\Postgresql</em></a></td>
<td>PostgreSQL is a powerful, open source relational database system. It has more than 15 years of active development and a proven architecture that has earned it a strong reputation for reliability, data integrity, and correctness.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../api/Phalcon_Db_Adapter_Pdo_Sqlite.html"><em>Phalcon\Db\Adapter\Pdo\Sqlite</em></a></td>
<td>SQLite is a software library that implements a self-contained, serverless, zero-configuration, transactional SQL database engine</td>
</tr>
</tbody>
</table>
<div class="section" id="implementing-your-own-adapters">
<h3>Implementing your own adapters<a class="headerlink" href="#implementing-your-own-adapters" title="Enlazar permanentemente con este título">¶</a></h3>
<p>The <a class="reference internal" href="../api/Phalcon_Db_AdapterInterface.html"><em>Phalcon\Db\AdapterInterface</em></a> interface must be implemented in order to create your own
database adapters or extend the existing ones.</p>
</div>
</div>
<div class="section" id="database-dialects">
<h2>Database Dialects<a class="headerlink" href="#database-dialects" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Phalcon encapsulates the specific details of each database engine in dialects. Those provide common functions and SQL generator to the adapters.</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="10%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head" colspan="2">Class</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td colspan="2"><a class="reference internal" href="../api/Phalcon_Db_Dialect_Mysql.html"><em>Phalcon\Db\Dialect\Mysql</em></a></td>
<td>SQL specific dialect for MySQL database system</td>
</tr>
<tr class="row-odd"><td colspan="2"><a class="reference internal" href="../api/Phalcon_Db_Dialect_Postgresql.html"><em>Phalcon\Db\Dialect\Postgresql</em></a></td>
<td>SQL specific dialect for PostgreSQL database system</td>
</tr>
<tr class="row-even"><td colspan="2"><a class="reference internal" href="../api/Phalcon_Db_Dialect_Sqlite.html"><em>Phalcon\Db\Dialect\Sqlite</em></a></td>
<td>SQL specific dialect for SQLite database system</td>
</tr>
</tbody>
</table>
<div class="section" id="implementing-your-own-dialects">
<h3>Implementing your own dialects<a class="headerlink" href="#implementing-your-own-dialects" title="Enlazar permanentemente con este título">¶</a></h3>
<p>The <a class="reference internal" href="../api/Phalcon_Db_DialectInterface.html"><em>Phalcon\Db\DialectInterface</em></a> interface must be implemented in order to create your own database dialects or extend the existing ones.</p>
</div>
</div>
<div class="section" id="connecting-to-databases">
<h2>Connecting to Databases<a class="headerlink" href="#connecting-to-databases" title="Enlazar permanentemente con este título">¶</a></h2>
<p>To create a connection it&#8217;s necessary instantiate the adapter class. It only requires an array with the connection parameters. The example
below shows how to create a connection passing both required and optional parameters:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Required</span>
<span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;host&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;username&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;mike&quot;</span><span class="p">,</span>
    <span class="s2">&quot;password&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;sigma&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dbname&quot;</span>   <span class="o">=&gt;</span> <span class="s2">&quot;test_db&quot;</span><span class="p">,</span>
<span class="p">];</span>

<span class="c1">// Optional</span>
<span class="nv">$config</span><span class="p">[</span><span class="s2">&quot;persistent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>

<span class="c1">// Create a connection</span>
<span class="nv">$connection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Db\Adapter\Pdo\Mysql</span><span class="p">(</span><span class="nv">$config</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Required</span>
<span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;host&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
    <span class="s2">&quot;username&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;postgres&quot;</span><span class="p">,</span>
    <span class="s2">&quot;password&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;secret1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dbname&quot;</span>   <span class="o">=&gt;</span> <span class="s2">&quot;template&quot;</span><span class="p">,</span>
<span class="p">];</span>

<span class="c1">// Optional</span>
<span class="nv">$config</span><span class="p">[</span><span class="s2">&quot;schema&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;public&quot;</span><span class="p">;</span>

<span class="c1">// Create a connection</span>
<span class="nv">$connection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Db\Adapter\Pdo\Postgresql</span><span class="p">(</span><span class="nv">$config</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Required</span>
<span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;dbname&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;/path/to/database.db&quot;</span><span class="p">,</span>
<span class="p">];</span>

<span class="c1">// Create a connection</span>
<span class="nv">$connection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Db\Adapter\Pdo\Sqlite</span><span class="p">(</span><span class="nv">$config</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-up-additional-pdo-options">
<h2>Setting up additional PDO options<a class="headerlink" href="#setting-up-additional-pdo-options" title="Enlazar permanentemente con este título">¶</a></h2>
<p>You can set PDO options at connection time by passing the parameters &#8216;options&#8217;:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Create a connection with PDO options</span>
<span class="nv">$connection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Db\Adapter\Pdo\Mysql</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="s2">&quot;host&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
        <span class="s2">&quot;username&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;root&quot;</span><span class="p">,</span>
        <span class="s2">&quot;password&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;sigma&quot;</span><span class="p">,</span>
        <span class="s2">&quot;dbname&quot;</span>   <span class="o">=&gt;</span> <span class="s2">&quot;test_db&quot;</span><span class="p">,</span>
        <span class="s2">&quot;options&quot;</span>  <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="nx">PDO</span><span class="o">::</span><span class="na">MYSQL_ATTR_INIT_COMMAND</span> <span class="o">=&gt;</span> <span class="s2">&quot;SET NAMES &#39;UTF8&#39;&quot;</span><span class="p">,</span>
            <span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_CASE</span>               <span class="o">=&gt;</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">CASE_LOWER</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">]</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="finding-rows">
<h2>Finding Rows<a class="headerlink" href="#finding-rows" title="Enlazar permanentemente con este título">¶</a></h2>
<p><a class="reference internal" href="../api/Phalcon_Db.html"><em>Phalcon\Db</em></a> provides several methods to query rows from tables. The specific SQL syntax of the target database engine is required in this case:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT id, name FROM robots ORDER BY name&quot;</span><span class="p">;</span>

<span class="c1">// Send a SQL statement to the database system</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>

<span class="c1">// Print each robot name</span>
<span class="k">while</span> <span class="p">(</span><span class="nv">$robot</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">())</span> <span class="p">{</span>
   <span class="k">echo</span> <span class="nv">$robot</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// Get all rows in an array</span>
<span class="nv">$robots</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">fetchAll</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$robots</span> <span class="k">as</span> <span class="nv">$robot</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">echo</span> <span class="nv">$robot</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// Get only the first row</span>
<span class="nv">$robot</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">fetchOne</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</pre></div>
</div>
<p>By default these calls create arrays with both associative and numeric indexes. You can change this behavior by using <code class="code docutils literal"><span class="pre">Phalcon\Db\Result::setFetchMode()</span></code>. This method receives a constant, defining which kind of index is required.</p>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Constant</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="code docutils literal"><span class="pre">Phalcon\Db::FETCH_NUM</span></code></td>
<td>Return an array with numeric indexes</td>
</tr>
<tr class="row-odd"><td><code class="code docutils literal"><span class="pre">Phalcon\Db::FETCH_ASSOC</span></code></td>
<td>Return an array with associative indexes</td>
</tr>
<tr class="row-even"><td><code class="code docutils literal"><span class="pre">Phalcon\Db::FETCH_BOTH</span></code></td>
<td>Return an array with both associative and numeric indexes</td>
</tr>
<tr class="row-odd"><td><code class="code docutils literal"><span class="pre">Phalcon\Db::FETCH_OBJ</span></code></td>
<td>Return an object instead of an array</td>
</tr>
</tbody>
</table>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT id, name FROM robots ORDER BY name&quot;</span><span class="p">;</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>

<span class="nv">$result</span><span class="o">-&gt;</span><span class="na">setFetchMode</span><span class="p">(</span><span class="nx">Phalcon\Db</span><span class="o">::</span><span class="na">FETCH_NUM</span><span class="p">);</span>
<span class="k">while</span> <span class="p">(</span><span class="nv">$robot</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">())</span> <span class="p">{</span>
   <span class="k">echo</span> <span class="nv">$robot</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="code docutils literal"><span class="pre">Phalcon\Db::query()</span></code> returns an instance of <a class="reference internal" href="../api/Phalcon_Db_Result_Pdo.html"><em>Phalcon\Db\Result\Pdo</em></a>. These objects encapsulate all the functionality related to the returned resultset i.e. traversing, seeking specific records, count etc.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT id, name FROM robots&quot;</span><span class="p">;</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>

<span class="c1">// Traverse the resultset</span>
<span class="k">while</span> <span class="p">(</span><span class="nv">$robot</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">())</span> <span class="p">{</span>
   <span class="k">echo</span> <span class="nv">$robot</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// Seek to the third row</span>
<span class="nv">$result</span><span class="o">-&gt;</span><span class="na">seek</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="nv">$robot</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">();</span>

<span class="c1">// Count the resultset</span>
<span class="k">echo</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">numRows</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="binding-parameters">
<h2>Binding Parameters<a class="headerlink" href="#binding-parameters" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Bound parameters is also supported in <a class="reference internal" href="../api/Phalcon_Db.html"><em>Phalcon\Db</em></a>. Although there is a minimal performance impact by using
bound parameters, you are encouraged to use this methodology so as to eliminate the possibility of your code being subject to SQL
injection attacks. Both string and positional placeholders are supported. Binding parameters can simply be achieved as follows:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Binding with numeric placeholders</span>
<span class="nv">$sql</span>    <span class="o">=</span> <span class="s2">&quot;SELECT * FROM robots WHERE name = ? ORDER BY name&quot;</span><span class="p">;</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span>
    <span class="nv">$sql</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s2">&quot;Wall-E&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">);</span>

<span class="c1">// Binding with named placeholders</span>
<span class="nv">$sql</span>     <span class="o">=</span> <span class="s2">&quot;INSERT INTO `robots`(name`, year) VALUES (:name, :year)&quot;</span><span class="p">;</span>
<span class="nv">$success</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span>
    <span class="nv">$sql</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s2">&quot;name&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Astro Boy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;year&quot;</span> <span class="o">=&gt;</span> <span class="mi">1952</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">);</span>
</pre></div>
</div>
<p>When using numeric placeholders, you will need to define them as integers i.e. 1 or 2. In this case &#8220;1&#8221; or &#8220;2&#8221;
are considered strings and not numbers, so the placeholder could not be successfully replaced. With any adapter
data are automatically escaped using <a class="reference external" href="http://www.php.net/manual/en/pdo.quote.php">PDO Quote</a>.</p>
<p>This function takes into account the connection charset, so its recommended to define the correct charset
in the connection parameters or in your database server configuration, as a wrong
charset will produce undesired effects when storing or retrieving data.</p>
<p>Also, you can pass your parameters directly to the execute/query methods. In this case
bound parameters are directly passed to PDO:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Binding with PDO placeholders</span>
<span class="nv">$sql</span>    <span class="o">=</span> <span class="s2">&quot;SELECT * FROM robots WHERE name = ? ORDER BY name&quot;</span><span class="p">;</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span>
    <span class="nv">$sql</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="mi">1</span> <span class="o">=&gt;</span> <span class="s2">&quot;Wall-E&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="inserting-updating-deleting-rows">
<h2>Inserting/Updating/Deleting Rows<a class="headerlink" href="#inserting-updating-deleting-rows" title="Enlazar permanentemente con este título">¶</a></h2>
<p>To insert, update or delete rows, you can use raw SQL or use the preset functions provided by the class:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Inserting data with a raw SQL statement</span>
<span class="nv">$sql</span>     <span class="o">=</span> <span class="s2">&quot;INSERT INTO `robots`(`name`, `year`) VALUES (&#39;Astro Boy&#39;, 1952)&quot;</span><span class="p">;</span>
<span class="nv">$success</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>

<span class="c1">// With placeholders</span>
<span class="nv">$sql</span>     <span class="o">=</span> <span class="s2">&quot;INSERT INTO `robots`(`name`, `year`) VALUES (?, ?)&quot;</span><span class="p">;</span>
<span class="nv">$success</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span>
    <span class="nv">$sql</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s2">&quot;Astro Boy&quot;</span><span class="p">,</span>
        <span class="mi">1952</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">);</span>

<span class="c1">// Generating dynamically the necessary SQL</span>
<span class="nv">$success</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span>
    <span class="s2">&quot;robots&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s2">&quot;Astro Boy&quot;</span><span class="p">,</span>
        <span class="mi">1952</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="p">[</span>
        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;year&quot;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">);</span>

<span class="c1">// Generating dynamically the necessary SQL (another syntax)</span>
<span class="nv">$success</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">insertAsDict</span><span class="p">(</span>
    <span class="s2">&quot;robots&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s2">&quot;name&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Astro Boy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;year&quot;</span> <span class="o">=&gt;</span> <span class="mi">1952</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">);</span>

<span class="c1">// Updating data with a raw SQL statement</span>
<span class="nv">$sql</span>     <span class="o">=</span> <span class="s2">&quot;UPDATE `robots` SET `name` = &#39;Astro boy&#39; WHERE `id` = 101&quot;</span><span class="p">;</span>
<span class="nv">$success</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>

<span class="c1">// With placeholders</span>
<span class="nv">$sql</span>     <span class="o">=</span> <span class="s2">&quot;UPDATE `robots` SET `name` = ? WHERE `id` = ?&quot;</span><span class="p">;</span>
<span class="nv">$success</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span>
    <span class="nv">$sql</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s2">&quot;Astro Boy&quot;</span><span class="p">,</span>
        <span class="mi">101</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">);</span>

<span class="c1">// Generating dynamically the necessary SQL</span>
<span class="nv">$success</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">(</span>
    <span class="s2">&quot;robots&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="p">[</span>
        <span class="s2">&quot;New Astro Boy&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="s2">&quot;id = 101&quot;</span> <span class="c1">// Warning! In this case values are not escaped</span>
<span class="p">);</span>

<span class="c1">// Generating dynamically the necessary SQL (another syntax)</span>
<span class="nv">$success</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">updateAsDict</span><span class="p">(</span>
    <span class="s2">&quot;robots&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s2">&quot;name&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;New Astro Boy&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="s2">&quot;id = 101&quot;</span> <span class="c1">// Warning! In this case values are not escaped</span>
<span class="p">);</span>

<span class="c1">// With escaping conditions</span>
<span class="nv">$success</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">(</span>
    <span class="s2">&quot;robots&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="p">[</span>
        <span class="s2">&quot;New Astro Boy&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="p">[</span>
        <span class="s2">&quot;conditions&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;id = ?&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bind&quot;</span>       <span class="o">=&gt;</span> <span class="p">[</span><span class="mi">101</span><span class="p">],</span>
        <span class="s2">&quot;bindTypes&quot;</span>  <span class="o">=&gt;</span> <span class="p">[</span><span class="nx">PDO</span><span class="o">::</span><span class="na">PARAM_INT</span><span class="p">],</span> <span class="c1">// Optional parameter</span>
    <span class="p">]</span>
<span class="p">);</span>
<span class="nv">$success</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">updateAsDict</span><span class="p">(</span>
    <span class="s2">&quot;robots&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s2">&quot;name&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;New Astro Boy&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="p">[</span>
        <span class="s2">&quot;conditions&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;id = ?&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bind&quot;</span>       <span class="o">=&gt;</span> <span class="p">[</span><span class="mi">101</span><span class="p">],</span>
        <span class="s2">&quot;bindTypes&quot;</span>  <span class="o">=&gt;</span> <span class="p">[</span><span class="nx">PDO</span><span class="o">::</span><span class="na">PARAM_INT</span><span class="p">],</span> <span class="c1">// Optional parameter</span>
    <span class="p">]</span>
<span class="p">);</span>

<span class="c1">// Deleting data with a raw SQL statement</span>
<span class="nv">$sql</span>     <span class="o">=</span> <span class="s2">&quot;DELETE `robots` WHERE `id` = 101&quot;</span><span class="p">;</span>
<span class="nv">$success</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>

<span class="c1">// With placeholders</span>
<span class="nv">$sql</span>     <span class="o">=</span> <span class="s2">&quot;DELETE `robots` WHERE `id` = ?&quot;</span><span class="p">;</span>
<span class="nv">$success</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="nv">$sql</span><span class="p">,</span> <span class="p">[</span><span class="mi">101</span><span class="p">]);</span>

<span class="c1">// Generating dynamically the necessary SQL</span>
<span class="nv">$success</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span>
    <span class="s2">&quot;robots&quot;</span><span class="p">,</span>
    <span class="s2">&quot;id = ?&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="mi">101</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="transactions-and-nested-transactions">
<h2>Transactions and Nested Transactions<a class="headerlink" href="#transactions-and-nested-transactions" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Working with transactions is supported as it is with PDO. Perform data manipulation inside transactions
often increase the performance on most database systems:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="c1">// Start a transaction</span>
    <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">begin</span><span class="p">();</span>

    <span class="c1">// Execute some SQL statements</span>
    <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="s2">&quot;DELETE `robots` WHERE `id` = 101&quot;</span><span class="p">);</span>
    <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="s2">&quot;DELETE `robots` WHERE `id` = 102&quot;</span><span class="p">);</span>
    <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="s2">&quot;DELETE `robots` WHERE `id` = 103&quot;</span><span class="p">);</span>

    <span class="c1">// Commit if everything goes well</span>
    <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">commit</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// An exception has occurred rollback the transaction</span>
    <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">rollback</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In addition to standard transactions, <a class="reference internal" href="../api/Phalcon_Db.html"><em>Phalcon\Db</em></a> provides built-in support for <a class="reference external" href="http://en.wikipedia.org/wiki/Nested_transaction">nested transactions</a>
(if the database system used supports them). When you call begin() for a second time a nested transaction
is created:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="c1">// Start a transaction</span>
    <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">begin</span><span class="p">();</span>

    <span class="c1">// Execute some SQL statements</span>
    <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="s2">&quot;DELETE `robots` WHERE `id` = 101&quot;</span><span class="p">);</span>

    <span class="k">try</span> <span class="p">{</span>
        <span class="c1">// Start a nested transaction</span>
        <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">begin</span><span class="p">();</span>

        <span class="c1">// Execute these SQL statements into the nested transaction</span>
        <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="s2">&quot;DELETE `robots` WHERE `id` = 102&quot;</span><span class="p">);</span>
        <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="s2">&quot;DELETE `robots` WHERE `id` = 103&quot;</span><span class="p">);</span>

        <span class="c1">// Create a save point</span>
        <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">commit</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// An error has occurred, release the nested transaction</span>
        <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">rollback</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// Continue, executing more SQL statements</span>
    <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="s2">&quot;DELETE `robots` WHERE `id` = 104&quot;</span><span class="p">);</span>

    <span class="c1">// Commit if everything goes well</span>
    <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">commit</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// An exception has occurred rollback the transaction</span>
    <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">rollback</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="database-events">
<h2>Database Events<a class="headerlink" href="#database-events" title="Enlazar permanentemente con este título">¶</a></h2>
<p><a class="reference internal" href="../api/Phalcon_Db.html"><em>Phalcon\Db</em></a> is able to send events to a <a class="reference internal" href="events.html"><em>EventsManager</em></a> if it&#8217;s present. Some events when returning boolean false could stop the active operation. The following events are supported:</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="58%" />
<col width="21%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Event Name</th>
<th class="head">Triggered</th>
<th class="head">Can stop operation?</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>afterConnect</td>
<td>After a successfully connection to a database system</td>
<td>No</td>
</tr>
<tr class="row-odd"><td>beforeQuery</td>
<td>Before send a SQL statement to the database system</td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>afterQuery</td>
<td>After send a SQL statement to database system</td>
<td>No</td>
</tr>
<tr class="row-odd"><td>beforeDisconnect</td>
<td>Before close a temporal database connection</td>
<td>No</td>
</tr>
<tr class="row-even"><td>beginTransaction</td>
<td>Before a transaction is going to be started</td>
<td>No</td>
</tr>
<tr class="row-odd"><td>rollbackTransaction</td>
<td>Before a transaction is rollbacked</td>
<td>No</td>
</tr>
<tr class="row-even"><td>commitTransaction</td>
<td>Before a transaction is committed</td>
<td>No</td>
</tr>
</tbody>
</table>
<p>Bind an EventsManager to a connection is simple, <a class="reference internal" href="../api/Phalcon_Db.html"><em>Phalcon\Db</em></a> will trigger the events with the type &#8220;db&#8221;:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Events\Manager</span> <span class="k">as</span> <span class="nx">EventsManager</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Phalcon\Db\Adapter\Pdo\Mysql</span> <span class="k">as</span> <span class="nx">Connection</span><span class="p">;</span>

<span class="nv">$eventsManager</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventsManager</span><span class="p">();</span>

<span class="c1">// Listen all the database events</span>
<span class="nv">$eventsManager</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span><span class="s1">&#39;db&#39;</span><span class="p">,</span> <span class="nv">$dbListener</span><span class="p">);</span>

<span class="nv">$connection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Connection</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="s2">&quot;host&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
        <span class="s2">&quot;username&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;root&quot;</span><span class="p">,</span>
        <span class="s2">&quot;password&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;secret&quot;</span><span class="p">,</span>
        <span class="s2">&quot;dbname&quot;</span>   <span class="o">=&gt;</span> <span class="s2">&quot;invo&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">);</span>

<span class="c1">// Assign the eventsManager to the db adapter instance</span>
<span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">setEventsManager</span><span class="p">(</span><span class="nv">$eventsManager</span><span class="p">);</span>
</pre></div>
</div>
<p>Stop SQL operations are very useful if for example you want to implement some last-resource SQL injector checker:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Events\Event</span><span class="p">;</span>

<span class="nv">$eventsManager</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span>
    <span class="s2">&quot;db:beforeQuery&quot;</span><span class="p">,</span>
    <span class="k">function</span> <span class="p">(</span><span class="nx">Event</span> <span class="nv">$event</span><span class="p">,</span> <span class="nv">$connection</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$sql</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">getSQLStatement</span><span class="p">();</span>

        <span class="c1">// Check for malicious words in SQL statements</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s2">&quot;/DROP|ALTER/i&quot;</span><span class="p">,</span> <span class="nv">$sql</span><span class="p">))</span> <span class="p">{</span>
            <span class="c1">// DROP/ALTER operations aren&#39;t allowed in the application,</span>
            <span class="c1">// this must be a SQL injection!</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// It&#39;s OK</span>
        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="profiling-sql-statements">
<h2>Profiling SQL Statements<a class="headerlink" href="#profiling-sql-statements" title="Enlazar permanentemente con este título">¶</a></h2>
<p><a class="reference internal" href="../api/Phalcon_Db.html"><em>Phalcon\Db</em></a> includes a profiling component called <a class="reference internal" href="../api/Phalcon_Db_Profiler.html"><em>Phalcon\Db\Profiler</em></a>, that is used to analyze the performance of database operations so as to diagnose performance problems and discover bottlenecks.</p>
<p>Database profiling is really easy With <a class="reference internal" href="../api/Phalcon_Db_Profiler.html"><em>Phalcon\Db\Profiler</em></a>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Events\Event</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Phalcon\Events\Manager</span> <span class="k">as</span> <span class="nx">EventsManager</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Phalcon\Db\Profiler</span> <span class="k">as</span> <span class="nx">DbProfiler</span><span class="p">;</span>

<span class="nv">$eventsManager</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventsManager</span><span class="p">();</span>

<span class="nv">$profiler</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DbProfiler</span><span class="p">();</span>

<span class="c1">// Listen all the database events</span>
<span class="nv">$eventsManager</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span>
    <span class="s2">&quot;db&quot;</span><span class="p">,</span>
    <span class="k">function</span> <span class="p">(</span><span class="nx">Event</span> <span class="nv">$event</span><span class="p">,</span> <span class="nv">$connection</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$profiler</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getType</span><span class="p">()</span> <span class="o">===</span> <span class="s2">&quot;beforeQuery&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$sql</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">getSQLStatement</span><span class="p">();</span>

            <span class="c1">// Start a profile with the active connection</span>
            <span class="nv">$profiler</span><span class="o">-&gt;</span><span class="na">startProfile</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getType</span><span class="p">()</span> <span class="o">===</span> <span class="s2">&quot;afterQuery&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Stop the active profile</span>
            <span class="nv">$profiler</span><span class="o">-&gt;</span><span class="na">stopProfile</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">);</span>

<span class="c1">// Assign the events manager to the connection</span>
<span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">setEventsManager</span><span class="p">(</span><span class="nv">$eventsManager</span><span class="p">);</span>

<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT buyer_name, quantity, product_name &quot;</span>
     <span class="o">.</span> <span class="s2">&quot;FROM buyers &quot;</span>
     <span class="o">.</span> <span class="s2">&quot;LEFT JOIN products ON buyers.pid = products.id&quot;</span><span class="p">;</span>

<span class="c1">// Execute a SQL statement</span>
<span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>

<span class="c1">// Get the last profile in the profiler</span>
<span class="nv">$profile</span> <span class="o">=</span> <span class="nv">$profiler</span><span class="o">-&gt;</span><span class="na">getLastProfile</span><span class="p">();</span>

<span class="k">echo</span> <span class="s2">&quot;SQL Statement: &quot;</span><span class="p">,</span> <span class="nv">$profile</span><span class="o">-&gt;</span><span class="na">getSQLStatement</span><span class="p">(),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="k">echo</span> <span class="s2">&quot;Start Time: &quot;</span><span class="p">,</span> <span class="nv">$profile</span><span class="o">-&gt;</span><span class="na">getInitialTime</span><span class="p">(),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="k">echo</span> <span class="s2">&quot;Final Time: &quot;</span><span class="p">,</span> <span class="nv">$profile</span><span class="o">-&gt;</span><span class="na">getFinalTime</span><span class="p">(),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="k">echo</span> <span class="s2">&quot;Total Elapsed Time: &quot;</span><span class="p">,</span> <span class="nv">$profile</span><span class="o">-&gt;</span><span class="na">getTotalElapsedSeconds</span><span class="p">(),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>You can also create your own profile class based on <a class="reference internal" href="../api/Phalcon_Db_Profiler.html"><em>Phalcon\Db\Profiler</em></a> to record real time statistics of the statements sent to the database system:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Events\Manager</span> <span class="k">as</span> <span class="nx">EventsManager</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Phalcon\Db\Profiler</span> <span class="k">as</span> <span class="nx">Profiler</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Phalcon\Db\Profiler\Item</span> <span class="k">as</span> <span class="nx">Item</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DbProfiler</span> <span class="k">extends</span> <span class="nx">Profiler</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Executed before the SQL statement will sent to the db server</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">beforeStartProfile</span><span class="p">(</span><span class="nx">Item</span> <span class="nv">$profile</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$profile</span><span class="o">-&gt;</span><span class="na">getSQLStatement</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Executed after the SQL statement was sent to the db server</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">afterEndProfile</span><span class="p">(</span><span class="nx">Item</span> <span class="nv">$profile</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$profile</span><span class="o">-&gt;</span><span class="na">getTotalElapsedSeconds</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Create an Events Manager</span>
<span class="nv">$eventsManager</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventsManager</span><span class="p">();</span>

<span class="c1">// Create a listener</span>
<span class="nv">$dbProfiler</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DbProfiler</span><span class="p">();</span>

<span class="c1">// Attach the listener listening for all database events</span>
<span class="nv">$eventsManager</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span><span class="s2">&quot;db&quot;</span><span class="p">,</span> <span class="nv">$dbProfiler</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="logging-sql-statements">
<h2>Logging SQL Statements<a class="headerlink" href="#logging-sql-statements" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Using high-level abstraction components such as <a class="reference internal" href="../api/Phalcon_Db.html"><em>Phalcon\Db</em></a> to access a database, it is difficult to understand which statements are sent to the database system. <a class="reference internal" href="../api/Phalcon_Logger.html"><em>Phalcon\Logger</em></a> interacts with <a class="reference internal" href="../api/Phalcon_Db.html"><em>Phalcon\Db</em></a>, providing logging capabilities on the database abstraction layer.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Logger</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Phalcon\Events\Event</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Phalcon\Events\Manager</span> <span class="k">as</span> <span class="nx">EventsManager</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Phalcon\Logger\Adapter\File</span> <span class="k">as</span> <span class="nx">FileLogger</span><span class="p">;</span>

<span class="nv">$eventsManager</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventsManager</span><span class="p">();</span>

<span class="nv">$logger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FileLogger</span><span class="p">(</span><span class="s2">&quot;app/logs/db.log&quot;</span><span class="p">);</span>

<span class="nv">$eventsManager</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span>
    <span class="s2">&quot;db:beforeQuery&quot;</span><span class="p">,</span>
    <span class="k">function</span> <span class="p">(</span><span class="nx">Event</span> <span class="nv">$event</span><span class="p">,</span> <span class="nv">$connection</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$logger</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$sql</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">getSQLStatement</span><span class="p">();</span>

        <span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">log</span><span class="p">(</span><span class="nv">$sql</span><span class="p">,</span> <span class="nx">Logger</span><span class="o">::</span><span class="na">INFO</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">);</span>

<span class="c1">// Assign the eventsManager to the db adapter instance</span>
<span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">setEventsManager</span><span class="p">(</span><span class="nv">$eventsManager</span><span class="p">);</span>

<span class="c1">// Execute some SQL statement</span>
<span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span>
    <span class="s2">&quot;products&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s2">&quot;Hot pepper&quot;</span><span class="p">,</span>
        <span class="mf">3.50</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="p">[</span>
        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;price&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">);</span>
</pre></div>
</div>
<p>As above, the file <em>app/logs/db.log</em> will contain something like this:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">[Sun, 29 Apr 12 22:35:26 -0500][DEBUG][Resource Id #77] INSERT INTO products</span>
<span class="x">(name, price) VALUES (&#39;Hot pepper&#39;, 3.50)</span>
</pre></div>
</div>
<div class="section" id="implementing-your-own-logger">
<h3>Implementing your own Logger<a class="headerlink" href="#implementing-your-own-logger" title="Enlazar permanentemente con este título">¶</a></h3>
<p>You can implement your own logger class for database queries, by creating a class that implements a single method called &#8220;log&#8221;.
The method needs to accept a string as the first argument. You can then pass your logging object to <code class="code docutils literal"><span class="pre">Phalcon\Db::setLogger()</span></code>,
and from then on any SQL statement executed will call that method to log the results.</p>
</div>
</div>
<div class="section" id="describing-tables-views">
<h2>Describing Tables/Views<a class="headerlink" href="#describing-tables-views" title="Enlazar permanentemente con este título">¶</a></h2>
<p><a class="reference internal" href="../api/Phalcon_Db.html"><em>Phalcon\Db</em></a> also provides methods to retrieve detailed information about tables and views:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Get tables on the test_db database</span>
<span class="nv">$tables</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">listTables</span><span class="p">(</span><span class="s2">&quot;test_db&quot;</span><span class="p">);</span>

<span class="c1">// Is there a table &#39;robots&#39; in the database?</span>
<span class="nv">$exists</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">tableExists</span><span class="p">(</span><span class="s2">&quot;robots&quot;</span><span class="p">);</span>

<span class="c1">// Get name, data types and special features of &#39;robots&#39; fields</span>
<span class="nv">$fields</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">describeColumns</span><span class="p">(</span><span class="s2">&quot;robots&quot;</span><span class="p">);</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$fields</span> <span class="k">as</span> <span class="nv">$field</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">&quot;Column Type: &quot;</span><span class="p">,</span> <span class="nv">$field</span><span class="p">[</span><span class="s2">&quot;Type&quot;</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// Get indexes on the &#39;robots&#39; table</span>
<span class="nv">$indexes</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">describeIndexes</span><span class="p">(</span><span class="s2">&quot;robots&quot;</span><span class="p">);</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$indexes</span> <span class="k">as</span> <span class="nv">$index</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">print_r</span><span class="p">(</span>
        <span class="nv">$index</span><span class="o">-&gt;</span><span class="na">getColumns</span><span class="p">()</span>
    <span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Get foreign keys on the &#39;robots&#39; table</span>
<span class="nv">$references</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">describeReferences</span><span class="p">(</span><span class="s2">&quot;robots&quot;</span><span class="p">);</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$references</span> <span class="k">as</span> <span class="nv">$reference</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Print referenced columns</span>
    <span class="nb">print_r</span><span class="p">(</span>
        <span class="nv">$reference</span><span class="o">-&gt;</span><span class="na">getReferencedColumns</span><span class="p">()</span>
    <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A table description is very similar to the MySQL describe command, it contains the following information:</p>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Index</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Field</td>
<td>Field&#8217;s name</td>
</tr>
<tr class="row-odd"><td>Type</td>
<td>Column Type</td>
</tr>
<tr class="row-even"><td>Key</td>
<td>Is the column part of the primary key or an index?</td>
</tr>
<tr class="row-odd"><td>Null</td>
<td>Does the column allow null values?</td>
</tr>
</tbody>
</table>
<p>Methods to get information about views are also implemented for every supported database system:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Get views on the test_db database</span>
<span class="nv">$tables</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">listViews</span><span class="p">(</span><span class="s2">&quot;test_db&quot;</span><span class="p">);</span>

<span class="c1">// Is there a view &#39;robots&#39; in the database?</span>
<span class="nv">$exists</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">viewExists</span><span class="p">(</span><span class="s2">&quot;robots&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-altering-dropping-tables">
<h2>Creating/Altering/Dropping Tables<a class="headerlink" href="#creating-altering-dropping-tables" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Different database systems (MySQL, Postgresql etc.) offer the ability to create, alter or drop tables with the use of
commands such as CREATE, ALTER or DROP. The SQL syntax differs based on which database system is used.
<a class="reference internal" href="../api/Phalcon_Db.html"><em>Phalcon\Db</em></a> offers a unified interface to alter tables, without the need to
differentiate the SQL syntax based on the target storage system.</p>
<div class="section" id="creating-tables">
<h3>Creating Tables<a class="headerlink" href="#creating-tables" title="Enlazar permanentemente con este título">¶</a></h3>
<p>The following example shows how to create a table:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Phalcon\Db\Column</span> <span class="k">as</span> <span class="nx">Column</span><span class="p">;</span>

<span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">createTable</span><span class="p">(</span>
    <span class="s2">&quot;robots&quot;</span><span class="p">,</span>
    <span class="k">null</span><span class="p">,</span>
    <span class="p">[</span>
       <span class="s2">&quot;columns&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="k">new</span> <span class="nx">Column</span><span class="p">(</span>
                <span class="s2">&quot;id&quot;</span><span class="p">,</span>
                <span class="p">[</span>
                    <span class="s2">&quot;type&quot;</span>          <span class="o">=&gt;</span> <span class="nx">Column</span><span class="o">::</span><span class="na">TYPE_INTEGER</span><span class="p">,</span>
                    <span class="s2">&quot;size&quot;</span>          <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">,</span>
                    <span class="s2">&quot;notNull&quot;</span>       <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
                    <span class="s2">&quot;autoIncrement&quot;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
                    <span class="s2">&quot;primary&quot;</span>       <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">),</span>
            <span class="k">new</span> <span class="nx">Column</span><span class="p">(</span>
                <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                <span class="p">[</span>
                    <span class="s2">&quot;type&quot;</span>    <span class="o">=&gt;</span> <span class="nx">Column</span><span class="o">::</span><span class="na">TYPE_VARCHAR</span><span class="p">,</span>
                    <span class="s2">&quot;size&quot;</span>    <span class="o">=&gt;</span> <span class="mi">70</span><span class="p">,</span>
                    <span class="s2">&quot;notNull&quot;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">),</span>
            <span class="k">new</span> <span class="nx">Column</span><span class="p">(</span>
                <span class="s2">&quot;year&quot;</span><span class="p">,</span>
                <span class="p">[</span>
                    <span class="s2">&quot;type&quot;</span>    <span class="o">=&gt;</span> <span class="nx">Column</span><span class="o">::</span><span class="na">TYPE_INTEGER</span><span class="p">,</span>
                    <span class="s2">&quot;size&quot;</span>    <span class="o">=&gt;</span> <span class="mi">11</span><span class="p">,</span>
                    <span class="s2">&quot;notNull&quot;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">),</span>
        <span class="p">]</span>
    <span class="p">]</span>
<span class="p">);</span>
</pre></div>
</div>
<p><code class="code docutils literal"><span class="pre">Phalcon\Db::createTable()</span></code> accepts an associative array describing the table. Columns are defined with the class
<a class="reference internal" href="../api/Phalcon_Db_Column.html"><em>Phalcon\Db\Column</em></a>. The table below shows the options available to define a column:</p>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="84%" />
<col width="6%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Description</th>
<th class="head">Optional</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&#8220;type&#8221;</td>
<td>Column type. Must be a <a class="reference internal" href="../api/Phalcon_Db_Column.html"><em>Phalcon\Db\Column</em></a> constant (see below for a list)</td>
<td>No</td>
</tr>
<tr class="row-odd"><td>&#8220;primary&#8221;</td>
<td>True if the column is part of the table&#8217;s primary key</td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>&#8220;size&#8221;</td>
<td>Some type of columns like VARCHAR or INTEGER may have a specific size</td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>&#8220;scale&#8221;</td>
<td>DECIMAL or NUMBER columns may be have a scale to specify how many decimals should be stored</td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>&#8220;unsigned&#8221;</td>
<td>INTEGER columns may be signed or unsigned. This option does not apply to other types of columns</td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>&#8220;notNull&#8221;</td>
<td>Column can store null values?</td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>&#8220;default&#8221;</td>
<td>Default value (when used with <code class="code docutils literal"><span class="pre">&quot;notNull&quot;</span> <span class="pre">=&gt;</span> <span class="pre">true</span></code>).</td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>&#8220;autoIncrement&#8221;</td>
<td>With this attribute column will filled automatically with an auto-increment integer. Only one column in the table can have this attribute.</td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>&#8220;bind&#8221;</td>
<td>One of the BIND_TYPE_* constants telling how the column must be binded before save it</td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>&#8220;first&#8221;</td>
<td>Column must be placed at first position in the column order</td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>&#8220;after&#8221;</td>
<td>Column must be placed after indicated column</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<p><a class="reference internal" href="../api/Phalcon_Db.html"><em>Phalcon\Db</em></a> supports the following database column types:</p>
<ul class="simple">
<li><code class="code docutils literal"><span class="pre">Phalcon\Db\Column::TYPE_INTEGER</span></code></li>
<li><code class="code docutils literal"><span class="pre">Phalcon\Db\Column::TYPE_DATE</span></code></li>
<li><code class="code docutils literal"><span class="pre">Phalcon\Db\Column::TYPE_VARCHAR</span></code></li>
<li><code class="code docutils literal"><span class="pre">Phalcon\Db\Column::TYPE_DECIMAL</span></code></li>
<li><code class="code docutils literal"><span class="pre">Phalcon\Db\Column::TYPE_DATETIME</span></code></li>
<li><code class="code docutils literal"><span class="pre">Phalcon\Db\Column::TYPE_CHAR</span></code></li>
<li><code class="code docutils literal"><span class="pre">Phalcon\Db\Column::TYPE_TEXT</span></code></li>
</ul>
<p>The associative array passed in <code class="code docutils literal"><span class="pre">Phalcon\Db::createTable()</span></code> can have the possible keys:</p>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="85%" />
<col width="6%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Index</th>
<th class="head">Description</th>
<th class="head">Optional</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&#8220;columns&#8221;</td>
<td>An array with a set of table columns defined with <a class="reference internal" href="../api/Phalcon_Db_Column.html"><em>Phalcon\Db\Column</em></a></td>
<td>No</td>
</tr>
<tr class="row-odd"><td>&#8220;indexes&#8221;</td>
<td>An array with a set of table indexes defined with <a class="reference internal" href="../api/Phalcon_Db_Index.html"><em>Phalcon\Db\Index</em></a></td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>&#8220;references&#8221;</td>
<td>An array with a set of table references (foreign keys) defined with <a class="reference internal" href="../api/Phalcon_Db_Reference.html"><em>Phalcon\Db\Reference</em></a></td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>&#8220;options&#8221;</td>
<td>An array with a set of table creation options. These options often relate to the database system in which the migration was generated.</td>
<td>Yes</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="altering-tables">
<h3>Altering Tables<a class="headerlink" href="#altering-tables" title="Enlazar permanentemente con este título">¶</a></h3>
<p>As your application grows, you might need to alter your database, as part of a refactoring or adding new features.
Not all database systems allow to modify existing columns or add columns between two existing ones. <a class="reference internal" href="../api/Phalcon_Db.html"><em>Phalcon\Db</em></a>
is limited by these constraints.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Db\Column</span> <span class="k">as</span> <span class="nx">Column</span><span class="p">;</span>

<span class="c1">// Adding a new column</span>
<span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">addColumn</span><span class="p">(</span>
    <span class="s2">&quot;robots&quot;</span><span class="p">,</span>
    <span class="k">null</span><span class="p">,</span>
    <span class="k">new</span> <span class="nx">Column</span><span class="p">(</span>
        <span class="s2">&quot;robot_type&quot;</span><span class="p">,</span>
        <span class="p">[</span>
            <span class="s2">&quot;type&quot;</span>    <span class="o">=&gt;</span> <span class="nx">Column</span><span class="o">::</span><span class="na">TYPE_VARCHAR</span><span class="p">,</span>
            <span class="s2">&quot;size&quot;</span>    <span class="o">=&gt;</span> <span class="mi">32</span><span class="p">,</span>
            <span class="s2">&quot;notNull&quot;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
            <span class="s2">&quot;after&quot;</span>   <span class="o">=&gt;</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span>
<span class="p">);</span>

<span class="c1">// Modifying an existing column</span>
<span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">modifyColumn</span><span class="p">(</span>
    <span class="s2">&quot;robots&quot;</span><span class="p">,</span>
    <span class="k">null</span><span class="p">,</span>
    <span class="k">new</span> <span class="nx">Column</span><span class="p">(</span>
        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="p">[</span>
            <span class="s2">&quot;type&quot;</span>    <span class="o">=&gt;</span> <span class="nx">Column</span><span class="o">::</span><span class="na">TYPE_VARCHAR</span><span class="p">,</span>
            <span class="s2">&quot;size&quot;</span>    <span class="o">=&gt;</span> <span class="mi">40</span><span class="p">,</span>
            <span class="s2">&quot;notNull&quot;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span>
<span class="p">);</span>

<span class="c1">// Deleting the column &quot;name&quot;</span>
<span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">dropColumn</span><span class="p">(</span>
    <span class="s2">&quot;robots&quot;</span><span class="p">,</span>
    <span class="k">null</span><span class="p">,</span>
    <span class="s2">&quot;name&quot;</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="dropping-tables">
<h3>Dropping Tables<a class="headerlink" href="#dropping-tables" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Examples on dropping tables:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Drop table robot from active database</span>
<span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">dropTable</span><span class="p">(</span><span class="s2">&quot;robots&quot;</span><span class="p">);</span>

<span class="c1">// Drop table robot from database &quot;machines&quot;</span>
<span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">dropTable</span><span class="p">(</span><span class="s2">&quot;robots&quot;</span><span class="p">,</span> <span class="s2">&quot;machines&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</div>


                    </div>
                  </div>
                </div>
            </div>
          </td>
        </tr>
      </table>
    <div class="related">
      <ul>
        <li class="right" >
          <a href="../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="intl.html" title="Internationalization"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="queue.html" title="Queueing"
             >anterior</a> |</li> 
      </ul>
    </div>

      <div class="prefooter">
  <div class="container">
      <div class="row">
          <div class="col-sm-3 text-right">
              <span>Follow along:</span>
          </div>
          <div class="col-sm-6 text-center">
              <a href="https://twitter.com/phalconphp" alt="Twitter" class="btn-social btn-social-twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i></a>
              <a href="https://www.facebook.com/pages/Phalcon-Framework/134230726685897" alt="Facebook" class="btn-social btn-social-facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i></a>
              <a href="https://plus.google.com/102376109340560896457" alt="Google+" class="btn-social btn-social-googleplus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i></a>
              <a href="https://github.com/phalcon/cphalcon" alt="Github" class="btn-social btn-social-github"><i class="fa fa-fw fa-github" aria-hidden="true"></i></a>
          </div>
          <div class="col-sm-3">
          </div>
      </div>
  </div>
</div>
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-xs-4 col-sm-3">
                <h4>Download</h4>
                <ul>
                    <li><a href="https://phalconphp.com/download">Installing Phalcon PHP</a></li>
                    <li><a href="https://docs.phalconphp.com/en/latest/index.html" class="header-nav-link" target="_blank">Documentation</a></li>
                    <li><a href="https://api.phalconphp.com">API</a></li>
                    <li><a href="https://docs.phalconphp.com/en/latest/reference/tutorial.html">Tutorial</a></li>
                    <li><a href="https://docs.phalconphp.com/en/latest/reference/tutorial.html#sample-applications">Sample Applications</a></li>
                </ul>
            </div>
            <div class="col-xs-4 col-sm-3">
                <h4>Community</h4>
                <ul>
                    <li><a href="https://forum.phalconphp.com/" class="header-nav-link" target="_blank">Forum</a></li>
                    <li><a href="https://github.com/phalcon/cphalcon">GitHub</a></li>
                    <li><a href="https://github.com/phalcon/cphalcon/issues">Issue Tracker</a></li>
                    <li><a href="https://stackoverflow.com/questions/tagged/phalcon">Stack Overflow</a></li>
                    <li><a href="https://phalconphp.com/en/testimonials">Testimonials</a></li>
                    <li><a href="https://builtwith.phalconphp.com/">Built with Phalcon</a></li>
                    <li><a href="https://store.phalconphp.com/">Store</a></li>
                </ul>
            </div>
            <div class="col-xs-4 col-sm-2">
                <h4>About</h4>
                <ul>
                    <li><a class="link-black" href="http://blog.phalconphp.com/">Blog</a></li>
                    <li><a href="https://phalconphp.com/en/about">About</a></li>
                    <li><a href="https://phalconphp.com/en/team">Team</a></li>
                    <li><a href="https://phalconphp.com/en/roadmap">Roadmap</a></li>
                    <li><a href="https://phalconphp.com/en/donate">Donate</a></li>
                    <li><a href="https://phalconphp.com/en/consulting">Consulting</a></li>
                    <li><a href="https://phalconphp.com/en/hosting">Hosting</a></li>
                </ul>
            </div>
            <div id="license-spaccer" class="visible-xs"></div>
            <div id="license-wrapper" class="col-xs-12 col-sm-4">
                <p class="license">
                    Phalcon is an open-source PHP framework <br />
                    built as a C-extension. It is available under the <br />
                    <a href="http://opensource.org/licenses/BSD-3-Clause" target="_blank">new BSD License</a>.
                </p>

                <div class="design">
                    <span>Website Designed by:</span>
                </div>
                <a class="license" href="http://loudertech.com/" target="_blank" title="">
                    <span>LouderTech SAS</span>
                </a>
            </div>
        </div>
    </div>
</footer>

    </div>
    <script type="text/javascript">
    $(window).on("load", function(){
      var cx = '009733439235723428699:lh9ltjgvdz8';
      var gcse = document.createElement('script');
      gcse.type = 'text/javascript';
      gcse.async = true;
      gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cx=' + cx;
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(gcse, s);
    });
    </script>

  </body>
</html>