<!DOCTYPE html>

<html lang="en">
  <head>
    
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Tutorial 4: Trabajando con CRUDs &mdash; documentación de Phalcon - 3.1.1 (Spanish / Español)</title>
    <meta name="keywords" content="php, phalcon, phalcon php, php framework, faster php framework">
    <link rel="stylesheet" type="text/css" href="https://netdna.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="//static.phalconphp.com/www/css/phalcon.min.css" />
    <link href='//fonts.googleapis.com/css?family=Open+Sans:700,400' rel='stylesheet' type='text/css'>
    <link href="//fonts.googleapis.com/css?family=Merriweather:400,700" rel="stylesheet" type="text/css" />
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" />
    <!--
    EUROPE <link href='//fonts.googleapis.com/css?family=Open+Sans:700,400&subset=latin-ext' rel='stylesheet' type='text/css'>
    GREEK <link href='//fonts.googleapis.com/css?family=Open+Sans:700,400&subset=greek-ext' rel='stylesheet' type='text/css'>
    RUSSIA <link href='//fonts.googleapis.com/css?family=Open+Sans:700,400&subset=cyrillic-ext,latin' rel='stylesheet' type='text/css'>
    -->

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/docs.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.1.1',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/docs.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="documentación de Phalcon - 3.1.1" href="../index.html" />
    <link rel="next" title="Tutorial 5: Customizing INVO" href="tutorial-invo-4.html" />
    <link rel="prev" title="Tutorial 3: Securing INVO" href="tutorial-invo-2.html" /> 
  </head>
  <body>

<header class="page-header">
    <nav class="navbar" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-menu-container">
                    <span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
                </button>
                <a class="navbar-brand phalcon-logo" href="/"><span itemprop="name" class="sr-only">Phalcon PHP</span></a>
            </div>

            <div class="collapse navbar-collapse navbar-right" id="main-menu-container">
                <ul class="nav navbar-nav main-menu">
                  <li class="first"><a href="//phalconphp.com/en/download" class="header-nav-link">Download</a></li>
                  <li><a href="//docs.phalconphp.com/en/latest/index.html" class="header-nav-link" target="_blank">Documentation</a></li>
                  <li><a href="//forum.phalconphp.com/" class="header-nav-link" target="_blank">Forum</a></li>
                  <li><a href="//blog.phalconphp.com/" class="header-nav-link" target="_blank">Blog</a></li>
                  <li><a href="//phalconist.com/" class="header-nav-link" target="_blank">Resources</a></li>
                  <li><a href="//phalconphp.com/en/about">About</a></li>
                  <li><div align="right">
                      <iframe src="https://ghbtns.com/github-btn.html?user=phalcon&amp;repo=cphalcon&amp;type=watch&amp;count=true&amp;size=large"
      allowtransparency="true" frameborder="0" scrolling="0" width="152px" height="30px"></iframe>
                    </div></li>
                </ul>
            </div>
        </div>
    </nav>
  </header>

<div class="heading">
    <div class="container">
        <div class="row">
            <h2>Documentation</h2>
        </div>
    </div>
</div>
    <div class="related">
      <ul>
        <li class="right" >
          <a href="../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="tutorial-invo-4.html" title="Tutorial 5: Customizing INVO"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="tutorial-invo-2.html" title="Tutorial 3: Securing INVO"
             accesskey="P">anterior</a> |</li>
        <li><a href="//phalconphp.com">Home</a> &raquo;</li>
        <li><a href="../index.html">documentación de Phalcon - 3.1.1</a> &raquo;</li> 
      </ul>
    </div>  

      <table width="100%" align="center" cellpadding="0" cellspacing="0">
        <tr>
      <td class="primary-box" width="25%" valign="top">
            <div>
            <div id="searchbox" style="">
                <!--<form class="search" action="http://readthedocs.org/search/project/" method="get">
                  <input type="search" name="q" size="25" placeholder="Search">
                  <input type="submit" value="Go">
                  <input type="hidden" name="selected_facets" value="project:">
                </form>-->
                <div style="width:200px;padding:10px">
                  <gcse:searchbox-only></gcse:searchbox-only>
                </div>
            </div>
            </div>
            <div style="padding:5px;padding-left:10px">
              <div id="carbonads-container">
                <div class="carbonad"><div id="azcarbon"></div>
                <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=phalconphpcom" id="_carbonads_js"></script>
                </div></div>
            </div>
            <h3><a href="../index.html">Tabla de Contenidos</a></h3>
            <ul>
<li><a class="reference internal" href="#">Tutorial 4: Trabajando con CRUDs</a><ul>
<li><a class="reference internal" href="#formulario-de-buscar">Formulario de Buscar</a></li>
<li><a class="reference internal" href="#realizando-una-busqueda">Realizando una búsqueda</a></li>
<li><a class="reference internal" href="#creando-y-actualizando-registros">Creando y Actualizando Registros</a></li>
</ul>
</li>
</ul>

            <h4>Tema anterior</h4>
            <p class="topless"><a href="tutorial-invo-2.html" title="capítulo anterior">&lt; Tutorial 3: Securing INVO</a></p>
            <h4>Próximo tema</h4>
            <p class="topless"><a href="tutorial-invo-4.html" title="próximo capítulo">Tutorial 5: Customizing INVO &gt;</a></p>
            <h3>Esta página</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/reference/tutorial-invo-3.txt" rel="nofollow">Mostrar el código</a></li>
            </ul>
        </td>
          <td class="second-box" valign="top">
            <div class="document">
                <div class="documentwrapper">
                  <div class="bodywrapper">
                    <div class="body" >
                      
  <div class="section" id="tutorial-4-trabajando-con-cruds">
<h1>Tutorial 4: Trabajando con CRUDs<a class="headerlink" href="#tutorial-4-trabajando-con-cruds" title="Enlazar permanentemente con este título">¶</a></h1>
<p>Backends usually provide forms to allow users to manipulate data. Continuing the explanation of
INVO, we now address the creation of CRUDs, a very common task that Phalcon will facilitate you
using forms, validations, paginators and more.</p>
<p>La mayor parte de opciones que manipulan datos (compañias, productos y tipos de productos), han sido desarrollados
usando un básico y común <a class="reference external" href="https://es.wikipedia.org/wiki/CRUD">CRUD</a> (Create, Read, Update and Delete). Cada CRUD contiene los siguientes archivos:</p>
<div class="highlight-bash"><div class="highlight"><pre>invo/
    app/
        controllers/
            ProductsController.php
        models/
            Products.php
        forms/
            ProductsForm.php
        views/
            products/
                edit.volt
                index.volt
                new.volt
                search.volt
</pre></div>
</div>
<p>Cada controlador implementa las siguientes acciones:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">ProductsController</span> <span class="k">extends</span> <span class="nx">ControllerBase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * La acción de inicio, permite buscar productos</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">indexAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Realiza la búsqueda basada en los parámetros de usuario</span>
<span class="sd">     * devolviendo un paginador</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">searchAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Muestra la vista de crear nuevos productos</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">newAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Muestra la vista para editar productos existentes</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">editAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Crea un nuevo producto basado en los datos ingresados en la acción &quot;new&quot;</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">createAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Actualiza un producto basado en los datos ingresados en la acción &quot;edit&quot;</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">saveAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Elimina un producto existente</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">deleteAction</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="formulario-de-buscar">
<h2>Formulario de Buscar<a class="headerlink" href="#formulario-de-buscar" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Cada CRUD inicia con un formulario de búsqueda. Este formulario muestra cada campo que tiene la tabla (productos), permitiendo al usuario
crear un criterio de búsqueda por cada campo. La tabla &#8220;productos&#8221; tiene una relación a la tabla &#8220;product_types&#8221;.
En este caso, previamente consultamos los registros en esta tabla para facilitar al usuario su búsqueda por este campo:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="sd">/**</span>
<span class="sd"> * La acción de inicio, permite buscar productos</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">indexAction</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">persistent</span><span class="o">-&gt;</span><span class="na">searchParams</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">view</span><span class="o">-&gt;</span><span class="na">form</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ProductsForm</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>An instance of the ProductsForm form (app/forms/ProductsForm.php) is passed to the view.
This form defines the fields that are visible to the user:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Forms\Form</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Phalcon\Forms\Element\Text</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Phalcon\Forms\Element\Hidden</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Phalcon\Forms\Element\Select</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Phalcon\Validation\Validator\Email</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Phalcon\Validation\Validator\PresenceOf</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Phalcon\Validation\Validator\Numericality</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ProductsForm</span> <span class="k">extends</span> <span class="nx">Form</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Initialize the products form</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">initialize</span><span class="p">(</span><span class="nv">$entity</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$options</span> <span class="o">=</span> <span class="p">[])</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$options</span><span class="p">[</span><span class="s2">&quot;edit&quot;</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nv">$element</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Text</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">);</span>

            <span class="nv">$element</span><span class="o">-&gt;</span><span class="na">setLabel</span><span class="p">(</span><span class="s2">&quot;Id&quot;</span><span class="p">);</span>

            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span>
                <span class="nv">$element</span>
            <span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span>
                <span class="k">new</span> <span class="nx">Hidden</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
            <span class="p">);</span>
        <span class="p">}</span>



        <span class="nv">$name</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Text</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">);</span>

        <span class="nv">$name</span><span class="o">-&gt;</span><span class="na">setLabel</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">);</span>

        <span class="nv">$name</span><span class="o">-&gt;</span><span class="na">setFilters</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;striptags&quot;</span><span class="p">,</span>
                <span class="s2">&quot;string&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">);</span>

        <span class="nv">$name</span><span class="o">-&gt;</span><span class="na">addValidators</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="k">new</span> <span class="nx">PresenceOf</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="s2">&quot;message&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Name is required&quot;</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">)</span>
            <span class="p">]</span>
        <span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="nv">$name</span><span class="p">);</span>



        <span class="nv">$type</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Select</span><span class="p">(</span>
            <span class="s2">&quot;profilesId&quot;</span><span class="p">,</span>
            <span class="nx">ProductTypes</span><span class="o">::</span><span class="na">find</span><span class="p">(),</span>
            <span class="p">[</span>
                <span class="s2">&quot;using&quot;</span>      <span class="o">=&gt;</span> <span class="p">[</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="s2">&quot;useEmpty&quot;</span>   <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
                <span class="s2">&quot;emptyText&quot;</span>  <span class="o">=&gt;</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
                <span class="s2">&quot;emptyValue&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="nv">$type</span><span class="p">);</span>



        <span class="nv">$price</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Text</span><span class="p">(</span><span class="s2">&quot;price&quot;</span><span class="p">);</span>

        <span class="nv">$price</span><span class="o">-&gt;</span><span class="na">setLabel</span><span class="p">(</span><span class="s2">&quot;Price&quot;</span><span class="p">);</span>

        <span class="nv">$price</span><span class="o">-&gt;</span><span class="na">setFilters</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;float&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">);</span>

        <span class="nv">$price</span><span class="o">-&gt;</span><span class="na">addValidators</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="k">new</span> <span class="nx">PresenceOf</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="s2">&quot;message&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Price is required&quot;</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">),</span>
                <span class="k">new</span> <span class="nx">Numericality</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="s2">&quot;message&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Price is required&quot;</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">),</span>
            <span class="p">]</span>
        <span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="nv">$price</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The form is declared using an object-oriented scheme based on the elements provided by the <a class="reference internal" href="forms.html"><em>forms</em></a> component.
Every element follows almost the same structure:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Create the element</span>
<span class="nv">$name</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Text</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">);</span>

<span class="c1">// Set its label</span>
<span class="nv">$name</span><span class="o">-&gt;</span><span class="na">setLabel</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">);</span>

<span class="c1">// Before validating the element apply these filters</span>
<span class="nv">$name</span><span class="o">-&gt;</span><span class="na">setFilters</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="s2">&quot;striptags&quot;</span><span class="p">,</span>
        <span class="s2">&quot;string&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">);</span>

<span class="c1">// Apply this validators</span>
<span class="nv">$name</span><span class="o">-&gt;</span><span class="na">addValidators</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="k">new</span> <span class="nx">PresenceOf</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;message&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Name is required&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="p">]</span>
<span class="p">);</span>

<span class="c1">// Add the element to the form</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="nv">$name</span><span class="p">);</span>
</pre></div>
</div>
<p>Other elements are also used in this form:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Add a hidden input to the form</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span>
    <span class="k">new</span> <span class="nx">Hidden</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">// ...</span>

<span class="nv">$productTypes</span> <span class="o">=</span> <span class="nx">ProductTypes</span><span class="o">::</span><span class="na">find</span><span class="p">();</span>

<span class="c1">// Add a HTML Select (list) to the form</span>
<span class="c1">// and fill it with data from &quot;product_types&quot;</span>
<span class="nv">$type</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Select</span><span class="p">(</span>
    <span class="s2">&quot;profilesId&quot;</span><span class="p">,</span>
    <span class="nv">$productTypes</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s2">&quot;using&quot;</span>      <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s2">&quot;id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="s2">&quot;useEmpty&quot;</span>   <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
        <span class="s2">&quot;emptyText&quot;</span>  <span class="o">=&gt;</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
        <span class="s2">&quot;emptyValue&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Note that <code class="code docutils literal"><span class="pre">ProductTypes::find()</span></code> contains the data necessary to fill the SELECT tag using <code class="code docutils literal"><span class="pre">Phalcon\Tag::select()</span></code>.
Once the form is passed to the view, it can be rendered and presented to the user:</p>
<div class="highlight-html+jinja"><div class="highlight"><pre><span class="cp">{{</span> <span class="nv">form</span><span class="o">(</span><span class="s2">&quot;products/search&quot;</span><span class="o">)</span> <span class="cp">}}</span>

    <span class="nt">&lt;h2&gt;</span>
        Search products
    <span class="nt">&lt;/h2&gt;</span>

    <span class="nt">&lt;fieldset&gt;</span>

        <span class="cp">{%</span> <span class="k">for</span> <span class="nv">element</span> <span class="k">in</span> <span class="nv">form</span> <span class="cp">%}</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;control-group&quot;</span><span class="nt">&gt;</span>
                <span class="cp">{{</span> <span class="nv">element.label</span><span class="o">([</span><span class="s2">&quot;class&quot;</span><span class="o">:</span> <span class="s2">&quot;control-label&quot;</span><span class="o">])</span> <span class="cp">}}</span>

                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;controls&quot;</span><span class="nt">&gt;</span>
                    <span class="cp">{{</span> <span class="nv">element</span> <span class="cp">}}</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>



        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;control-group&quot;</span><span class="nt">&gt;</span>
            <span class="cp">{{</span> <span class="nv">submit_button</span><span class="o">(</span><span class="s2">&quot;Search&quot;</span><span class="o">,</span> <span class="s2">&quot;class&quot;</span><span class="o">:</span> <span class="s2">&quot;btn btn-primary&quot;</span><span class="o">)</span> <span class="cp">}}</span>
        <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;/fieldset&gt;</span>

<span class="cp">{{</span> <span class="nv">endForm</span><span class="o">()</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>This produces the following HTML:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;/invo/products/search&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;h2&gt;</span>
        Search products
    <span class="nt">&lt;/h2&gt;</span>

    <span class="nt">&lt;fieldset&gt;</span>

        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;control-group&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;id&quot;</span> <span class="na">class=</span><span class="s">&quot;control-label&quot;</span><span class="nt">&gt;</span>Id<span class="nt">&lt;/label&gt;</span>

            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;controls&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">id=</span><span class="s">&quot;id&quot;</span> <span class="na">name=</span><span class="s">&quot;id&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>

        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;control-group&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;name&quot;</span> <span class="na">class=</span><span class="s">&quot;control-label&quot;</span><span class="nt">&gt;</span>Name<span class="nt">&lt;/label&gt;</span>

            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;controls&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">id=</span><span class="s">&quot;name&quot;</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>

        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;control-group&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;profilesId&quot;</span> <span class="na">class=</span><span class="s">&quot;control-label&quot;</span><span class="nt">&gt;</span>profilesId<span class="nt">&lt;/label&gt;</span>

            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;controls&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;profilesId&quot;</span> <span class="na">name=</span><span class="s">&quot;profilesId&quot;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>...<span class="nt">&lt;/option&gt;</span>
                    <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>Vegetables<span class="nt">&lt;/option&gt;</span>
                    <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;2&quot;</span><span class="nt">&gt;</span>Fruits<span class="nt">&lt;/option&gt;</span>
                <span class="nt">&lt;/select&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>

        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;control-group&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;price&quot;</span> <span class="na">class=</span><span class="s">&quot;control-label&quot;</span><span class="nt">&gt;</span>Price<span class="nt">&lt;/label&gt;</span>

            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;controls&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">id=</span><span class="s">&quot;price&quot;</span> <span class="na">name=</span><span class="s">&quot;price&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>



        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;control-group&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Search&quot;</span> <span class="na">class=</span><span class="s">&quot;btn btn-primary&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;/fieldset&gt;</span>

<span class="nt">&lt;/form&gt;</span>
</pre></div>
</div>
<p>When the form is submitted, the &#8220;search&#8221; action is executed in the controller performing the search
based on the data entered by the user.</p>
</div>
<div class="section" id="realizando-una-busqueda">
<h2>Realizando una búsqueda<a class="headerlink" href="#realizando-una-busqueda" title="Enlazar permanentemente con este título">¶</a></h2>
<p>La acción &#8220;search&#8221; tiene un doble objetivo. Cuando es accedida via POST, realiza una búsqueda basada en los parámetros
ingresados por el usuario y cuando se accede via GET mueve la pagína actual en el paginador. Para diferenciar un método del
otro usamos el componente <a class="reference internal" href="request.html"><em>Request</em></a>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="sd">/**</span>
<span class="sd"> * Realiza la búsqueda basada en los parámetros de usuario</span>
<span class="sd"> * devolviendo un paginador</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">searchAction</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">isPost</span><span class="p">())</span> <span class="p">{</span>
        <span class="c1">// Crear las condiciones de búsqueda</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// Paginar usando las condiciones existentes</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Con la ayuda de <a class="reference internal" href="../api/Phalcon_Mvc_Model_Criteria.html"><em>Phalcon\Mvc\Model\Criteria</em></a>, podemos crear una búsqueda
de manera inteligente basada en los tipos de datos enviados en el formulario:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$query</span> <span class="o">=</span> <span class="nx">Criteria</span><span class="o">::</span><span class="na">fromInput</span><span class="p">(</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">di</span><span class="p">,</span>
    <span class="s2">&quot;Products&quot;</span><span class="p">,</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">getPost</span><span class="p">()</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Este método verifica que valores son diferentes a &#8220;&#8221; (cadena vacia) y nulo y los toma en cuenta para crear el criterio
de búsqueda:</p>
<ul class="simple">
<li>Si el campo tiene un tipo de dato de texto o similar (char, varchar, text, etc.) Usa el operador SQL &#8220;like&#8221; para filtrar los resultados.</li>
<li>Si el tipo de dato no es texto, entonces usará el operador &#8220;=&#8221;.</li>
</ul>
<p>Adicionalmente, &#8220;Criteria&#8221; ignora todas las variables <code class="code docutils literal"><span class="pre">$_POST</span></code> que no correspondan a campos en la tabla.
Los valores son automáticamente escapados usando &#8220;bound parameters&#8221; evitando inyecciones de SQL.</p>
<p>Ahora, almacenamos los parametros producidos en la bolsa de datos de sesión del controlador:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">persistent</span><span class="o">-&gt;</span><span class="na">searchParams</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getParams</span><span class="p">();</span>
</pre></div>
</div>
<p>Una bolsa de sesión, es un atributo especial en un controlador que es persistente entre peticiones.
Al ser accedido, este atributo es inyectado con un servicio <a class="reference internal" href="../api/Phalcon_Session_Bag.html"><em>Phalcon\Session\Bag</em></a>
que es independiente por controlador/clase.</p>
<p>Luego, basado en los parámetros construidos anteriormente:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$products</span> <span class="o">=</span> <span class="nx">Products</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="nv">$parameters</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$products</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">flash</span><span class="o">-&gt;</span><span class="na">notice</span><span class="p">(</span>
        <span class="s2">&quot;No se encontraron productos para la búsqueda realizada.&quot;</span>
    <span class="p">);</span>

    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dispatcher</span><span class="o">-&gt;</span><span class="na">forward</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="s2">&quot;controller&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span>
            <span class="s2">&quot;action&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Si la búsqueda no retorna ningún producto, redireccionamos al usuario a la vista de inicio nuevamente. Supongamos que
retornó registros, entonces creamos un páginador para navegar fácilmente a través de ellos:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Paginator\Adapter\Model</span> <span class="k">as</span> <span class="nx">Paginator</span><span class="p">;</span>

<span class="c1">// ...</span>

<span class="nv">$paginator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Paginator</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="s2">&quot;data&quot;</span>  <span class="o">=&gt;</span> <span class="nv">$products</span><span class="p">,</span>   <span class="c1">// Data to paginate</span>
        <span class="s2">&quot;limit&quot;</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">,</span>           <span class="c1">// Rows per page</span>
        <span class="s2">&quot;page&quot;</span>  <span class="o">=&gt;</span> <span class="nv">$numberPage</span><span class="p">,</span> <span class="c1">// Active page</span>
    <span class="p">]</span>
<span class="p">);</span>

<span class="c1">// Obtener la página activa</span>
<span class="nv">$page</span> <span class="o">=</span> <span class="nv">$paginator</span><span class="o">-&gt;</span><span class="na">getPaginate</span><span class="p">();</span>
</pre></div>
</div>
<p>Finalmente pasamos la página devuelta a la vista:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">view</span><span class="o">-&gt;</span><span class="na">page</span> <span class="o">=</span> <span class="nv">$page</span><span class="p">;</span>
</pre></div>
</div>
<p>En la vista (app/views/products/search.volt), recorremos
los resultados correspondientes de la página actual:</p>
<div class="highlight-html+jinja"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">for</span> <span class="nv">product</span> <span class="k">in</span> <span class="nv">page.items</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nb">loop</span><span class="nv">.first</span> <span class="cp">%}</span>
        <span class="nt">&lt;table&gt;</span>
            <span class="nt">&lt;thead&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;th&gt;</span>Id<span class="nt">&lt;/th&gt;</span>
                    <span class="nt">&lt;th&gt;</span>Product Type<span class="nt">&lt;/th&gt;</span>
                    <span class="nt">&lt;th&gt;</span>Name<span class="nt">&lt;/th&gt;</span>
                    <span class="nt">&lt;th&gt;</span>Price<span class="nt">&lt;/th&gt;</span>
                    <span class="nt">&lt;th&gt;</span>Active<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;/thead&gt;</span>
            <span class="nt">&lt;tbody&gt;</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

    <span class="nt">&lt;tr&gt;</span>
        <span class="nt">&lt;td&gt;</span>
            <span class="cp">{{</span> <span class="nv">product.id</span> <span class="cp">}}</span>
        <span class="nt">&lt;/td&gt;</span>

        <span class="nt">&lt;td&gt;</span>
            <span class="cp">{{</span> <span class="nv">product.getProductTypes</span><span class="o">()</span><span class="nv">.name</span> <span class="cp">}}</span>
        <span class="nt">&lt;/td&gt;</span>

        <span class="nt">&lt;td&gt;</span>
            <span class="cp">{{</span> <span class="nv">product.name</span> <span class="cp">}}</span>
        <span class="nt">&lt;/td&gt;</span>

        <span class="nt">&lt;td&gt;</span>
            <span class="cp">{{</span> <span class="s2">&quot;%.2f&quot;</span><span class="o">|</span><span class="nf">format</span><span class="o">(</span><span class="nv">product.price</span><span class="o">)</span> <span class="cp">}}</span>
        <span class="nt">&lt;/td&gt;</span>

        <span class="nt">&lt;td&gt;</span>
            <span class="cp">{{</span> <span class="nv">product.getActiveDetail</span><span class="o">()</span> <span class="cp">}}</span>
        <span class="nt">&lt;/td&gt;</span>

        <span class="nt">&lt;td</span> <span class="na">width=</span><span class="s">&quot;7%&quot;</span><span class="nt">&gt;</span>
            <span class="cp">{{</span> <span class="nv">link_to</span><span class="o">(</span><span class="s2">&quot;products/edit/&quot;</span> <span class="o">~</span> <span class="nv">product.id</span><span class="o">,</span> <span class="s2">&quot;Edit&quot;</span><span class="o">)</span> <span class="cp">}}</span>
        <span class="nt">&lt;/td&gt;</span>

        <span class="nt">&lt;td</span> <span class="na">width=</span><span class="s">&quot;7%&quot;</span><span class="nt">&gt;</span>
            <span class="cp">{{</span> <span class="nv">link_to</span><span class="o">(</span><span class="s2">&quot;products/delete/&quot;</span> <span class="o">~</span> <span class="nv">product.id</span><span class="o">,</span> <span class="s2">&quot;Delete&quot;</span><span class="o">)</span> <span class="cp">}}</span>
        <span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>

    <span class="cp">{%</span> <span class="k">if</span> <span class="nb">loop</span><span class="nv">.last</span> <span class="cp">%}</span>
            <span class="nt">&lt;/tbody&gt;</span>
            <span class="nt">&lt;tbody&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">colspan=</span><span class="s">&quot;7&quot;</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;div&gt;</span>
                            <span class="cp">{{</span> <span class="nv">link_to</span><span class="o">(</span><span class="s2">&quot;products/search&quot;</span><span class="o">,</span> <span class="s2">&quot;First&quot;</span><span class="o">)</span> <span class="cp">}}</span>
                            <span class="cp">{{</span> <span class="nv">link_to</span><span class="o">(</span><span class="s2">&quot;products/search?page=&quot;</span> <span class="o">~</span> <span class="nv">page.before</span><span class="o">,</span> <span class="s2">&quot;Previous&quot;</span><span class="o">)</span> <span class="cp">}}</span>
                            <span class="cp">{{</span> <span class="nv">link_to</span><span class="o">(</span><span class="s2">&quot;products/search?page=&quot;</span> <span class="o">~</span> <span class="nv">page.next</span><span class="o">,</span> <span class="s2">&quot;Next&quot;</span><span class="o">)</span> <span class="cp">}}</span>
                            <span class="cp">{{</span> <span class="nv">link_to</span><span class="o">(</span><span class="s2">&quot;products/search?page=&quot;</span> <span class="o">~</span> <span class="nv">page.last</span><span class="o">,</span> <span class="s2">&quot;Last&quot;</span><span class="o">)</span> <span class="cp">}}</span>
                            <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;help-inline&quot;</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">page.current</span> <span class="cp">}}</span> of <span class="cp">{{</span> <span class="nv">page.total_pages</span> <span class="cp">}}</span><span class="nt">&lt;/span&gt;</span>
                        <span class="nt">&lt;/div&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;/tbody&gt;</span>
        <span class="nt">&lt;/table&gt;</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
    No products are recorded
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>There are many things in the above example that worth detailing. First of all, active items
in the current page are traversed using a Volt&#8217;s &#8216;for&#8217;. Volt provides a simpler syntax for a PHP &#8216;foreach&#8217;.</p>
<div class="highlight-html+jinja"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">for</span> <span class="nv">product</span> <span class="k">in</span> <span class="nv">page.items</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Which in PHP is the same as:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span> <span class="k">foreach</span> <span class="p">(</span><span class="nv">$page</span><span class="o">-&gt;</span><span class="na">items</span> <span class="k">as</span> <span class="nv">$product</span><span class="p">)</span> <span class="p">{</span> <span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>The whole &#8216;for&#8217; block provides the following:</p>
<div class="highlight-html+jinja"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">for</span> <span class="nv">product</span> <span class="k">in</span> <span class="nv">page.items</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nb">loop</span><span class="nv">.first</span> <span class="cp">%}</span>
        Executed before the first product in the loop
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

    Executed for every product of page.items

    <span class="cp">{%</span> <span class="k">if</span> <span class="nb">loop</span><span class="nv">.last</span> <span class="cp">%}</span>
        Executed after the last product is loop
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
    Executed if page.items does not have any products
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Now you can go back to the view and find out what every block is doing. Every field
in &#8220;product&#8221; is printed accordingly:</p>
<div class="highlight-html+jinja"><div class="highlight"><pre><span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td&gt;</span>
        <span class="cp">{{</span> <span class="nv">product.id</span> <span class="cp">}}</span>
    <span class="nt">&lt;/td&gt;</span>

    <span class="nt">&lt;td&gt;</span>
        <span class="cp">{{</span> <span class="nv">product.productTypes.name</span> <span class="cp">}}</span>
    <span class="nt">&lt;/td&gt;</span>

    <span class="nt">&lt;td&gt;</span>
        <span class="cp">{{</span> <span class="nv">product.name</span> <span class="cp">}}</span>
    <span class="nt">&lt;/td&gt;</span>

    <span class="nt">&lt;td&gt;</span>
        <span class="cp">{{</span> <span class="s2">&quot;%.2f&quot;</span><span class="o">|</span><span class="nf">format</span><span class="o">(</span><span class="nv">product.price</span><span class="o">)</span> <span class="cp">}}</span>
    <span class="nt">&lt;/td&gt;</span>

    <span class="nt">&lt;td&gt;</span>
        <span class="cp">{{</span> <span class="nv">product.getActiveDetail</span><span class="o">()</span> <span class="cp">}}</span>
    <span class="nt">&lt;/td&gt;</span>

    <span class="nt">&lt;td</span> <span class="na">width=</span><span class="s">&quot;7%&quot;</span><span class="nt">&gt;</span>
        <span class="cp">{{</span> <span class="nv">link_to</span><span class="o">(</span><span class="s2">&quot;products/edit/&quot;</span> <span class="o">~</span> <span class="nv">product.id</span><span class="o">,</span> <span class="s2">&quot;Edit&quot;</span><span class="o">)</span> <span class="cp">}}</span>
    <span class="nt">&lt;/td&gt;</span>

    <span class="nt">&lt;td</span> <span class="na">width=</span><span class="s">&quot;7%&quot;</span><span class="nt">&gt;</span>
        <span class="cp">{{</span> <span class="nv">link_to</span><span class="o">(</span><span class="s2">&quot;products/delete/&quot;</span> <span class="o">~</span> <span class="nv">product.id</span><span class="o">,</span> <span class="s2">&quot;Delete&quot;</span><span class="o">)</span> <span class="cp">}}</span>
    <span class="nt">&lt;/td&gt;</span>
<span class="nt">&lt;/tr&gt;</span>
</pre></div>
</div>
<p>As we seen before using <code class="code docutils literal"><span class="pre">product.id</span></code> is the same as in PHP as doing: <code class="code docutils literal"><span class="pre">$product-&gt;id</span></code>,
we made the same with <code class="code docutils literal"><span class="pre">product.name</span></code> and so on. Other fields are rendered differently,
for instance, let&#8217;s focus in <code class="code docutils literal"><span class="pre">product.productTypes.name</span></code>. To understand this part,
we have to check the Products model (app/models/Products.php):</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Mvc\Model</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * Products</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">Products</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="sd">/**</span>
<span class="sd">     * Products initializer</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">initialize</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsTo</span><span class="p">(</span>
            <span class="s2">&quot;product_types_id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ProductTypes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;id&quot;</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="s2">&quot;reusable&quot;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A model can have a method called <code class="code docutils literal"><span class="pre">initialize()</span></code>, this method is called once per request and it serves
the ORM to initialize a model. In this case, &#8220;Products&#8221; is initialized by defining that this model
has a one-to-many relationship to another model called &#8220;ProductTypes&#8221;.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsTo</span><span class="p">(</span>
    <span class="s2">&quot;product_types_id&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ProductTypes&quot;</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s2">&quot;reusable&quot;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Which means, the local attribute &#8220;product_types_id&#8221; in &#8220;Products&#8221; has an one-to-many relation to
the &#8220;ProductTypes&#8221; model in its attribute &#8220;id&#8221;. By defining this relationship we can access the name of
the product type by using:</p>
<div class="highlight-html+jinja"><div class="highlight"><pre><span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">product.productTypes.name</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
</pre></div>
</div>
<p>The field &#8220;price&#8221; is printed by its formatted using a Volt filter:</p>
<div class="highlight-html+jinja"><div class="highlight"><pre><span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="s2">&quot;%.2f&quot;</span><span class="o">|</span><span class="nf">format</span><span class="o">(</span><span class="nv">product.price</span><span class="o">)</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
</pre></div>
</div>
<p>In plain PHP, this would be:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s2">&quot;%.2f&quot;</span><span class="p">,</span> <span class="nv">$product</span><span class="o">-&gt;</span><span class="na">price</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Printing whether the product is active or not uses a helper implemented in the model:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">&lt;td&gt;{{ product.getActiveDetail() }}&lt;/td&gt;</span>
</pre></div>
</div>
<p>This method is defined in the model.</p>
</div>
<div class="section" id="creando-y-actualizando-registros">
<h2>Creando y Actualizando Registros<a class="headerlink" href="#creando-y-actualizando-registros" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Ahora vemos como en un CRUD se puede crear y actualizar registros. Desde las vistas &#8220;new&#8221; y &#8220;edit&#8221; los datos son ingresados por el usuario
y enviados a las acciones &#8220;create&#8221; y &#8220;save&#8221; que realizan las acciones de crear y actualizar productos respectivamente.</p>
<p>En el caso de creación, recuperamos los datos enviados y los asignamos a una nueva instancia de &#8220;Products&#8221;:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="sd">/**</span>
<span class="sd"> * Creates a product based on the data entered in the &quot;new&quot; action</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">createAction</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">isPost</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dispatcher</span><span class="o">-&gt;</span><span class="na">forward</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;controller&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span>
                <span class="s2">&quot;action&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="nv">$form</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ProductsForm</span><span class="p">();</span>

    <span class="nv">$product</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Products</span><span class="p">();</span>

    <span class="nv">$product</span><span class="o">-&gt;</span><span class="na">id</span>               <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">getPost</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">);</span>
    <span class="nv">$product</span><span class="o">-&gt;</span><span class="na">product_types_id</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">getPost</span><span class="p">(</span><span class="s2">&quot;product_types_id&quot;</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">);</span>
    <span class="nv">$product</span><span class="o">-&gt;</span><span class="na">name</span>             <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">getPost</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;striptags&quot;</span><span class="p">);</span>
    <span class="nv">$product</span><span class="o">-&gt;</span><span class="na">price</span>            <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">getPost</span><span class="p">(</span><span class="s2">&quot;price&quot;</span><span class="p">,</span> <span class="s2">&quot;double&quot;</span><span class="p">);</span>
    <span class="nv">$product</span><span class="o">-&gt;</span><span class="na">active</span>           <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">getPost</span><span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">);</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Remember the filters we defined in the Products form? Data is filtered before being assigned to the object <code class="code docutils literal"><span class="pre">$product</span></code>.
This filtering is optional; the ORM also escapes the input data and performs additional casting according to the column types:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// ...</span>

<span class="nv">$name</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Text</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">);</span>

<span class="nv">$name</span><span class="o">-&gt;</span><span class="na">setLabel</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">);</span>

<span class="c1">// Filters for name</span>
<span class="nv">$name</span><span class="o">-&gt;</span><span class="na">setFilters</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="s2">&quot;striptags&quot;</span><span class="p">,</span>
        <span class="s2">&quot;string&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">);</span>

<span class="c1">// Validators for name</span>
<span class="nv">$name</span><span class="o">-&gt;</span><span class="na">addValidators</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="k">new</span> <span class="nx">PresenceOf</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;message&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Name is required&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="p">]</span>
<span class="p">);</span>

<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="nv">$name</span><span class="p">);</span>
</pre></div>
</div>
<p>When saving, we&#8217;ll know whether the data conforms to the business rules and validations implemented
in the form ProductsForm form (app/forms/ProductsForm.php):</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// ...</span>

<span class="nv">$form</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ProductsForm</span><span class="p">();</span>

<span class="nv">$product</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Products</span><span class="p">();</span>

<span class="c1">// Validate the input</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">getPost</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$form</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="nv">$product</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$messages</span> <span class="o">=</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">getMessages</span><span class="p">();</span>

    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$messages</span> <span class="k">as</span> <span class="nv">$message</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">flash</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="nv">$message</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dispatcher</span><span class="o">-&gt;</span><span class="na">forward</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="s2">&quot;controller&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span>
            <span class="s2">&quot;action&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;new&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Finally, if the form does not return any validation message we can save the product instance:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// ...</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$product</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">()</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$messages</span> <span class="o">=</span> <span class="nv">$product</span><span class="o">-&gt;</span><span class="na">getMessages</span><span class="p">();</span>

    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$messages</span> <span class="k">as</span> <span class="nv">$message</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">flash</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="nv">$message</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dispatcher</span><span class="o">-&gt;</span><span class="na">forward</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="s2">&quot;controller&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span>
            <span class="s2">&quot;action&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;new&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">);</span>
<span class="p">}</span>

<span class="nv">$form</span><span class="o">-&gt;</span><span class="na">clear</span><span class="p">();</span>

<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">flash</span><span class="o">-&gt;</span><span class="na">success</span><span class="p">(</span>
    <span class="s2">&quot;Product was created successfully&quot;</span>
<span class="p">);</span>

<span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dispatcher</span><span class="o">-&gt;</span><span class="na">forward</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="s2">&quot;controller&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span>
        <span class="s2">&quot;action&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Ahora, en el caso de la actualización, primero debemos presentar al usuario los datos correspondientes al registro editado:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="sd">/**</span>
<span class="sd"> * Muestra la vista para editar un producto existente</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">editAction</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">isPost</span><span class="p">())</span> <span class="p">{</span>
        <span class="nv">$product</span> <span class="o">=</span> <span class="nx">Products</span><span class="o">::</span><span class="na">findFirstById</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$product</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">flash</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span>
                <span class="s2">&quot;Product was not found&quot;</span>
            <span class="p">);</span>

            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dispatcher</span><span class="o">-&gt;</span><span class="na">forward</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="s2">&quot;controller&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;action&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">);</span>
        <span class="p">}</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">view</span><span class="o">-&gt;</span><span class="na">form</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ProductsForm</span><span class="p">(</span>
            <span class="nv">$product</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="s2">&quot;edit&quot;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The data found is bound to the form passing the model as first parameter. Gracias a esto,
un usuario puede cambiar cualquier valor y luego enviarlo de vuelta a la base de datos usando la acción &#8220;save&#8221;:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="sd">/**</span>
<span class="sd"> * Actualiza un producto basado en los datos ingresados en la acción &quot;edit&quot;</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">saveAction</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">isPost</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dispatcher</span><span class="o">-&gt;</span><span class="na">forward</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;controller&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span>
                <span class="s2">&quot;action&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="nv">$id</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">getPost</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">);</span>

    <span class="nv">$product</span> <span class="o">=</span> <span class="nx">Products</span><span class="o">::</span><span class="na">findFirstById</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$product</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">flash</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span>
            <span class="s2">&quot;Product does not exist&quot;</span>
        <span class="p">);</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dispatcher</span><span class="o">-&gt;</span><span class="na">forward</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;controller&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span>
                <span class="s2">&quot;action&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="nv">$form</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ProductsForm</span><span class="p">();</span>

    <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">getPost</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$form</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="nv">$product</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$messages</span> <span class="o">=</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">getMessages</span><span class="p">();</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$messages</span> <span class="k">as</span> <span class="nv">$message</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">flash</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="nv">$message</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dispatcher</span><span class="o">-&gt;</span><span class="na">forward</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;controller&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span>
                <span class="s2">&quot;action&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;new&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$product</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">()</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$messages</span> <span class="o">=</span> <span class="nv">$product</span><span class="o">-&gt;</span><span class="na">getMessages</span><span class="p">();</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$messages</span> <span class="k">as</span> <span class="nv">$message</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">flash</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="nv">$message</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dispatcher</span><span class="o">-&gt;</span><span class="na">forward</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;controller&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span>
                <span class="s2">&quot;action&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;new&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">clear</span><span class="p">();</span>

    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">flash</span><span class="o">-&gt;</span><span class="na">success</span><span class="p">(</span>
        <span class="s2">&quot;Product was updated successfully&quot;</span>
    <span class="p">);</span>

    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dispatcher</span><span class="o">-&gt;</span><span class="na">forward</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="s2">&quot;controller&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span>
            <span class="s2">&quot;action&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We have seen how Phalcon lets you create forms and bind data from a database in a structured way.
In next chapter, we will see how to add custom HTML elements like a menu.</p>
</div>
</div>


                    </div>
                  </div>
                </div>
            </div>
          </td>
        </tr>
      </table>
    <div class="related">
      <ul>
        <li class="right" >
          <a href="../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="tutorial-invo-4.html" title="Tutorial 5: Customizing INVO"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="tutorial-invo-2.html" title="Tutorial 3: Securing INVO"
             >anterior</a> |</li> 
      </ul>
    </div>

      <div class="prefooter">
  <div class="container">
      <div class="row">
          <div class="col-sm-3 text-right">
              <span>Follow along:</span>
          </div>
          <div class="col-sm-6 text-center">
              <a href="https://twitter.com/phalconphp" alt="Twitter" class="btn-social btn-social-twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i></a>
              <a href="https://www.facebook.com/pages/Phalcon-Framework/134230726685897" alt="Facebook" class="btn-social btn-social-facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i></a>
              <a href="https://plus.google.com/102376109340560896457" alt="Google+" class="btn-social btn-social-googleplus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i></a>
              <a href="https://github.com/phalcon/cphalcon" alt="Github" class="btn-social btn-social-github"><i class="fa fa-fw fa-github" aria-hidden="true"></i></a>
          </div>
          <div class="col-sm-3">
          </div>
      </div>
  </div>
</div>
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-xs-4 col-sm-3">
                <h4>Download</h4>
                <ul>
                    <li><a href="https://phalconphp.com/download">Installing Phalcon PHP</a></li>
                    <li><a href="https://docs.phalconphp.com/en/latest/index.html" class="header-nav-link" target="_blank">Documentation</a></li>
                    <li><a href="https://api.phalconphp.com">API</a></li>
                    <li><a href="https://docs.phalconphp.com/en/latest/reference/tutorial.html">Tutorial</a></li>
                    <li><a href="https://docs.phalconphp.com/en/latest/reference/tutorial.html#sample-applications">Sample Applications</a></li>
                </ul>
            </div>
            <div class="col-xs-4 col-sm-3">
                <h4>Community</h4>
                <ul>
                    <li><a href="https://forum.phalconphp.com/" class="header-nav-link" target="_blank">Forum</a></li>
                    <li><a href="https://github.com/phalcon/cphalcon">GitHub</a></li>
                    <li><a href="https://github.com/phalcon/cphalcon/issues">Issue Tracker</a></li>
                    <li><a href="https://stackoverflow.com/questions/tagged/phalcon">Stack Overflow</a></li>
                    <li><a href="https://phalconphp.com/en/testimonials">Testimonials</a></li>
                    <li><a href="https://builtwith.phalconphp.com/">Built with Phalcon</a></li>
                    <li><a href="https://store.phalconphp.com/">Store</a></li>
                </ul>
            </div>
            <div class="col-xs-4 col-sm-2">
                <h4>About</h4>
                <ul>
                    <li><a class="link-black" href="http://blog.phalconphp.com/">Blog</a></li>
                    <li><a href="https://phalconphp.com/en/about">About</a></li>
                    <li><a href="https://phalconphp.com/en/team">Team</a></li>
                    <li><a href="https://phalconphp.com/en/roadmap">Roadmap</a></li>
                    <li><a href="https://phalconphp.com/en/donate">Donate</a></li>
                    <li><a href="https://phalconphp.com/en/consulting">Consulting</a></li>
                    <li><a href="https://phalconphp.com/en/hosting">Hosting</a></li>
                </ul>
            </div>
            <div id="license-spaccer" class="visible-xs"></div>
            <div id="license-wrapper" class="col-xs-12 col-sm-4">
                <p class="license">
                    Phalcon is an open-source PHP framework <br />
                    built as a C-extension. It is available under the <br />
                    <a href="http://opensource.org/licenses/BSD-3-Clause" target="_blank">new BSD License</a>.
                </p>

                <div class="design">
                    <span>Website Designed by:</span>
                </div>
                <a class="license" href="http://loudertech.com/" target="_blank" title="">
                    <span>LouderTech SAS</span>
                </a>
            </div>
        </div>
    </div>
</footer>

    </div>
    <script type="text/javascript">
    $(window).on("load", function(){
      var cx = '009733439235723428699:lh9ltjgvdz8';
      var gcse = document.createElement('script');
      gcse.type = 'text/javascript';
      gcse.async = true;
      gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cx=' + cx;
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(gcse, s);
    });
    </script>

  </body>
</html>