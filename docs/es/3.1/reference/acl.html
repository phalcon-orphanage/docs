<!DOCTYPE html>

<html lang="en">
  <head>
    
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Access Control Lists (ACL) &mdash; documentación de Phalcon - 3.1.1 (Spanish / Español)</title>
    <meta name="keywords" content="php, phalcon, phalcon php, php framework, faster php framework">
    <link rel="stylesheet" type="text/css" href="https://netdna.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="//static.phalconphp.com/www/css/phalcon.min.css" />
    <link href='//fonts.googleapis.com/css?family=Open+Sans:700,400' rel='stylesheet' type='text/css'>
    <link href="//fonts.googleapis.com/css?family=Merriweather:400,700" rel="stylesheet" type="text/css" />
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" />
    <!--
    EUROPE <link href='//fonts.googleapis.com/css?family=Open+Sans:700,400&subset=latin-ext' rel='stylesheet' type='text/css'>
    GREEK <link href='//fonts.googleapis.com/css?family=Open+Sans:700,400&subset=greek-ext' rel='stylesheet' type='text/css'>
    RUSSIA <link href='//fonts.googleapis.com/css?family=Open+Sans:700,400&subset=cyrillic-ext,latin' rel='stylesheet' type='text/css'>
    -->

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/docs.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.1.1',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/docs.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="documentación de Phalcon - 3.1.1" href="../index.html" />
    <link rel="next" title="Multi-lingual Support" href="translate.html" />
    <link rel="prev" title="Encryption/Decryption" href="crypt.html" /> 
  </head>
  <body>

<header class="page-header">
    <nav class="navbar" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-menu-container">
                    <span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
                </button>
                <a class="navbar-brand phalcon-logo" href="/"><span itemprop="name" class="sr-only">Phalcon PHP</span></a>
            </div>

            <div class="collapse navbar-collapse navbar-right" id="main-menu-container">
                <ul class="nav navbar-nav main-menu">
                  <li class="first"><a href="//phalconphp.com/en/download" class="header-nav-link">Download</a></li>
                  <li><a href="//docs.phalconphp.com/en/latest/index.html" class="header-nav-link" target="_blank">Documentation</a></li>
                  <li><a href="//forum.phalconphp.com/" class="header-nav-link" target="_blank">Forum</a></li>
                  <li><a href="//blog.phalconphp.com/" class="header-nav-link" target="_blank">Blog</a></li>
                  <li><a href="//phalconist.com/" class="header-nav-link" target="_blank">Resources</a></li>
                  <li><a href="//phalconphp.com/en/about">About</a></li>
                  <li><div align="right">
                      <iframe src="https://ghbtns.com/github-btn.html?user=phalcon&amp;repo=cphalcon&amp;type=watch&amp;count=true&amp;size=large"
      allowtransparency="true" frameborder="0" scrolling="0" width="152px" height="30px"></iframe>
                    </div></li>
                </ul>
            </div>
        </div>
    </nav>
  </header>

<div class="heading">
    <div class="container">
        <div class="row">
            <h2>Documentation</h2>
        </div>
    </div>
</div>
    <div class="related">
      <ul>
        <li class="right" >
          <a href="../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="translate.html" title="Multi-lingual Support"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="crypt.html" title="Encryption/Decryption"
             accesskey="P">anterior</a> |</li>
        <li><a href="//phalconphp.com">Home</a> &raquo;</li>
        <li><a href="../index.html">documentación de Phalcon - 3.1.1</a> &raquo;</li> 
      </ul>
    </div>  

      <table width="100%" align="center" cellpadding="0" cellspacing="0">
        <tr>
      <td class="primary-box" width="25%" valign="top">
            <div>
            <div id="searchbox" style="">
                <!--<form class="search" action="http://readthedocs.org/search/project/" method="get">
                  <input type="search" name="q" size="25" placeholder="Search">
                  <input type="submit" value="Go">
                  <input type="hidden" name="selected_facets" value="project:">
                </form>-->
                <div style="width:200px;padding:10px">
                  <gcse:searchbox-only></gcse:searchbox-only>
                </div>
            </div>
            </div>
            <div style="padding:5px;padding-left:10px">
              <div id="carbonads-container">
                <div class="carbonad"><div id="azcarbon"></div>
                <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=phalconphpcom" id="_carbonads_js"></script>
                </div></div>
            </div>
            <h3><a href="../index.html">Tabla de Contenidos</a></h3>
            <ul>
<li><a class="reference internal" href="#">Access Control Lists (ACL)</a><ul>
<li><a class="reference internal" href="#creating-an-acl">Creating an ACL</a></li>
<li><a class="reference internal" href="#adding-roles-to-the-acl">Adding Roles to the ACL</a></li>
<li><a class="reference internal" href="#adding-resources">Adding Resources</a></li>
<li><a class="reference internal" href="#defining-access-controls">Defining Access Controls</a></li>
<li><a class="reference internal" href="#querying-an-acl">Querying an ACL</a></li>
<li><a class="reference internal" href="#function-based-access">Function based access</a></li>
<li><a class="reference internal" href="#objects-as-role-name-and-resource-name">Objects as role name and resource name</a></li>
<li><a class="reference internal" href="#roles-inheritance">Roles Inheritance</a></li>
<li><a class="reference internal" href="#serializing-acl-lists">Serializing ACL lists</a></li>
<li><a class="reference internal" href="#acl-events">ACL Events</a></li>
<li><a class="reference internal" href="#implementing-your-own-adapters">Implementing your own adapters</a></li>
</ul>
</li>
</ul>

            <h4>Tema anterior</h4>
            <p class="topless"><a href="crypt.html" title="capítulo anterior">&lt; Encryption/Decryption</a></p>
            <h4>Próximo tema</h4>
            <p class="topless"><a href="translate.html" title="próximo capítulo">Multi-lingual Support &gt;</a></p>
            <h3>Esta página</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/reference/acl.txt" rel="nofollow">Mostrar el código</a></li>
            </ul>
        </td>
          <td class="second-box" valign="top">
            <div class="document">
                <div class="documentwrapper">
                  <div class="bodywrapper">
                    <div class="body" >
                      
  <div class="section" id="access-control-lists-acl">
<h1>Access Control Lists (ACL)<a class="headerlink" href="#access-control-lists-acl" title="Enlazar permanentemente con este título">¶</a></h1>
<p><a class="reference internal" href="../api/Phalcon_Acl.html"><em>Phalcon\Acl</em></a> provides an easy and lightweight management of ACLs as well as the permissions
attached to them. <a class="reference external" href="http://en.wikipedia.org/wiki/Access_control_list">Access Control Lists</a> (ACL) allow an application to control access to its areas and the underlying
objects from requests. You are encouraged to read more about the ACL methodology so as to be familiar with its concepts.</p>
<p>In summary, ACLs have roles and resources. Resources are objects which abide by the permissions defined to them by
the ACLs. Roles are objects that request access to resources and can be allowed or denied access by the ACL mechanism.</p>
<div class="section" id="creating-an-acl">
<h2>Creating an ACL<a class="headerlink" href="#creating-an-acl" title="Enlazar permanentemente con este título">¶</a></h2>
<p>This component is designed to initially work in memory. This provides ease of use and speed in accessing every aspect of the list. The <a class="reference internal" href="../api/Phalcon_Acl.html"><em>Phalcon\Acl</em></a> constructor takes as its first parameter an adapter used to retrieve the information related to the control list. An example using the memory adapter is below:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Acl\Adapter\Memory</span> <span class="k">as</span> <span class="nx">AclList</span><span class="p">;</span>

<span class="nv">$acl</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AclList</span><span class="p">();</span>
</pre></div>
</div>
<p>By default <a class="reference internal" href="../api/Phalcon_Acl.html"><em>Phalcon\Acl</em></a> allows access to action on resources that have not yet been defined. To increase the security level of the access list we can define a &#8220;deny&#8221; level as a default access level.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Acl</span><span class="p">;</span>

<span class="c1">// Default action is deny access</span>
<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">setDefaultAction</span><span class="p">(</span>
    <span class="nx">Acl</span><span class="o">::</span><span class="na">DENY</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-roles-to-the-acl">
<h2>Adding Roles to the ACL<a class="headerlink" href="#adding-roles-to-the-acl" title="Enlazar permanentemente con este título">¶</a></h2>
<p>A role is an object that can or cannot access certain resources in the access list. As an example, we will define roles as groups of people in an organization. The <a class="reference internal" href="../api/Phalcon_Acl_Role.html"><em>Phalcon\Acl\Role</em></a> class is available to create roles in a more structured way. Let&#8217;s add some roles to our recently created list:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Acl\Role</span><span class="p">;</span>

<span class="c1">// Create some roles.</span>
<span class="c1">// The first parameter is the name, the second parameter is an optional description.</span>
<span class="nv">$roleAdmins</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Role</span><span class="p">(</span><span class="s2">&quot;Administrators&quot;</span><span class="p">,</span> <span class="s2">&quot;Super-User role&quot;</span><span class="p">);</span>
<span class="nv">$roleGuests</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Role</span><span class="p">(</span><span class="s2">&quot;Guests&quot;</span><span class="p">);</span>

<span class="c1">// Add &quot;Guests&quot; role to ACL</span>
<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">addRole</span><span class="p">(</span><span class="nv">$roleGuests</span><span class="p">);</span>

<span class="c1">// Add &quot;Designers&quot; role to ACL without a Phalcon\Acl\Role</span>
<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">addRole</span><span class="p">(</span><span class="s2">&quot;Designers&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>As you can see, roles are defined directly without using an instance.</p>
</div>
<div class="section" id="adding-resources">
<h2>Adding Resources<a class="headerlink" href="#adding-resources" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Resources are objects where access is controlled. Normally in MVC applications resources refer to controllers. Although this is not mandatory, the <a class="reference internal" href="../api/Phalcon_Acl_Resource.html"><em>Phalcon\Acl\Resource</em></a> class can be used in defining resources. It&#8217;s important to add related actions or operations to a resource so that the ACL can understand what it should to control.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Acl\Resource</span><span class="p">;</span>

<span class="c1">// Define the &quot;Customers&quot; resource</span>
<span class="nv">$customersResource</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Resource</span><span class="p">(</span><span class="s2">&quot;Customers&quot;</span><span class="p">);</span>

<span class="c1">// Add &quot;customers&quot; resource with a couple of operations</span>

<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">addResource</span><span class="p">(</span>
    <span class="nv">$customersResource</span><span class="p">,</span>
    <span class="s2">&quot;search&quot;</span>
<span class="p">);</span>

<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">addResource</span><span class="p">(</span>
    <span class="nv">$customersResource</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s2">&quot;create&quot;</span><span class="p">,</span>
        <span class="s2">&quot;update&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="defining-access-controls">
<h2>Defining Access Controls<a class="headerlink" href="#defining-access-controls" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Now that we have roles and resources, it&#8217;s time to define the ACL (i.e. which roles can access which resources). This part is very important especially taking into consideration your default access level &#8220;allow&#8221; or &#8220;deny&#8221;.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Set access level for roles into resources</span>

<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">allow</span><span class="p">(</span><span class="s2">&quot;Guests&quot;</span><span class="p">,</span> <span class="s2">&quot;Customers&quot;</span><span class="p">,</span> <span class="s2">&quot;search&quot;</span><span class="p">);</span>

<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">allow</span><span class="p">(</span><span class="s2">&quot;Guests&quot;</span><span class="p">,</span> <span class="s2">&quot;Customers&quot;</span><span class="p">,</span> <span class="s2">&quot;create&quot;</span><span class="p">);</span>

<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">deny</span><span class="p">(</span><span class="s2">&quot;Guests&quot;</span><span class="p">,</span> <span class="s2">&quot;Customers&quot;</span><span class="p">,</span> <span class="s2">&quot;update&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>The <code class="code docutils literal"><span class="pre">allow()</span></code> method designates that a particular role has granted access to a particular resource. The <code class="code docutils literal"><span class="pre">deny()</span></code> method does the opposite.</p>
</div>
<div class="section" id="querying-an-acl">
<h2>Querying an ACL<a class="headerlink" href="#querying-an-acl" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Once the list has been completely defined. We can query it to check if a role has a given permission or not.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Check whether role has access to the operations</span>

<span class="c1">// Returns 0</span>
<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">isAllowed</span><span class="p">(</span><span class="s2">&quot;Guests&quot;</span><span class="p">,</span> <span class="s2">&quot;Customers&quot;</span><span class="p">,</span> <span class="s2">&quot;edit&quot;</span><span class="p">);</span>

<span class="c1">// Returns 1</span>
<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">isAllowed</span><span class="p">(</span><span class="s2">&quot;Guests&quot;</span><span class="p">,</span> <span class="s2">&quot;Customers&quot;</span><span class="p">,</span> <span class="s2">&quot;search&quot;</span><span class="p">);</span>

<span class="c1">// Returns 1</span>
<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">isAllowed</span><span class="p">(</span><span class="s2">&quot;Guests&quot;</span><span class="p">,</span> <span class="s2">&quot;Customers&quot;</span><span class="p">,</span> <span class="s2">&quot;create&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="function-based-access">
<h2>Function based access<a class="headerlink" href="#function-based-access" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Also you can add as 4th parameter your custom function which must return boolean value. It will be called when you use <code class="code docutils literal"><span class="pre">isAllowed()</span></code> method. You can pass parameters as associative array to <code class="code docutils literal"><span class="pre">isAllowed()</span></code> method as 4th argument where key is parameter name in our defined function.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// Set access level for role into resources with custom function</span>
<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">allow</span><span class="p">(</span>
    <span class="s2">&quot;Guests&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Customers&quot;</span><span class="p">,</span>
    <span class="s2">&quot;search&quot;</span><span class="p">,</span>
    <span class="k">function</span> <span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$a</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">===</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">);</span>

<span class="c1">// Check whether role has access to the operation with custom function</span>

<span class="c1">// Returns true</span>
<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">isAllowed</span><span class="p">(</span>
    <span class="s2">&quot;Guests&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Customers&quot;</span><span class="p">,</span>
    <span class="s2">&quot;search&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s2">&quot;a&quot;</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">);</span>

<span class="c1">// Returns false</span>
<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">isAllowed</span><span class="p">(</span>
    <span class="s2">&quot;Guests&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Customers&quot;</span><span class="p">,</span>
    <span class="s2">&quot;search&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s2">&quot;a&quot;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Also if you don&#8217;t provide any parameters in <code class="code docutils literal"><span class="pre">isAllowed()</span></code> method then default behaviour will be <code class="code docutils literal"><span class="pre">Acl::ALLOW</span></code>. You can change it by using method <code class="code docutils literal"><span class="pre">setNoArgumentsDefaultAction()</span></code>.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">use Phalcon\Acl;</span>

<span class="cp">&lt;?php</span>
<span class="c1">// Set access level for role into resources with custom function</span>
<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">allow</span><span class="p">(</span>
    <span class="s2">&quot;Guests&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Customers&quot;</span><span class="p">,</span>
    <span class="s2">&quot;search&quot;</span><span class="p">,</span>
    <span class="k">function</span> <span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$a</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">===</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">);</span>

<span class="c1">// Check whether role has access to the operation with custom function</span>

<span class="c1">// Returns true</span>
<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">isAllowed</span><span class="p">(</span>
    <span class="s2">&quot;Guests&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Customers&quot;</span><span class="p">,</span>
    <span class="s2">&quot;search&quot;</span>
<span class="p">);</span>

<span class="c1">// Change no arguments default action</span>
<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">setNoArgumentsDefaultAction</span><span class="p">(</span>
    <span class="nx">Acl</span><span class="o">::</span><span class="na">DENY</span>
<span class="p">);</span>

<span class="c1">// Returns false</span>
<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">isAllowed</span><span class="p">(</span>
    <span class="s2">&quot;Guests&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Customers&quot;</span><span class="p">,</span>
    <span class="s2">&quot;search&quot;</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="objects-as-role-name-and-resource-name">
<h2>Objects as role name and resource name<a class="headerlink" href="#objects-as-role-name-and-resource-name" title="Enlazar permanentemente con este título">¶</a></h2>
<p>You can pass objects as <code class="code docutils literal"><span class="pre">roleName</span></code> and <code class="code docutils literal"><span class="pre">resourceName</span></code>. Your classes must implement <a class="reference internal" href="../api/Phalcon_Acl_RoleAware.html"><em>Phalcon\Acl\RoleAware</em></a> for <code class="code docutils literal"><span class="pre">roleName</span></code> and <a class="reference internal" href="../api/Phalcon_Acl_ResourceAware.html"><em>Phalcon\Acl\ResourceAware</em></a> for <code class="code docutils literal"><span class="pre">resourceName</span></code>.</p>
<p>Our <code class="code docutils literal"><span class="pre">UserRole</span></code> class</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Acl\RoleAware</span><span class="p">;</span>

<span class="c1">// Create our class which will be used as roleName</span>
<span class="k">class</span> <span class="nc">UserRole</span> <span class="k">implements</span> <span class="nx">RoleAware</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$id</span><span class="p">;</span>

    <span class="k">protected</span> <span class="nv">$roleName</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="nv">$roleName</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">id</span>       <span class="o">=</span> <span class="nv">$id</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">roleName</span> <span class="o">=</span> <span class="nv">$roleName</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getId</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Implemented function from RoleAware Interface</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getRoleName</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">roleName</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>And our <code class="code docutils literal"><span class="pre">ModelResource</span></code> class</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Acl\ResourceAware</span><span class="p">;</span>

<span class="c1">// Create our class which will be used as resourceName</span>
<span class="k">class</span> <span class="nc">ModelResource</span> <span class="k">implements</span> <span class="nx">ResourceAware</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$id</span><span class="p">;</span>

    <span class="k">protected</span> <span class="nv">$resourceName</span><span class="p">;</span>

    <span class="k">protected</span> <span class="nv">$userId</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="nv">$resourceName</span><span class="p">,</span> <span class="nv">$userId</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">id</span>           <span class="o">=</span> <span class="nv">$id</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">resourceName</span> <span class="o">=</span> <span class="nv">$resourceName</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">userId</span>       <span class="o">=</span> <span class="nv">$userId</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getId</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getUserId</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">userId</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Implemented function from ResourceAware Interface</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getResourceName</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">resourceName</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Then you can use them in <code class="code docutils literal"><span class="pre">isAllowed()</span></code> method.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">UserRole</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">ModelResource</span><span class="p">;</span>

<span class="c1">// Set access level for role into resources</span>
<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">allow</span><span class="p">(</span><span class="s2">&quot;Guests&quot;</span><span class="p">,</span> <span class="s2">&quot;Customers&quot;</span><span class="p">,</span> <span class="s2">&quot;search&quot;</span><span class="p">);</span>
<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">allow</span><span class="p">(</span><span class="s2">&quot;Guests&quot;</span><span class="p">,</span> <span class="s2">&quot;Customers&quot;</span><span class="p">,</span> <span class="s2">&quot;create&quot;</span><span class="p">);</span>
<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">deny</span><span class="p">(</span><span class="s2">&quot;Guests&quot;</span><span class="p">,</span> <span class="s2">&quot;Customers&quot;</span><span class="p">,</span> <span class="s2">&quot;update&quot;</span><span class="p">);</span>

<span class="c1">// Create our objects providing roleName and resourceName</span>

<span class="nv">$customer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ModelResource</span><span class="p">(</span>
    <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;Customers&quot;</span><span class="p">,</span>
    <span class="mi">2</span>
<span class="p">);</span>

<span class="nv">$designer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserRole</span><span class="p">(</span>
    <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;Designers&quot;</span>
<span class="p">);</span>

<span class="nv">$guest</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserRole</span><span class="p">(</span>
    <span class="mi">2</span><span class="p">,</span>
    <span class="s2">&quot;Guests&quot;</span>
<span class="p">);</span>

<span class="nv">$anotherGuest</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserRole</span><span class="p">(</span>
    <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;Guests&quot;</span>
<span class="p">);</span>

<span class="c1">// Check whether our user objects have access to the operation on model object</span>

<span class="c1">// Returns false</span>
<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">isAllowed</span><span class="p">(</span>
    <span class="nv">$designer</span><span class="p">,</span>
    <span class="nv">$customer</span><span class="p">,</span>
    <span class="s2">&quot;search&quot;</span>
<span class="p">);</span>

<span class="c1">// Returns true</span>
<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">isAllowed</span><span class="p">(</span>
    <span class="nv">$guest</span><span class="p">,</span>
    <span class="nv">$customer</span><span class="p">,</span>
    <span class="s2">&quot;search&quot;</span>
<span class="p">);</span>

<span class="c1">// Returns true</span>
<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">isAllowed</span><span class="p">(</span>
    <span class="nv">$anotherGuest</span><span class="p">,</span>
    <span class="nv">$customer</span><span class="p">,</span>
    <span class="s2">&quot;search&quot;</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Also you can access those objects in your custom function in <code class="code docutils literal"><span class="pre">allow()</span></code> or <code class="code docutils literal"><span class="pre">deny()</span></code>. They are automatically bind to parameters by type in function.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">UserRole</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">ModelResource</span><span class="p">;</span>

<span class="c1">// Set access level for role into resources with custom function</span>
<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">allow</span><span class="p">(</span>
    <span class="s2">&quot;Guests&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Customers&quot;</span><span class="p">,</span>
    <span class="s2">&quot;search&quot;</span><span class="p">,</span>
    <span class="k">function</span> <span class="p">(</span><span class="nx">UserRole</span> <span class="nv">$user</span><span class="p">,</span> <span class="nx">ModelResource</span> <span class="nv">$model</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// User and Model classes are necessary</span>
        <span class="k">return</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getId</span> <span class="o">==</span> <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">getUserId</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">);</span>

<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">allow</span><span class="p">(</span>
    <span class="s2">&quot;Guests&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Customers&quot;</span><span class="p">,</span>
    <span class="s2">&quot;create&quot;</span>
<span class="p">);</span>

<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">deny</span><span class="p">(</span>
    <span class="s2">&quot;Guests&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Customers&quot;</span><span class="p">,</span>
    <span class="s2">&quot;update&quot;</span>
<span class="p">);</span>

<span class="c1">// Create our objects providing roleName and resourceName</span>

<span class="nv">$customer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ModelResource</span><span class="p">(</span>
    <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;Customers&quot;</span><span class="p">,</span>
    <span class="mi">2</span>
<span class="p">);</span>

<span class="nv">$designer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserRole</span><span class="p">(</span>
    <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;Designers&quot;</span>
<span class="p">);</span>

<span class="nv">$guest</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserRole</span><span class="p">(</span>
    <span class="mi">2</span><span class="p">,</span>
    <span class="s2">&quot;Guests&quot;</span>
<span class="p">);</span>

<span class="nv">$anotherGuest</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserRole</span><span class="p">(</span>
    <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;Guests&quot;</span>
<span class="p">);</span>

<span class="c1">// Check whether our user objects have access to the operation on model object</span>

<span class="c1">// Returns false</span>
<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">isAllowed</span><span class="p">(</span>
    <span class="nv">$designer</span><span class="p">,</span>
    <span class="nv">$customer</span><span class="p">,</span>
    <span class="s2">&quot;search&quot;</span>
<span class="p">);</span>

<span class="c1">// Returns true</span>
<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">isAllowed</span><span class="p">(</span>
    <span class="nv">$guest</span><span class="p">,</span>
    <span class="nv">$customer</span><span class="p">,</span>
    <span class="s2">&quot;search&quot;</span>
<span class="p">);</span>

<span class="c1">// Returns false</span>
<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">isAllowed</span><span class="p">(</span>
    <span class="nv">$anotherGuest</span><span class="p">,</span>
    <span class="nv">$customer</span><span class="p">,</span>
    <span class="s2">&quot;search&quot;</span>
<span class="p">);</span>
</pre></div>
</div>
<p>You can still add any custom parameters to function and pass associative array in <code class="code docutils literal"><span class="pre">isAllowed()</span></code> method. Also order doesn&#8217;t matter.</p>
</div>
<div class="section" id="roles-inheritance">
<h2>Roles Inheritance<a class="headerlink" href="#roles-inheritance" title="Enlazar permanentemente con este título">¶</a></h2>
<p>You can build complex role structures using the inheritance that <a class="reference internal" href="../api/Phalcon_Acl_Role.html"><em>Phalcon\Acl\Role</em></a> provides. Roles can inherit from other roles, thus allowing access to supersets or subsets of resources. To use role inheritance, you need to pass the inherited role as the second parameter of the method call, when adding that role in the list.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Acl\Role</span><span class="p">;</span>

<span class="c1">// ...</span>

<span class="c1">// Create some roles</span>

<span class="nv">$roleAdmins</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Role</span><span class="p">(</span><span class="s2">&quot;Administrators&quot;</span><span class="p">,</span> <span class="s2">&quot;Super-User role&quot;</span><span class="p">);</span>

<span class="nv">$roleGuests</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Role</span><span class="p">(</span><span class="s2">&quot;Guests&quot;</span><span class="p">);</span>

<span class="c1">// Add &quot;Guests&quot; role to ACL</span>
<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">addRole</span><span class="p">(</span><span class="nv">$roleGuests</span><span class="p">);</span>

<span class="c1">// Add &quot;Administrators&quot; role inheriting from &quot;Guests&quot; its accesses</span>
<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">addRole</span><span class="p">(</span><span class="nv">$roleAdmins</span><span class="p">,</span> <span class="nv">$roleGuests</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="serializing-acl-lists">
<h2>Serializing ACL lists<a class="headerlink" href="#serializing-acl-lists" title="Enlazar permanentemente con este título">¶</a></h2>
<p>To improve performance <a class="reference internal" href="../api/Phalcon_Acl.html"><em>Phalcon\Acl</em></a> instances can be serialized and stored in APC, session, text files or a database table
so that they can be loaded at will without having to redefine the whole list. You can do that as follows:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Acl\Adapter\Memory</span> <span class="k">as</span> <span class="nx">AclList</span><span class="p">;</span>

<span class="c1">// ...</span>

<span class="c1">// Check whether ACL data already exist</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_file</span><span class="p">(</span><span class="s2">&quot;app/security/acl.data&quot;</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$acl</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AclList</span><span class="p">();</span>

    <span class="c1">// ... Define roles, resources, access, etc</span>

    <span class="c1">// Store serialized list into plain file</span>
    <span class="nb">file_put_contents</span><span class="p">(</span>
        <span class="s2">&quot;app/security/acl.data&quot;</span><span class="p">,</span>
        <span class="nb">serialize</span><span class="p">(</span><span class="nv">$acl</span><span class="p">)</span>
    <span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Restore ACL object from serialized file</span>
    <span class="nv">$acl</span> <span class="o">=</span> <span class="nb">unserialize</span><span class="p">(</span>
        <span class="nb">file_get_contents</span><span class="p">(</span><span class="s2">&quot;app/security/acl.data&quot;</span><span class="p">)</span>
    <span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Use ACL list as needed</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">isAllowed</span><span class="p">(</span><span class="s2">&quot;Guests&quot;</span><span class="p">,</span> <span class="s2">&quot;Customers&quot;</span><span class="p">,</span> <span class="s2">&quot;edit&quot;</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">&quot;Access granted!&quot;</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">&quot;Access denied :(&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It&#8217;s recommended to use the Memory adapter during development and use one of the other adapters in production.</p>
</div>
<div class="section" id="acl-events">
<h2>ACL Events<a class="headerlink" href="#acl-events" title="Enlazar permanentemente con este título">¶</a></h2>
<p><a class="reference internal" href="../api/Phalcon_Acl.html"><em>Phalcon\Acl</em></a> is able to send events to a <a class="reference internal" href="events.html"><em>EventsManager</em></a> if it&#8217;s present. Events
are triggered using the type &#8220;acl&#8221;. Some events when returning boolean false could stop the active operation. The following events are supported:</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="59%" />
<col width="22%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Event Name</th>
<th class="head">Triggered</th>
<th class="head">Can stop operation?</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>beforeCheckAccess</td>
<td>Triggered before checking if a role/resource has access</td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>afterCheckAccess</td>
<td>Triggered after checking if a role/resource has access</td>
<td>No</td>
</tr>
</tbody>
</table>
<p>The following example demonstrates how to attach listeners to this component:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Acl\Adapter\Memory</span> <span class="k">as</span> <span class="nx">AclList</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Phalcon\Events\Event</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Phalcon\Events\Manager</span> <span class="k">as</span> <span class="nx">EventsManager</span><span class="p">;</span>

<span class="c1">// ...</span>

<span class="c1">// Create an event manager</span>
<span class="nv">$eventsManager</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventsManager</span><span class="p">();</span>

<span class="c1">// Attach a listener for type &quot;acl&quot;</span>
<span class="nv">$eventsManager</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span>
    <span class="s2">&quot;acl:beforeCheckAccess&quot;</span><span class="p">,</span>
    <span class="k">function</span> <span class="p">(</span><span class="nx">Event</span> <span class="nv">$event</span><span class="p">,</span> <span class="nv">$acl</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">getActiveRole</span><span class="p">();</span>

        <span class="k">echo</span> <span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">getActiveResource</span><span class="p">();</span>

        <span class="k">echo</span> <span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">getActiveAccess</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">);</span>

<span class="nv">$acl</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AclList</span><span class="p">();</span>

<span class="c1">// Setup the $acl</span>
<span class="c1">// ...</span>

<span class="c1">// Bind the eventsManager to the ACL component</span>
<span class="nv">$acl</span><span class="o">-&gt;</span><span class="na">setEventsManager</span><span class="p">(</span><span class="nv">$eventsManager</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="implementing-your-own-adapters">
<h2>Implementing your own adapters<a class="headerlink" href="#implementing-your-own-adapters" title="Enlazar permanentemente con este título">¶</a></h2>
<p>The <a class="reference internal" href="../api/Phalcon_Acl_AdapterInterface.html"><em>Phalcon\Acl\AdapterInterface</em></a> interface must be implemented in order
to create your own ACL adapters or extend the existing ones.</p>
</div>
</div>


                    </div>
                  </div>
                </div>
            </div>
          </td>
        </tr>
      </table>
    <div class="related">
      <ul>
        <li class="right" >
          <a href="../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="translate.html" title="Multi-lingual Support"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="crypt.html" title="Encryption/Decryption"
             >anterior</a> |</li> 
      </ul>
    </div>

      <div class="prefooter">
  <div class="container">
      <div class="row">
          <div class="col-sm-3 text-right">
              <span>Follow along:</span>
          </div>
          <div class="col-sm-6 text-center">
              <a href="https://twitter.com/phalconphp" alt="Twitter" class="btn-social btn-social-twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i></a>
              <a href="https://www.facebook.com/pages/Phalcon-Framework/134230726685897" alt="Facebook" class="btn-social btn-social-facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i></a>
              <a href="https://plus.google.com/102376109340560896457" alt="Google+" class="btn-social btn-social-googleplus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i></a>
              <a href="https://github.com/phalcon/cphalcon" alt="Github" class="btn-social btn-social-github"><i class="fa fa-fw fa-github" aria-hidden="true"></i></a>
          </div>
          <div class="col-sm-3">
          </div>
      </div>
  </div>
</div>
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-xs-4 col-sm-3">
                <h4>Download</h4>
                <ul>
                    <li><a href="https://phalconphp.com/download">Installing Phalcon PHP</a></li>
                    <li><a href="https://docs.phalconphp.com/en/latest/index.html" class="header-nav-link" target="_blank">Documentation</a></li>
                    <li><a href="https://api.phalconphp.com">API</a></li>
                    <li><a href="https://docs.phalconphp.com/en/latest/reference/tutorial.html">Tutorial</a></li>
                    <li><a href="https://docs.phalconphp.com/en/latest/reference/tutorial.html#sample-applications">Sample Applications</a></li>
                </ul>
            </div>
            <div class="col-xs-4 col-sm-3">
                <h4>Community</h4>
                <ul>
                    <li><a href="https://forum.phalconphp.com/" class="header-nav-link" target="_blank">Forum</a></li>
                    <li><a href="https://github.com/phalcon/cphalcon">GitHub</a></li>
                    <li><a href="https://github.com/phalcon/cphalcon/issues">Issue Tracker</a></li>
                    <li><a href="https://stackoverflow.com/questions/tagged/phalcon">Stack Overflow</a></li>
                    <li><a href="https://phalconphp.com/en/testimonials">Testimonials</a></li>
                    <li><a href="https://builtwith.phalconphp.com/">Built with Phalcon</a></li>
                    <li><a href="https://store.phalconphp.com/">Store</a></li>
                </ul>
            </div>
            <div class="col-xs-4 col-sm-2">
                <h4>About</h4>
                <ul>
                    <li><a class="link-black" href="http://blog.phalconphp.com/">Blog</a></li>
                    <li><a href="https://phalconphp.com/en/about">About</a></li>
                    <li><a href="https://phalconphp.com/en/team">Team</a></li>
                    <li><a href="https://phalconphp.com/en/roadmap">Roadmap</a></li>
                    <li><a href="https://phalconphp.com/en/donate">Donate</a></li>
                    <li><a href="https://phalconphp.com/en/consulting">Consulting</a></li>
                    <li><a href="https://phalconphp.com/en/hosting">Hosting</a></li>
                </ul>
            </div>
            <div id="license-spaccer" class="visible-xs"></div>
            <div id="license-wrapper" class="col-xs-12 col-sm-4">
                <p class="license">
                    Phalcon is an open-source PHP framework <br />
                    built as a C-extension. It is available under the <br />
                    <a href="http://opensource.org/licenses/BSD-3-Clause" target="_blank">new BSD License</a>.
                </p>

                <div class="design">
                    <span>Website Designed by:</span>
                </div>
                <a class="license" href="http://loudertech.com/" target="_blank" title="">
                    <span>LouderTech SAS</span>
                </a>
            </div>
        </div>
    </div>
</footer>

    </div>
    <script type="text/javascript">
    $(window).on("load", function(){
      var cx = '009733439235723428699:lh9ltjgvdz8';
      var gcse = document.createElement('script');
      gcse.type = 'text/javascript';
      gcse.async = true;
      gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cx=' + cx;
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(gcse, s);
    });
    </script>

  </body>
</html>