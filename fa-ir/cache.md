---
layout: article
language: 'fa-ir'
version: '4.0'
---
**This article reflects v3.4 and has not yet been revised**

<a name='overview'></a>

# بهبود عملکرد با حافظه پنهان

Phalcon provides the `Phalcon\Cache` class allowing faster access to frequently used or already processed data. `Phalcon\Cache` is written in C, achieving higher performance and reducing the overhead when getting items from the backends. This class uses an internal structure of frontend and backend components. Front-end components act as input sources or interfaces, while backend components offer storage options to the class.

<a name='implementation'></a>

## چه زمانی حافظه پنهان را اجرا کنیم?

Although this component is very fast, implementing it in cases that are not needed could lead to a loss of performance rather than gain. We recommend you check this cases before using a cache:

* شما محاسبات پیچیده ای را انجام می دهید که هربار به همان نتایج باز می گردد.(به ندرت تغییر می کند)
* شما از حامیان بسیاری استفاده می کنید و خروجی تولید شده همیشه همان است
* شما دائما به اطلاعات پایگاه داده دسترسی پیدا می کنید و این اطلاعات به ندرت تغییر پیدا می کنند

<div class='alert alert-warning'>
    <p>
        <strong>توجه داشته باشید</strong>حتی پس از اجرای حافظه پنهان، شما باید نسبت موفقیت حافظه پنهان را در طول یک دوره زمانی بسنجید. این می تواند به راحتی انجام شود. مخصوصا در موارد Memcache یا Apc با ابزار مرتبط که پشتیبانی را مهیا می کند.
    </p>
</div>

<a name='caching-behavior'></a>

## رفتار حافظه پنهان

The caching process is divided into 2 parts:

* **ظاهر**: اینکه بخش برای بررسی اینکه آیا یک کلید منقضی شده است و انجام انتقالات اضافی به داده را قبل از ذخیره و بعد از بازیابی آنها از پشتیبانی مسئول است
* **پایه**: این بخش برای برقراری ارتباط، نوشتن/خواندن داده لازم توسط نرم افزار نهایی، مسئول است.

<a name='factory'></a>

## کارخانه

Instantiating frontend or backend adapters can be achieved by two ways:

Traditional way

```php
<?php

use Phalcon\Cache\Backend\File as BackFile;
use Phalcon\Cache\Frontend\Data as FrontData;

// Create an Output frontend. فایل ها را 2 روز نگه دارید
$frontCache = new FrontData(
    [
        'lifetime' => 172800,
    ]
);

// ایجاد مولفه ای که از 'خروجی' به پشتیبانی 'فایل' ذخیره می کند 
// فایل ذخیره را تنظیم کنید راهنما - مهم است که '/' را در انتهای 
// نگه دارید. مقدار برای پوشه
$cache = new BackFile(
    $frontCache,
    [
        'cacheDir' => '../app/cache/',
    ]
);
```

or using the Factory object as follows:

```php
<?php

use Phalcon\Cache\Frontend\Factory as FFactory;
use Phalcon\Cache\Backend\Factory as BFactory;

 $options = [
     'lifetime' => 172800,
     'adapter'  => 'data',
 ];
 $frontendCache = FFactory::load($options);


$options = [
    'cacheDir' => '../app/cache/',
    'prefix'   => 'app-data',
    'frontend' => $frontendCache,
    'adapter'  => 'file',
];

$backendCache = BFactory::load($options);
```

<a name='output-fragments'></a>

## ذخیره قطعات خروجی

An output fragment is a piece of HTML or text that is cached as is and returned as is. The output is automatically captured from the `ob_*` functions or the PHP output so that it can be saved in the cache. The following example demonstrates such usage. It receives the output generated by PHP and stores it into a file. The contents of the file are refreshed every 172,800 seconds (2 days).

The implementation of this caching mechanism allows us to gain performance by not executing the helper `Phalcon\Tag::linkTo()` call whenever this piece of code is called.

```php
<?php

use Phalcon\Tag;
use Phalcon\Cache\Backend\File as BackFile;
use Phalcon\Cache\Frontend\Output as FrontOutput;

// Create an Output frontend. Cache the files for 2 days
$frontCache = new FrontOutput(
    [
        'lifetime' => 172800,
    ]
);

// Create the component that will cache from the 'Output' to a 'File' backend
// Set the cache file directory - it's important to keep the '/' at the end of
// the value for the folder
$cache = new BackFile(
    $frontCache,
    [
        'cacheDir' => '../app/cache/',
    ]
);

// Get/Set the cache file to ../app/cache/my-cache.html
$content = $cache->start('my-cache.html');

// If $content is null then the content will be generated for the cache
if ($content === null) {
    // Print date and time
    echo date('r');

    // Generate a link to the sign-up action
    echo Tag::linkTo(
        [
            'user/signup',
            'Sign Up',
            'class' => 'signup-button',
        ]
    );

    // Store the output into the cache file
    $cache->save();
} else {
    // Echo the cached output
    echo $content;
}
```

<div class='alert alert-warning'>
    <p>
        <strong>توجه داشته باشید</strong> در مثال بالا، کد همانند قبل باقی می ماند، خروجی را همانطور که قبلا انجام می شد، نمایش می دهد. مولفه ی حافظه ی پنهان ما، به طور روشنی، آن خروجی را دریافت میکند و آن را در فایل حافظه نهان ذخیره میکند. (هنگامیکه حافظه نهان تولید شده باشد.) یا آن را به یک کاربر مطابقت داده نشده از تماس قبلی باز می فرستد؛ در نتیجه از عملیات پر هزینه جلوگیری می کند.
    </p>
</div>

<a name='arbitrary-data'></a>

## ذخیره داده دلخواه

Caching just data is equally important for your application. Caching can reduce database load by reusing commonly used (but not updated) data, thus speeding up your application.

<a name='backend-file-example'></a>

### مثال پشت خط فایل

One of the caching adapters is `File`. The only key area for this adapter is the location of where the cache files will be stored. This is controlled by the `cacheDir` option which *must* have a backslash at the end of it.

```php
<?php

use Phalcon\Cache\Backend\File as BackFile;
use Phalcon\Cache\Frontend\Data as FrontData;

// Cache the files for 2 days using a Data frontend
$frontCache = new FrontData(
    [
        'lifetime' => 172800,
    ]
);

// Create the component that will cache 'Data' to a 'File' backend
// Set the cache file directory - important to keep the `/` at the end of
// the value for the folder
$cache = new BackFile(
    $frontCache,
    [
        'cacheDir' => '../app/cache/',
    ]
);

$cacheKey = 'robots_order_id.cache';

// Try to get cached records
$robots = $cache->get($cacheKey);

if ($robots === null) {
    // $robots is null because of cache expiration or data does not exist
    // Make the database call and populate the variable
    $robots = Robots::find(
        [
            'order' => 'id',
        ]
    );

    // Store it in the cache
    $cache->save($cacheKey, $robots);
}

// Use $robots :)
foreach ($robots as $robot) {
   echo $robot->name, '\n';
}
```

<a name='backend-memcached-example'></a>

### مثال حافظه پنهان حافظه ذخیره شده

The above example changes slightly (especially in terms of configuration) when we are using a Memcached backend.

```php
<?php

use Phalcon\Cache\Frontend\Data as FrontData;
use Phalcon\Cache\Backend\Libmemcached as BackMemCached;

// Cache data for one hour
$frontCache = new FrontData(
    [
        'lifetime' => 3600,
    ]
);

// Create the component that will cache 'Data' to a 'Memcached' backend
// Memcached connection settings
$cache = new BackMemCached(
    $frontCache,
    [
        'servers' => [
            [
                'host'   => '127.0.0.1',
                'port'   => '11211',
                'weight' => '1',
            ]
        ]
    ]
);

$cacheKey = 'robots_order_id.cache';

// Try to get cached records
$robots = $cache->get($cacheKey);

if ($robots === null) {
    // $robots is null because of cache expiration or data does not exist
    // Make the database call and populate the variable
    $robots = Robots::find(
        [
            'order' => 'id',
        ]
    );

    // Store it in the cache
    $cache->save($cacheKey, $robots);
}

// Use $robots :)
foreach ($robots as $robot) {
   echo $robot->name, '\n';
}
```

<div class='alert alert-warning'>
    <p>
        <strong>توجه داشته باشید</strong> صدا زدن <code>ذخیره()</code>، یک بولین را باز میگردند که موفقیت (<code>درست</code>) یا شکست (<code>غلط</code>) را نشان میدهد. بسته به پشت صحنه ای که استفاده میکنید، شما باید به سیاهه های مرتبط،برای شناسایی شکست ها نگاه کنید.
    </p>
</div>

<a name='read'></a>

## درخواست حافظه پنهان

The elements added to the cache are uniquely identified by a key. In the case of the File backend, the key is the actual filename. To retrieve data from the cache, we just have to call it using the unique key. If the key does not exist, the get method will return null.

```php
<?php

// محصولات را با کلید "محصولات من" بازیابی کنید
$products = $cache->get('myProducts');
```

If you want to know which keys are stored in the cache you could call the `queryKeys` method:

```php
<?php

// Query all keys used in the cache
$keys = $cache->queryKeys();

foreach ($keys as $key) {
    $data = $cache->get($key);

    echo 'Key=', $key, ' Data=', $data;
}

// Query keys in the cache that begins with 'my-prefix'
$keys = $cache->queryKeys('my-prefix');
```

<a name='delete'></a>

## حذف داده از حافظه پنهان

There are times where you will need to forcibly invalidate a cache entry (due to an update in the cached data). The only requirement is to know the key that the data have been stored with.

```php
<?php

// Delete an item with a specific key
$cache->delete('someKey');

$keys = $cache->queryKeys();

// Delete all items from the cache
foreach ($keys as $key) {
    $cache->delete($key);
}
```

<a name='exists'></a>

## بررسی وجود حافظه پنهان

It is possible to check if a cache already exists with a given key:

```php
<?php

if ($cache->exists('someKey')) {
    echo $cache->get('someKey');
} else {
    echo 'Cache does not exists!';
}
```

<a name='lifetime'></a>

## طول عمر

A `lifetime` is a time in seconds that a cache could live without expire. By default, all the created caches use the lifetime set in the frontend creation. You can set a specific lifetime in the creation or retrieving of the data from the cache:

Setting the lifetime when retrieving:

```php
<?php

$cacheKey = 'my.cache';

// Setting the cache when getting a result
$robots = $cache->get($cacheKey, 3600);

if ($robots === null) {
    $robots = 'some robots';

    // Store it in the cache
    $cache->save($cacheKey, $robots);
}
```

Setting the lifetime when saving:

```php
<?php

$cacheKey = 'my.cache';

$robots = $cache->get($cacheKey);

if ($robots === null) {
    $robots = 'some robots';

    // Setting the cache when saving data
    $cache->save($cacheKey, $robots, 3600);
}
```

<a name='multi-level'></a>

## حافظه پنهان چند سطحی

This feature of the cache component, allows the developer to implement a multi-level cache. This new feature is very useful because you can save the same data in several cache locations with different lifetimes, reading first from the one with the faster adapter and ending with the slowest one until the data expires:

```php
<?php

use Phalcon\Cache\Multiple;
use Phalcon\Cache\Backend\Apc as ApcCache;
use Phalcon\Cache\Backend\File as FileCache;
use Phalcon\Cache\Frontend\Data as DataFrontend;
use Phalcon\Cache\Backend\Memcache as MemcacheCache;

$ultraFastFrontend = new DataFrontend(
    [
        'lifetime' => 3600,
    ]
);

$fastFrontend = new DataFrontend(
    [
        'lifetime' => 86400,
    ]
);

$slowFrontend = new DataFrontend(
    [
        'lifetime' => 604800,
    ]
);

// Backends are registered from the fastest to the slower
$cache = new Multiple(
    [
        new ApcCache(
            $ultraFastFrontend,
            [
                'prefix' => 'cache',
            ]
        ),
        new MemcacheCache(
            $fastFrontend,
            [
                'prefix' => 'cache',
                'host'   => 'localhost',
                'port'   => '11211',
            ]
        ),
        new FileCache(
            $slowFrontend,
            [
                'prefix'   => 'cache',
                'cacheDir' => '../app/cache/',
            ]
        ),
    ]
);

// Save, saves in every backend
$cache->save('my-key', $data);
```

<a name='adapters-frontend'></a>

## برنامه‌های فروشگاه

The available frontend adapters that are used as interfaces or input sources to the cache are:

| آداپتور                                                                   | توضیحات                                                                                                                                                        |
| ------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| [Phalcon\Cache\Frontend\Output](api/Phalcon_Cache_Frontend_Output)     | داده های ورودی از خروجی استاندارد پی اچ پی را بخوانید.                                                                                                         |
| [Phalcon\Cache\Frontend\Data](api/Phalcon_Cache_Frontend_Data)         | It's used to cache any kind of PHP data (big arrays, objects, text, etc). Data is serialized before stored in the backend.                                     |
| [Phalcon\Cache\Frontend\Base64](api/Phalcon_Cache_Frontend_Base64)     | It's used to cache binary data. The data is serialized using `base64_encode` before be stored in the backend.                                                  |
| [Phalcon\Cache\Frontend\Json](api/Phalcon_Cache_Frontend_Json)         | Data is encoded in JSON before be stored in the backend. Decoded after be retrieved. This frontend is useful to share data with other languages or frameworks. |
| [Phalcon\Cache\Frontend\Igbinary](api/Phalcon_Cache_Frontend_Igbinary) | It's used to cache any kind of PHP data (big arrays, objects, text, etc). Data is serialized using `Igbinary` before be stored in the backend.                 |
| [Phalcon\Cache\Frontend\None](api/Phalcon_Cache_Frontend_None)         | این مورد برای ذخیره هر گونه داده های پی اچ پی بدون سریال کردن آنها مورد استفاده قرار می گیرد.                                                                  |

<a name='adapters-frontend-custom'></a>

### پیاده سازی آداپتورهای نرم افزار نهایی خود

The [Phalcon\Cache\FrontendInterface](api/Phalcon_Cache_FrontendInterface) interface must be implemented in order to create your own frontend adapters or extend the existing ones.

<a name='adapters-backend'></a>

## آداپتورهای پشتیبانی

The backend adapters available to store cache data are:

| آداپتور                                                                         | توضیحات                                                        | اطلاعات                                       | فرمت های مورد نیاز                                  |
| ------------------------------------------------------------------------------- | -------------------------------------------------------------- | --------------------------------------------- | --------------------------------------------------- |
| [Phalcon\Cache\Backend\Apc](api/Phalcon_Cache_Backend_Apc)                   | داده را در PHP حافظه نهان جایگزین(APC) ذخیره میکند.            | [APC](https://php.net/apc)                    | [APC](https://pecl.php.net/package/APC)             |
| `Phalcon\Cache\Backend\Apcu`                                                 | داده ها را در APCu ذخیره میکند. (APC بدون رمز شناس حافظه نهان) | [APCu](https://php.net/apcu)                  | [APCu](https://pecl.php.net/package/APCu)           |
| [Phalcon\Cache\Backend\File](api/Phalcon_Cache_Backend_File)                 | داده ها را به فایل های ساده محلی ذخیره می کند.                 |                                               |                                                     |
| [Phalcon\Cache\Backend\Libmemcached](api/Phalcon_Cache_Backend_Libmemcached) | داده ها را به یک سرور memcached ذخیره می کند.                  | [Memcached](https://secure.php.net/memcached) | [Memcached](https://pecl.php.net/package/memcached) |
| [Phalcon\Cache\Backend\Memcache](api/Phalcon_Cache_Backend_Memcache)         | داده ها را به یک سرور memcached ذخیره می کند.                  | [Memcache](https://secure.php.net/memcache)   | [Memcache](https://pecl.php.net/package/memcache)   |
| [Phalcon\Cache\Backend\Memory](api/Phalcon_Cache_Backend_Memory)             | Stores data in memory                                          |                                               |                                                     |
| [Phalcon\Cache\Backend\Mongo](api/Phalcon_Cache_Backend_Mongo)               | Stores data to Mongo Database.                                 | [MongoDB](https://mongodb.org/)               | [Mongo](https://mongodb.org/)                       |
| [Phalcon\Cache\Backend\Redis](api/Phalcon_Cache_Backend_Redis)               | Stores data in Redis.                                          | [Redis](https://redis.io/)                    | [Redis](https://pecl.php.net/package/redis)         |
| [Phalcon\Cache\Backend\Xcache](api/Phalcon_Cache_Backend_Xcache)             | Stores data in XCache.                                         | [XCache](https://xcache.lighttpd.net/)        | [XCache](https://pecl.php.net/package/xcache)       |

##### **NOTE** In PHP 7 to use phalcon `apc` based adapter classes you needed to install `apcu` and `apcu_bc` package from pecl. Now in Phalcon 4.0.0 you can switch your `<em>\Apc` classes to `</em>\Apcu` and remove `apcu_bc`. Keep in mind that in Phalcon 4 we will most likely remove all `*\Apc` classes. {.alert.alert-warning}

<a name='adapters-backend-factory'></a>

### کارخانه

There are many backend adapters (see [Backend Adapters](#adapters-backend)). چیزی که شما استفاده می کنید بستگی به نیازهای نرم افزارتان دارد. The following example loads the Backend Cache Adapter class using `adapter` option, if frontend will be provided as array it will call Frontend Cache Factory

```php
<?php

use Phalcon\Cache\Backend\Factory;
use Phalcon\Cache\Frontend\Data;

$options = [
    'prefix'   => 'app-data',
    'frontend' => new Data(),
    'adapter'  => 'apc',
];
$backendCache = Factory::load($options);
```

<a name='adapters-backend-custom'></a>

### پیاده سازی آداپتورهای پشتیبانی خود

The [Phalcon\Cache\BackendInterface](api/Phalcon_Cache_BackendInterface) interface must be implemented in order to create your own backend adapters or extend the existing ones.

<a name='adapters-backend-file'></a>

### گزینه های قایل پشتیبانی

This backend will store cached content into files in the local server. The available options for this backend are:

| گزینه      | توضیحات                                                              |
| ---------- | -------------------------------------------------------------------- |
| `پیشوند`   | یک پیشوند که به صورت خودکار به کلید های حافظه پنهان اضافه شده است.   |
| `cacheDir` | یک راهنمای قابل نوشتن که در آن فایلهای ذخیره شده، مکان داده می شوند. |

<a name='adapters-backend-libmemcached'></a>

### گزینه های پایان برگشت Libmemcached

This backend will store cached content on a memcached server. Per default persistent memcached connection pools are used. The available options for this backend are:

**General options**

| گزینه           | توضیحات                                                                                                                              |
| --------------- | ------------------------------------------------------------------------------------------------------------------------------------ |
| `آمار کلیدی`    | مورد استفاده برای ردیابی کلید های ذخیره شده.                                                                                         |
| `پیشوند`        | یک پیشوند که به صورت خودکار به کلید های حافظه پنهان اضافه شده است.                                                                   |
| `persistent_id` | برای ایجاد نمونه ای که بین درخواست ها ادامه می یابد، از `persistent_id` برای مشخص کردن یک شناسه منحصر به فرد برای مثال استفاده کنید. |

**Servers options**

| گزینه    | توضیحات                                                                                                                             |
| -------- | ----------------------------------------------------------------------------------------------------------------------------------- |
| `میزبان` | The `memcached` host.                                                                                                               |
| `پورت`   | The `memcached` port.                                                                                                               |
| `وزن`    | پارامتر وزن باعث می شود تا هشدار سازگار مورد استفاده قرار گیرد تا مشخص شود کدام سرور برای خواندن و نوشتن کلید از آن استفاده می شود. |

**Client options**

Used for setting Memcached options. See [Memcached::setOptions](https://php.net/manual/en/memcached.setoptions.php) for more.

**Example**

```php
<?php
use Phalcon\Cache\Backend\Libmemcached;
use Phalcon\Cache\Frontend\Data as FrontData;

// Cache data for 2 days
$frontCache = new FrontData(
    [
        'lifetime' => 172800,
    ]
);

// Create the Cache setting memcached connection options
$cache = new Libmemcached(
    $frontCache,
    [
        'servers' => [
            [
                'host'   => '127.0.0.1',
                'port'   => 11211,
                'weight' => 1,
            ],
        ],
        'client' => [
            \Memcached::OPT_HASH       => \Memcached::HASH_MD5,
            \Memcached::OPT_PREFIX_KEY => 'prefix.',
        ],
        'persistent_id' => 'my_app_cache',
    ]
);
```

<a name='adapters-backend-memcache'></a>

### گزینه های پایان برگشت Memcache

This backend will store cached content on a memcached server. The available options for this backend are:

| گزینه    | توضیحات                                                            |
| -------- | ------------------------------------------------------------------ |
| `پیشوند` | یک پیشوند که به صورت خودکار به کلید های حافظه پنهان اضافه شده است. |
| `میزبان` | میزبان memcached.                                                  |
| `پورت`   | پورت memcached.                                                    |
| `مداوم`  | ایجاد یک اتصال مداوم به memcached?                                 |

<a name='adapters-backend-apc'></a>

### گزینه های APC پشتیبانی

This backend will store cached content on Alternative PHP Cache ([APC](https://php.net/apc)). The available options for this backend are:

| گزینه    | توضیحات                                                            |
| -------- | ------------------------------------------------------------------ |
| `پیشوند` | یک پیشوند که به صورت خودکار به کلید های حافظه پنهان اضافه شده است. |

<a name='adapters-backend-apcu'></a>

### گزینه های APCU پشتیبانی

This backend will store cached content on Alternative PHP Cache ([APCU](https://php.net/apcu)). The available options for this backend are:

| گزینه    | توضیحات                                                            |
| -------- | ------------------------------------------------------------------ |
| `پیشوند` | یک پیشوند که به صورت خودکار به کلید های حافظه پنهان اضافه شده است. |

<a name='adapters-backend-mongo'></a>

### گزینه های پشتیبانی Mongo

This backend will store cached content on a MongoDB server ([MongoDB](https://mongodb.org/)). The available options for this backend are:

| گزینه    | توضیحات                                                            |
| -------- | ------------------------------------------------------------------ |
| `پیشوند` | یک پیشوند که به صورت خودکار به کلید های حافظه پنهان اضافه شده است. |
| `سرور`   | رشته اتصال MongoDB.                                                |
| `db`     | نام پایگاه داده Mongo.                                             |
| `مجموعه` | مجموعه مونگو در پایگاه داده.                                       |

<a name='adapters-backend-xcache'></a>

### گزینه های حافظه ایکس پشتیبانی

This backend will store cached content on XCache ([XCache](https://xcache.lighttpd.net/)). The available options for this backend are:

| گزینه    | توضیحات                                                            |
| -------- | ------------------------------------------------------------------ |
| `پیشوند` | یک پیشوند که به صورت خودکار به کلید های حافظه پنهان اضافه شده است. |

<a name='adapters-backend-redis'></a>

### گزینه های ردیس پشتیبانی

This backend will store cached content on a Redis server ([Redis](https://redis.io/)). The available options for this backend are:

| گزینه          | توضیحات                                                            |
| -------------- | ------------------------------------------------------------------ |
| `پیشوند`       | یک پیشوند که به صورت خودکار به کلید های حافظه پنهان اضافه شده است. |
| `میزبان`       | میزبان Redis.                                                      |
| `پورت`         | درگاه Redis.                                                       |
| `تأیید اعتبار` | رمز عبور برای تأیید اعتبار به سرور Redis محافظت شده با رمز عبور.   |
| `مداوم`        | ایجاد یک اتصال مداوم به Redis.                                     |
| `فهرست`        | شاخص پایگاه داده Redis برای استفاده.                               |

There are more adapters available for this components in the [Phalcon Incubator](https://github.com/phalcon/incubator)